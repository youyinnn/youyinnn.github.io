<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="baidu-site-verification" content="l09YSIpJQW" />
    <meta name="referrer" content="origin">
    <title>blog | youyinnn</title>
    <script>
        if (location.origin === 'https://youyinnn.github.io') {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    let rsjson = JSON.parse(xmlhttp.responseText)
                    if (rsjson.country === 'CN') {
                        // tricky: github pages building
                        setTimeout(() => {
                            window.location.href = "https://youyinnn.gitee.io" + location.pathname
                        }, 300);
                    }
                }
            }
            xmlhttp.open("GET", "https://ipinfo.io/json?030ac39a43fc1f", true);
            xmlhttp.send()
            var xmlhttp2 = new XMLHttpRequest();
            xmlhttp2.onreadystatechange = function() {
                if (xmlhttp2.readyState == 4 && xmlhttp2.status == 200) {
                    let rsjson = JSON.parse(xmlhttp2.responseText)
                    if (rsjson.country_code === 'CN') {
                        // tricky: github pages building
                        setTimeout(() => {
                            window.location.href = "https://youyinnn.gitee.io" + location.pathname
                        }, 300);
                    }
                }
            }
            xmlhttp2.open("GET", "https://freegeoip.app/json/", true);
            xmlhttp2.send()
        }
    </script>
    <link rel="bookmark" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="stylesheet" href="/mycss/style.css">

    <script src="/resources/resources.js"></script>
    <script src="/myjs/import.js"></script>
    <script>
        importJsBeforeLoad()
    </script>
</head>

<body>

    <ol id="topbar" class="breadcrumb unselectable new_font">
        <p style="color:rgb(214, 214, 214); padding-right: 1rem;">
            <button id="egg" class="egg em-svg em-rocket"></button>&nbsp;&nbsp;&nbsp;&nbsp;&gt;</p>
        <li class="breadcrumb-item">
            <spen id="homebut" href="javaScript:void(0)" class="ah">-home</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="articlesbut" href="javaScript:void(0)" class="ah">-articles</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="scriptbut" href="javaScript:void(0)" class="ah">-scripts</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="todobut" href="javaScript:void(0)" class="ah">-todos</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="resumebut" href="javaScript:void(0)" class="ah">-resume</spen>
        </li>
        <li class="breadcrumb-item dropdown">
            <spen href="javaScript:void(0)" class="ah" role="button" id="friendlinkedbut" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">-friends</spen>
            <div id="fldd" class="dropdown-menu" aria-labelledby="friendlinkedbut" style="border-radius: initial;"></div>
        </li>

        <div id="hb" data-toggle="tooltip" data-placement="bottom" title="show/hide TopBar">

        </div>
    </ol>

    <div id="homepage" class="unselectable new_font myhide">
        <span id="slogan">
            <i id="wolf-logo" class="em-svg em-new_moon mr-4"></i>I'M BACK
        </span>
        <div id="showmore"> &gt; About Me & This Blog</div>
        <div id="showhacknical"> &gt; My Github Analysis</div>
        <div id="toarticles"> &gt; My Tech Articles</div>
        <div id="ifwrapper" class="hacknical_hide">
            <iframe id="hacknical_github_analysis" frameborder="0"></iframe>
        </div>
    </div>

    <div id="series" class="unselectable">
        <span>系</span>
        <span>列</span>
        <span>文</span>
        <span>章</span>
    </div>
    <div id="seriesbox" class="unselectable">

    </div>

    <div id="articles_side_panel" class="unselectable myhide new_font">
        <div id="cates_tree_head">Article Categories</div>
        <div id="cates_tree_body"></div>
        <div id="blog_statistic_head">Blog Statistic</div>
        <table id="blog_statistic_body" class="myhide">
            <tbody>
                <tr>
                    <td style="text-align:right">Site running days:</td>
                    <td style="text-align:left" id="stat_running"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Total article:</td>
                    <td style="text-align:left" id="stat_article_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Char count:</td>
                    <td style="text-align:left" id="stat_typein"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Category count:</td>
                    <td style="text-align:left" id="stat_cate_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Tag count:</td>
                    <td style="text-align:left" id="stat_tag_count"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="docpanel" class="myhide new_font">
        <div id="articlesearch" class="input-group">
            <input id="articlesearchtext" type="text" class="form-control" autocomplete="off" placeholder="search">
            <div class="input-group-append">
                <button id="cleanbut" class="btn" type="button" title="clear search">cls</button>
                <button id="categories" class="btn" type="button">cates</button>
                <button id="tags" class="btn" type="button" title="all tags">tags</button>
                <button id="articlesearchbut" class="btn" type="button" title="search">sch</button>
            </div>
        </div>
        <div class="tgs myhide" id="all_cates">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All categories:</span>
            <br>
        </div>
        <div class="tgs myhide" id="all_tags">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All tags:</span>
            <br>
        </div>
    </div>

    <div id="sidetoccontainer" class="tochide unselectable new_font">
        <div id="block">
            <div id="percent" data-toggle="tooltip" data-placement="bottom" title="return to the top">0%</div>
        </div>
        <div id="sidetoc" class="unselectable markdown-body editormd-preview-container markdown-toc"></div>
    </div>
    <div id="md" class="myhide markdown-body editormd-html-preview">
        
          <h3>
            <a name="_root-Introduction" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Introduction
          </h3><p>本篇主要介绍Docker里面Containers的概念，以及它的定义</p>
<p>还有就是如何分享你创建的Containers到hub上面</p>
<p>需要注意的是，containers的定义其实就是image的定义</p>
<p>以及说到了docker run了两个option<code>-p</code>和<code>-d</code></p>

          <h3>
            <a name="_root-Define a container with Dockerfile" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Define a container with Dockerfile
          </h3><p><code>Dockerfile</code> defines what goes on in the environment inside your container. Access to resources like networking interfaces and disk drives is virtualized inside this environment, which is isolated from the rest of your system, so you need to map ports to the outside world, and be specific about what files you want to “copy in” to that environment. However, after doing that, you can expect that the build of your app defined in this <code>Dockerfile</code> behaves exactly the same wherever it runs.</p>

          <h4>
            <a name="_root-Dockerfile" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Dockerfile
          </h4><p>Create an empty directory. Change directories (<code>cd</code>) into the new directory, create a file called <code>Dockerfile</code>, copy-and-paste the following content into that file, and save it. Take note of the comments that explain each statement in your new Dockerfile.</p>
<pre><code class="language-dockerfile"># Use an official Python runtime as a parent image
FROM python:2.7-slim

# Set the working directory to /app
WORKDIR /app

# Copy the current directory contents into the container at /app
COPY . /app

# Install any needed packages specified in requirements.txt
RUN pip install --trusted-host pypi.python.org -r requirements.txt

# Make port 80 available to the world outside this container
EXPOSE 80

# Define environment variable
ENV NAME World

# Run app.py when the container launches
CMD [&quot;python&quot;, &quot;app.py&quot;]</code></pre>
<p>This <code>Dockerfile</code> refers to a couple of files we haven’t created yet, namely <code>app.py</code> and <code>requirements.txt</code>. Let’s create those next.</p>

          <h4>
            <a name="_root-The App itself" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            The App itself
          </h4><p>Create two more files, <code>requirements.txt</code> and <code>app.py</code>, and put them in the same folder with the <code>Dockerfile</code>. This completes our app, which as you can see is quite simple. When the above <code>Dockerfile</code> is built into an image, <code>app.py</code> and <code>requirements.txt</code> is present because of that <code>Dockerfile</code>’s <code>COPY</code> command, and the output from <code>app.py</code> is accessible over HTTP thanks to the <code>EXPOSE</code>command.</p>

          <h5>
            <a name="_root-<code>requirements.txt</code>" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            <code>requirements.txt</code>
          </h5><pre><code>Flask
Redis</code></pre>
          <h5>
            <a name="_root-<code>app.py</code>" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            <code>app.py</code>
          </h5><pre><code class="language-python">from flask import Flask
from redis import Redis, RedisError
import os
import socket

# Connect to Redis
redis = Redis(host=&quot;redis&quot;, db=0, socket_connect_timeout=2, socket_timeout=2)

app = Flask(__name__)

@app.route(&quot;/&quot;)
def hello():
    try:
        visits = redis.incr(&quot;counter&quot;)
    except RedisError:
        visits = &quot;&lt;i&gt;cannot connect to Redis, counter disabled&lt;/i&gt;&quot;

    html = &quot;&lt;h3&gt;Hello {name}!&lt;/h3&gt;&quot; \
           &quot;&lt;b&gt;Hostname:&lt;/b&gt; {hostname}&lt;br/&gt;&quot; \
           &quot;&lt;b&gt;Visits:&lt;/b&gt; {visits}&quot;
    return html.format(name=os.getenv(&quot;NAME&quot;, &quot;world&quot;), hostname=socket.gethostname(), visits=visits)

if __name__ == &quot;__main__&quot;:
    app.run(host=&#39;0.0.0.0&#39;, port=80)</code></pre>
<p>Now we see that <code>pip install -r requirements.txt</code> installs the Flask and Redis libraries for Python, and the app prints the environment variable <code>NAME</code>, as well as the output of a call to <code>socket.gethostname()</code>. Finally, because Redis isn’t running (as we’ve only installed the Python library, and not Redis itself), we should expect that the attempt to use it here fails and produces the error message.</p>
<blockquote>
<p><strong>Note</strong>: Accessing the name of the host when inside a container retrieves the container ID, which is like the process ID for a running executable.</p>
</blockquote>
<p>That’s it! You don’t need Python or anything in <code>requirements.txt</code> on your system, nor does building or running this image install them on your system. It doesn’t seem like you’ve really set up an environment with Python and Flask, but you have.</p>
<blockquote>
<p><strong>Notice</strong>: For quick start and practice, I didn&#39;t install the Redis library on my build.</p>
</blockquote>

          <h4>
            <a name="_root-Build the app" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Build the app
          </h4><p>We are ready to build the app. Make sure you are still at the top level of your new directory. Here’s what <code>ls</code> should show:</p>
<pre><code class="language-bash">$ ls
Dockerfile        app.py            requirements.txt</code></pre>
<p>Now run the build command. This creates a Docker image, which we’re going to tag using <code>-t</code> so it has a friendly name.</p>
<pre><code class="language-bash">docker build -t hello-hj .</code></pre>
<p>Where is your built image? It’s in your machine’s local Docker image registry:</p>
<pre><code class="language-bash">$ docker image ls

REPOSITORY            TAG                 IMAGE ID
hello-hj             latest              326387cea398</code></pre>

          <h4>
            <a name="_root-Run the app" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Run the app
          </h4>
          <h5>
            <a name="_root-run on the frontground" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            run on the frontground
          </h5><p>Run the app, mapping your machine’s port 4000 to the container’s published port 80 using <code>-p</code>:</p>
<pre><code>docker run -p 4000:80 hello-hj</code></pre><p>You should see a message that Python is serving your app at <code>http://0.0.0.0:80</code>. But that message is coming from inside the container, which doesn’t know you mapped port 80 of that container to 4000, making the correct URL <code>http://localhost:4000</code>.</p>
<p>Go to that URL in a web browser to see the display content served up on a web page.</p>

          <h5>
            <a name="_root-run on the background" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            run on the background
          </h5><p>Now let’s run the app in the background, in detached mode:</p>
<pre><code>docker run -d -p 4000:80 hello-hj</code></pre><p>You get the long container ID for your app and then are kicked back to your terminal. Your container is running in the background. You can also see the abbreviated container ID with <code>docker container ls</code> (and both work interchangeably when running commands):</p>
<pre><code class="language-bash">$ docker container ls
CONTAINER ID        IMAGE               COMMAND             CREATED
1fa4ab2cf395        hello-hj       &quot;python app.py&quot;     28 seconds ago</code></pre>
<p>Notice that <code>CONTAINER ID</code> matches what’s on <code>http://localhost:4000</code>.</p>

          <h5>
            <a name="_root-stop an container" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            stop an container
          </h5><p>Now use <code>docker container stop</code> to end the process, using the <code>CONTAINER ID</code>, like so:</p>
<pre><code class="language-bash">docker container stop 1fa4ab2cf395</code></pre>

          <h3>
            <a name="_root-Share your image to the hub" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Share your image to the hub
          </h3>
          <h4>
            <a name="_root-Log in with your Docker ID" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Log in with your Docker ID
          </h4><p>If you don’t have a Docker account, sign up for one at <a href="https://hub.docker.com/">hub.docker.com</a>. Make note of your username.</p>
<p>Log in to the Docker public registry on your local machine.</p>
<pre><code class="language-bash">$ docker login</code></pre>

          <h4>
            <a name="_root-Tag the image" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Tag the image
          </h4><p>The notation for associating a local image with a repository on a registry is <code>username/repository:tag</code>. The tag is optional, but recommended, since it is the mechanism that registries use to give Docker images a version. Give the repository and tag meaningful names for the context, such as <code>get-started:part2</code>. This puts the image in the <code>get-started</code> repository and tag it as <code>part2</code>.</p>
<p>Now, put it all together to tag the image. Run <code>docker tag image</code> with your username, repository, and tag names so that the image uploads to your desired destination. The syntax of the command is:</p>
<pre><code class="language-bash">docker tag image username/repository:tag</code></pre>
<p>For example:</p>
<pre><code class="language-bash">docker tag hello-hj youyinnn/getstarted:tag1</code></pre>
<p>Run <a href="https://docs.docker.com/engine/reference/commandline/image_ls/">docker image ls</a> to see your newly tagged image.</p>
<pre><code class="language-bash">$ docker image ls

REPOSITORY               TAG                 IMAGE ID            CREATED             SIZE
hello-hj              latest              27caa1c952f6        2 days ago          130MB
youyinnn/getstarted   tag1                27caa1c952f6        2 days ago          130MB
python                2.7-slim            804b0a01ea83        4 weeks ago         120MB
hello-world           latest              4ab4c602aa5e        2 months ago        1.84kB</code></pre>

          <h4>
            <a name="_root-Publish the image" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Publish the image
          </h4><p>Upload your tagged image to the repository:</p>
<pre><code class="language-bash">docker push username/repository:tag</code></pre>
<p>Once complete, the results of this upload are publicly available. If you log in to <a href="https://hub.docker.com/">Docker Hub</a>, you see the new image there, with its pull command.</p>

          <h4>
            <a name="_root-Pull and run the image from the remote repository" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Pull and run the image from the remote repository
          </h4><p>From now on, you can use <code>docker run</code> and run your app on any machine with this command:</p>
<pre><code class="language-bash">docker run -p 4000:80 username/repository:tag</code></pre>
<p>If the image isn’t available locally on the machine, Docker pulls it from the repository.</p>
<pre><code class="language-bash">$ docker run -p 4000:80 youyinnn/getstarted:tag1 
Unable to find image &#39;youyinnn/getstarted:tag1&#39; locally
part2: Pulling from gordon/get-started
10a267c67f42: Already exists
f68a39a6a5e4: Already exists
9beaffc0cf19: Already exists
3c1fe835fb6b: Already exists
4c9f1fa8fcb8: Already exists
ee7d8f576a14: Already exists
fbccdcced46e: Already exists
Digest: sha256:a569b6b6dc5afc145b4be32ed4d7c7407269c3ecd426dc3b5602b5cf9e3c6ac1
Status: Downloaded newer image for youyinnn/getstarted:tag1
 * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)</code></pre>
<p>No matter where <code>docker run</code> executes, it pulls your image, along with Python and all the dependencies from <code>requirements.txt</code>, and runs your code. It all travels together in a neat little package, and you don’t need to install anything on the host machine for Docker to run it.</p>

          <h3>
            <a name="_root-Dockerfile reference" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Dockerfile reference
          </h3><p>Docker can build images automatically by reading the instructions from a <code>Dockerfile</code>. A <code>Dockerfile</code> is a text document that contains all the commands a user could call on the command line to assemble an image. Using <code>docker build</code> users can create an automated build that executes several command-line instructions in succession.</p>
<p>For more information,  please refer to: <strong><a href="https://docs.docker.com/engine/reference/builder/#usage">https://docs.docker.com/engine/reference/builder/#usage</a></strong></p>

    </div>
    <div id="scriptsearcher" class="myhide input-group new_font">
        <input id="searchtext" type="text" class="form-control" placeholder="keywords" autocomplete="off">
        <div class="input-group-append">
            <button id="searchbut" class="btn btn-dark" type="button">Search</button>
        </div>
    </div>

    <div id="bbt" class="myhide new_font">
        <a id="toc" style="display: none;" class="myhide" href="javascript:void(0);" data-toggle="tooltip" data-placement="left" title="show/hide Toc">Toc</a>
        <a id="gohub" href="#" target="_blank" data-toggle="tooltip" data-placement="bottom" title="view this at github">unuse</a>
    </div>

    <div id="share_png_panel" class="myhide">
        <div id="share_curtain"></div>
        <div id="png_box"></div>
        <button id="share_png_paned_close" class="btn btn-dark">Close</button>
    </div>

    <script>
        importJsAfterLoad()
    </script>
</body>

</html>