<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="baidu-site-verification" content="l09YSIpJQW" />
    <meta name="referrer" content="origin">
    <title>blog | youyinnn</title>
    <script src="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/myjs/loadscripts.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/myjs/jump-1.2.js"></script>
    <link rel="bookmark" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="stylesheet" href="/mycss/style.css">

    <script src="/resources/resources.js"></script>
    <script src="/myjs/scriptlist.js"></script>
</head>

<body>

    <ol id="topbar" class="breadcrumb unselectable new_font">
        <p style="color:rgb(214, 214, 214); padding-right: 1rem;">
            <button id="egg" class="egg">ğŸš€</button>&nbsp;&nbsp;&nbsp;&nbsp;&gt;</p>
        <li class="breadcrumb-item">
            <spen id="homebut" href="javaScript:void(0)" class="ah">-home</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="articlesbut" href="javaScript:void(0)" class="ah">-articles</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="scriptbut" href="javaScript:void(0)" class="ah">-scripts</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="todobut" href="javaScript:void(0)" class="ah">-todos</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="resumebut" href="javaScript:void(0)" class="ah">-resume</spen>
        </li>
        <li class="breadcrumb-item dropdown">
            <spen href="javaScript:void(0)" class="ah" role="button" id="friendlinkedbut" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">-friends</spen>
            <div id="fldd" class="dropdown-menu" aria-labelledby="friendlinkedbut" style="border-radius: initial;"></div>
        </li>

        <div id="hb" data-toggle="tooltip" data-placement="bottom" title="show/hide TopBar">

        </div>
    </ol>

    <div id="homepage" class="unselectable new_font myhide">
        <span id="slogan">
            <i id="wolf-logo" style="font-style: normal;" class="mr-4">ğŸŒ‘</i>I'M BACK
        </span>
        <div id="showmore"> &gt; About Me & This Blog</div>
        <div id="showhacknical"> &gt; My Github Analysis</div>
        <div id="toarticles"> &gt; My Tech Articles</div>
        <div id="ifwrapper" class="hacknical_hide">
            <iframe id="hacknical_github_analysis" frameborder="0"></iframe>
        </div>
    </div>

    <div id="series" class="unselectable">
        <span>ç³»</span>
        <span>åˆ—</span>
        <span>æ–‡</span>
        <span>ç« </span>
    </div>
    <div id="seriesbox" class="unselectable">

    </div>

    <div id="articles_side_panel" class="unselectable myhide new_font">
        <div id="cates_tree_head">Article Categories</div>
        <div id="cates_tree_body"></div>
        <div id="blog_statistic_head">Blog Statistic</div>
        <table id="blog_statistic_body" class="myhide">
            <tbody>
                <tr>
                    <td style="text-align:right">Site running days:</td>
                    <td style="text-align:left" id="stat_running"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Total article:</td>
                    <td style="text-align:left" id="stat_article_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Char count:</td>
                    <td style="text-align:left" id="stat_typein"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Category count:</td>
                    <td style="text-align:left" id="stat_cate_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Tag count:</td>
                    <td style="text-align:left" id="stat_tag_count"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="docpanel" class="myhide new_font">
        <div id="articlesearch" class="input-group">
            <input id="articlesearchtext" type="text" class="form-control" autocomplete="off" placeholder="search">
            <div class="input-group-append">
                <button id="cleanbut" class="btn btn-light" type="button" title="clear search">cls</button>
                <button id="categories" class="btn btn-light" type="button">cates</button>
                <button id="tags" class="btn btn-light" type="button" title="all tags">tags</button>
                <button id="articlesearchbut" class="btn btn-light" type="button" title="search">sch</button>
            </div>
        </div>
        <div class="tgs myhide" id="all_cates">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All categories:</span>
            <br>
        </div>
        <div class="tgs myhide" id="all_tags">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All tags:</span>
            <br>
        </div>
    </div>

    <div id="sidetoccontainer" class="tochide unselectable new_font">
        <div id="block">
            <div id="percent" data-toggle="tooltip" data-placement="bottom" title="return to the top">0%</div>
        </div>
        <div id="sidetoc" class="unselectable markdown-body editormd-preview-container markdown-toc"></div>
    </div>
    <div id="md" class="myhide markdown-body editormd-html-preview">
        
          <h3>
            <a name="_root-Introduction" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Introduction
          </h3><p>æœ¬ç¯‡ä¸»è¦å†…å®¹ï¼š</p>
<ol>
<li>Java åˆ°åº•æ˜¯å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’</li>
<li>Java ä¸­çš„å¼•ç”¨ç±»å‹è¯¦è§£ä»¥å…¶åº”ç”¨åœºæ™¯</li>
</ol>

          <h3>
            <a name="_root-Pass-By-Value Or Pass-By-Reference ?" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Pass-By-Value Or Pass-By-Reference ?
          </h3><p>Javaä¸­çš„æ‰€æœ‰ä¼ é€’éƒ½æ˜¯å€¼ä¼ é€’ï¼Œå¹¶ä¸å­˜åœ¨æ‰€è°“çš„å¼•ç”¨ä¼ é€’</p>
<p>è¦ç†è§£è¿™ä¸ªé—®é¢˜çš„å…³é”®åœ¨äºï¼š</p>
<pre><code class="language-java">Dog myDog;</code></pre>
<p>å…¶ä¸­çš„<code>myDog</code>å¹¶ä¸æ˜¯çœŸæ­£çš„Dogå¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ª<em>pointer</em>ï¼Œè¿™ä¸ªæŒ‡é’ˆå¯ä»¥æŒ‡å‘ä¸€ä¸ªDogå¯¹è±¡</p>
<p>æ„æ€æ˜¯è¯´ï¼š</p>
<pre><code class="language-java">Dog myDog = new Dog(&quot;Rover&quot;);
foo(myDog);</code></pre>
<p>æœ¬è´¨ä¸Šæ¥è¯´ï¼Œè¿™ä»…ä»…åªæ˜¯å°†è¿™ä¸ªè¢«åˆ›å»ºçš„Dogå¯¹è±¡çš„åœ°å€ä¼ é€’ç»™äº†<code>foo</code>æ–¹æ³•</p>
<p>å‡å¦‚è¯´<code>myDog</code> è¿™ä¸ª<em>pointer</em>çš„åœ°å€æ˜¯<strong>0x19</strong>ï¼Œè€Œå®ƒæŒ‡å‘çš„è¿™ä¸ª<code>Dog</code>å¯¹è±¡çš„åœ°å€æ˜¯<strong>0x42</strong>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…¶å®æ˜¯æŠŠ<strong>0x42</strong>è¿™ä¸ªå€¼ï¼Œä¼ é€’ç»™äº†æ–¹æ³•ï¼Œè€Œä¸æ˜¯å°†<strong>0x19</strong>ä¼ é€’ç»™äº†æ–¹æ³•</p>
<p>å¦‚æœè¯´æ–¹æ³•é‡Œé¢çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-java">public void foo(Dog someDog) {
    someDog.setName(&quot;Max&quot;);     // 1
    someDog = new Dog(&quot;Fifi&quot;);  // 2
    someDog.setName(&quot;Rowlf&quot;);   // 3
}</code></pre>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªæ–¹æ³•é‡Œå‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼š</p>
<ul>
<li>å‚æ•°<code>someDog</code>æŒ‡å‘<strong>0x42</strong></li>
<li>åœ¨<code>//1</code><ul>
<li><code>someDog</code> æŒ‡å‘çš„<strong>0x42</strong>è¢«setNameæˆ<strong>Max</strong>äº†</li>
</ul>
</li>
<li>åœ¨<code>//2</code><ul>
<li>ä¸€ä¸ªåç§°ä¸º<strong>Fifi</strong>çš„æ–°<code>Dog</code>å¯¹è±¡ï¼ˆ<strong>0x97</strong>ï¼‰è¢«<code>someDog</code>æŒ‡å‘äº†</li>
</ul>
</li>
<li>åœ¨<code>//3</code><ul>
<li><code>someDog</code>æŒ‡å‘çš„<strong>0x97</strong>è¢«setNameæˆ<strong>Rowlf</strong>äº†</li>
</ul>
</li>
<li>æ–¹æ³•è¿”å›</li>
</ul>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥æ˜¯çµé­‚æ‹·é—®ï¼š<em>æ–¹æ³•å¤–é¢çš„<code>myDog</code>è¿™æ—¶å€™å«ä»€ä¹ˆåå­—ï¼Ÿ</em></p>
<p>è¿™é‡Œå°±æ˜¯å…³é”®ï¼</p>
<p>å®ƒå«<strong>Max</strong>ï¼Œä½†æ˜¯ï¼</p>
<p>ä»å§‹è‡³ç»ˆè¯·è®°ä½ï¼Œ<code>myDog</code>æ˜¯ä¸€ä¸ªpointerï¼Œå®ƒä»å§‹è‡³ç»ˆåªæŒ‡å‘äº†<strong>0x42</strong>ï¼Œå®ƒè¿˜æ˜¯åŸæ¥é‚£æ¡ä¸€æ— æ˜¯å¤„çš„ç‹—ï¼Œåªä¸è¿‡åœ¨<code>//1</code>çš„æ—¶å€™è¢«äººæ”¹äº†åå­—è€Œå·²ï¼›</p>
<p>è‡³äº<code>someDog</code>ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªå®¹æ˜“å˜å¿ƒçš„æŒ‡é’ˆè€Œå·²ï¼Œæ‰€ä»¥æ–¹æ³•å†…å¤–çš„<code>myDog</code>å’Œ<code>someDog</code>ï¼Œå®ƒä»¬æ˜¯ä¸¤ä¸ªä¸–ç•Œçš„æŒ‡é’ˆï¼Œè°ä¹Ÿä¸ä¼šçœŸæ­£å½±å“åˆ°è°å˜å¿ƒï¼›</p>

          <h3>
            <a name="_root-Reference Type" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Reference Type
          </h3><p>ä¹‹å‰åœ¨JVMå­¦ä¹ çš„æ—¶å€™å­¦è¿‡å‡ ç§å¼•ç”¨çš„å«ä¹‰ï¼Œè¿™é‡Œå†å¼•ç”¨ä¸€äº›<a href="https://blog.csdn.net/xlinsist/article/details/57089288">å‚è€ƒ</a>ï¼Œæ·±å…¥äº†è§£ä¸€ä¸‹</p>
<blockquote>
<p>ä½œè€…ï¼šXurtle<br>æ¥æºï¼šCSDN<br>åŸæ–‡ï¼š<a href="https://blog.csdn.net/xlinsist/article/details/57089288">https://blog.csdn.net/xlinsist/article/details/57089288</a> </p>
</blockquote>

          <h4>
            <a name="_root-Strong reference" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Strong reference
          </h4><p>æ˜¾å¼å†™å‡ºæ¥çš„å¼•ç”¨å°±æ˜¯å®ƒï¼Œé™¤éæ˜¾å¼å¼•ç”¨æ–­å¼€äº†å¦åˆ™å°±å›æ”¶å®ƒï¼Œè€Œè¿™èƒŒåJVMæ­£æ˜¯ç›´æ¥é€šè¿‡å¯è¾¾æ€§åˆ¤æ–­æ¥å›æ”¶çš„ï¼Œæ¯ä¸ªå¼ºå¼•ç”¨çš„å¯¹è±¡éƒ½èƒ½é€šè¿‡å¯è¾¾æ€§åˆ¤æ–­ï¼›</p>
<pre><code class="language-java">String a = new String(&quot;xixi&quot;);    // â€™xixiâ€˜ is at 0x42
// some work
a = null;    // â€˜xixiâ€™ which means 0x42 is now available for GC</code></pre>

          <h4>
            <a name="_root-Soft reference" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Soft reference
          </h4><p>å®ƒå¼•ç”¨çš„å¯¹è±¡åªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶<strong>ä¸”æ²¡æœ‰å¼ºå¼•ç”¨åŒæ—¶å¼•ç”¨è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™</strong>ï¼Œæ‰ä¼šè¢«å›æ”¶ï¼Œä¹Ÿå³æ˜¯åœ¨ä¸‹æ¬¡OOMä¹‹å‰ï¼ŒJVMä¸€å®šä¼šæ¸…ç†æ‰æ‰€æœ‰çš„<strong>soft reference</strong></p>
<p>è™½ç„¶GCorä»¬å·²ç»å¾ˆåŠªåŠ›åœ°åœ¨å·¥ä½œäº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä½œä¸ºJavaå¼€å‘ï¼Œä¹Ÿä¸èƒ½ä¸ºæ‰€æ¬²ä¸ºï¼Œä¸å½“çš„ä»£ç ä¼šé€ æˆå†—ä½™çš„å¯¹è±¡ï¼Œå˜æˆGCorä»¬æ— æ³•æ¸…ç†çš„åƒåœ¾ï¼Œç”šè‡³é€ æˆå†…å­˜æ³„æ¼é—®é¢˜</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ï¼š</p>
<pre><code class="language-java">public class LeakyChecksum {
    private byte[] byteArray;

    public synchronized int getFileChecksum(String fileName) {
        int len = getFileSize(fileName);
        if (byteArray == null || byteArray.length &lt; len)
            byteArray = new byte[len];
        readFileContents(fileName, byteArray);
        // calculate checksum and return it
    }
}</code></pre>
<p>åœ¨æ²¡æœ‰å¯¹<code>byteArray</code>è¿›è¡Œæ‰‹åŠ¨æ•°æ®æ¸…ç†çš„æ—¶å€™ï¼Œ<code>byteArray</code>ä¼šä¸æ–­é‡ç”¨æ•°ç»„ï¼Œé™¤é<code>LeakyChecksum</code>å¯¹è±¡è¢«GCï¼Œå¦åˆ™å®ƒä¸ä¼šè¢«GCï¼Œå®ƒçš„å¤§å°ä¼šå§‹ç»ˆå’Œå®ƒå¤„ç†è¿‡çš„æœ€å¤§çš„æ–‡ä»¶ä¸€æ ·å¤§ï¼Œè¿™æ ·ä¼šå¢åŠ GCçš„é¢‘ç‡ï¼›</p>
<p>è€Œä¸”å› ä¸ºæ–¹æ³•åç»­æ²¡æœ‰æ‰‹åŠ¨æ¸…ç†ï¼Œæ‰€ä»¥è¿™ä¸ªå­—èŠ‚æ•°ç»„å°±ä¸€ç›´å­˜åœ¨å†…å­˜ä¸­çš„åƒåœ¾ï¼Œé€ æˆå†…å­˜æ³„æ¼</p>
<p>äºæ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è½¯å¼•ç”¨å»æè¿°è¿™ä¸ªå­—èŠ‚æ•°ç»„ï¼Œä¸€æ—¦å†…å­˜ç´§å¼ çš„æ—¶å€™ï¼Œå®ƒå°±ä¼šè¢«å›æ”¶æ‰ï¼Œä»è€Œé‡Šæ”¾å¤šä½™çš„ç©ºé—´</p>
<pre><code class="language-java">public class CachingChecksum {
    private SoftReference&lt;byte[]&gt; bufferRef;

    public synchronized int getFileChecksum(String fileName) {
        int len = getFileSize(fileName);
        byte[] byteArray = bufferRef.get();
        if (byteArray == null || byteArray.length &lt; len) {
            byteArray = new byte[len];
            bufferRef.set(byteArray);
        }
        readFileContents(fileName, byteArray);
        // calculate checksum and return it
    }
}</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½å°è¯•è·å–è½¯å¼•ç”¨å¯¹è±¡ï¼Œå¦‚æœå®ƒä¸ºnullï¼Œè¯æ˜å®ƒæ˜¯ç¬¬ä¸€æ¬¡è®¿é—®æˆ–è€…è¢«GCæ¸…ç†æ‰äº†</p>

          <h4>
            <a name="_root-Weak reference" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Weak reference
          </h4><p>è¢«å£°æ˜ä¸ºå¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œ<strong>å¦‚æœæ²¡æœ‰å¼ºå¼•ç”¨åŒæ—¶å¼•ç”¨è¿™ä¸ªå¯¹è±¡</strong>ï¼Œé‚£ä¹ˆå®ƒåªèƒ½å­˜æ´»åˆ°ä¸‹ä¸€æ¬¡GCä¹‹å‰</p>
<pre><code class="language-java">WeakReference&lt;String&gt; sr = new WeakReference&lt;String&gt;(new String(&quot;hello&quot;));

System.out.println(sr.get()); // hello
System.gc();                  // é€šçŸ¥JVMçš„gcè¿›è¡Œåƒåœ¾å›æ”¶
System.out.println(sr.get()); // might be null</code></pre>

          <h4>
            <a name="_root-Phantom reference" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Phantom reference
          </h4><p><strong>Phantom References</strong>ä¸ä¸Šé¢çš„å‡ ä¸ªå¼•ç”¨å­˜åœ¨å¾ˆå¤§çš„ä¸åŒï¼Œè‡³å°‘ä¸Šé¢çš„<code>Reference</code> å¯¹è±¡é€šè¿‡å®ƒä»¬çš„<code>get()</code> æ–¹æ³•å¯ä»¥è·å–åˆ°å®ƒä»¬æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œä½†æ˜¯ï¼Œ<code>PhantomReference</code> çš„åªä¼šè¿”å›<code>null</code>ï¼Œå› ä¸ºè™šå¼•ç”¨çš„æ„ä¹‰ä¸åœ¨äºgetåˆ°å¼•ç”¨ï¼Œè€Œåœ¨äº<strong>å®ƒèƒ½æé†’æˆ‘ä»¬å“ªäº›å¯¹è±¡ä¸åº”è¯¥ç»§ç»­å­˜åœ¨äº†</strong></p>
<p><a href="https://blog.csdn.net/xlinsist/article/details/57089288">è¿™ç¯‡é‡Œ</a>è¯´ï¼š<em>â€œPhantom reference çš„å”¯ä¸€ä½œç”¨å°±æ˜¯å®ƒå¯ä»¥ç›‘æµ‹åˆ°å¯¹è±¡çš„æ­»äº¡ï¼Œå³ï¼Œå½“ä½ çš„å¯¹è±¡çœŸæ­£ä»å†…å­˜ä¸­ç§»é™¤æ—¶ï¼ŒæŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„<code>PhantomReference</code> å°±ä¼šè¢«åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­â€</em></p>
<p>è¿™å¥è¯å…¶å®ååŠå¥æœ‰è¯¯ï¼Œåº”è¯¥æ˜¯<em>â€œè¿™ä¸ªè¢«å›æ”¶å¯¹è±¡ç”Ÿå‰æ‰€å¼•ç”¨çš„è™šå¼•ç”¨å¯¹è±¡ä¼šè¢«åŠ å…¥åˆ°*</em>å¼•ç”¨é˜Ÿåˆ—*<em>ä¸­â€</em>æ‰å¯¹</p>
<p>å…³äº<strong>å¼•ç”¨é˜Ÿåˆ—</strong>ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¸‹èŠ‚å†ç»†è¯´ï¼Œå…ˆæ¥æ•´ç†ä¸€ä¸‹è™šå¼•ç”¨åˆ°åº•æœ‰ä»€ä¹ˆç¥é€š</p>
<p>å®ƒé¦–å…ˆä¼šè¡¨ç°å‡ºæ¥çš„è¡Œä¸ºæ˜¯ï¼šå½“ä¸”ä»…å½“è™šå¼•ç”¨å¯¹è±¡çš„<strong>å‚ç…§å¯¹è±¡ï¼ˆreferentï¼‰</strong>è¢«GCå›æ”¶æ‰çš„æ—¶å€™ï¼Œé‚£ä¹ˆè¿™ä¸ªè™šå¼•å¯¹è±¡ç”¨ä¼šè¢«åŠ å…¥åˆ°<code>ReferenceQueue</code>ä¸­ï¼Œ<strong>è¿™æ—¶å€™è™šå¼•ç”¨å¯¹è±¡è¿˜æ²¡è¢«å›æ”¶</strong></p>
<pre><code class="language-java">public class PhantomReferenceDemo {
    private static ReferenceQueue&lt;Person&gt; rq = new ReferenceQueue&lt;&gt;();
    static Person p;
    static Dog d;
    public static void main(String[] args){
        p = new Person(&quot;xixi&quot;);
        d = new Dog(p, rq, &quot;haha&quot;);
        printRQ();
        p = null;
        System.gc();
        waitMoment(2000);    // wait gc
        printRQ();
    }

    static class Person {
        String name;Dog dog;
        public Person(String name) {this.name = name;}
        public void setDog(Dog dog) {this.dog = dog;}
    }

    static class Dog extends PhantomReference&lt;Person&gt; {
        String name;
        // Person person;
        public Dog(Person referent, ReferenceQueue&lt;? super Person&gt; q, String name) {
            super(referent, q);
            // this.person = referent;
            this.name = name;
        }
    }

    private static void waitMoment(long time) {
        try {
            Thread.sleep(time);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

    private static void printRQ() {
        int size = 0;
        Object obj;
        while ( ( obj = rq.poll() ) != null ) {
            System.out.println(&quot;reference: &quot; + obj);
            size++;
        }
        System.out.println(&quot;size of rqï¼š &quot; + size);
    }
}

// size of rqï¼š 0
// reference: _reference.PhantomReferenceDemo$Dog@45ee12a7
// size of rqï¼š 1</code></pre>
<p>è™šå¼•ç”¨çš„æ­£ç¡®å®ç°æ–¹å¼å°±æ˜¯å¦‚<code>Dog</code>å¯¹è±¡ä¸€æ ·ï¼Œç»§æ‰¿<code>PhantomReference&lt;Person&gt;</code>ï¼Œå› ä¸ºç‹—æ˜¯è·Ÿéšäººçš„ï¼Œå¦‚æœäººæ²¡æœ‰äº†ï¼Œé‚£ä¹ˆç‹—å°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦äº†ï¼ˆè¯·ä¸è¦å¸¦æœ‰æ„Ÿæƒ…åœ°å»è¯»è¿™å¥è¯ï¼Œå®¢è§‚çš„çœ‹ä»£ç - -ï¼‰æ‰€ä»¥è¯´ï¼Œç‹—å¯¹è±¡çš„<strong>å‚ç…§å¯¹è±¡ï¼ˆreferentï¼‰</strong>æ˜¯äººï¼</p>
<p>æ‰€ä»¥åœ¨<code>line:9</code>ä¹‹åï¼Œå½“äººå¯¹è±¡å˜ä¸º<strong>ä¸å¯è¾¾çŠ¶æ€</strong>çš„æ—¶å€™ï¼Œè¢«GCå¤„ç†æ‰äº†ä¹‹åï¼Œå› ä¸ºä¸¤è€…ä¹‹é—´çš„è™šå¼•ç”¨å…³ç³»ï¼Œç‹—å¯¹è±¡è¢«åŠ å…¥åˆ°äº†æŒ‡å®šçš„å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œè¡¨é¢éœ€è¦å¯¹è¿™ä¸ªæ²¡æœ‰å­˜åœ¨å¿…è¦çš„ç‹—å¯¹è±¡ä¹Ÿè¿›è¡Œå¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™è™šå¼•ç”¨å¯¹è±¡çš„<code>clear()</code>æ–¹æ³•ï¼Œåœ¨æ–¹æ³•é‡Œé¢å»æ‰ç‹—çš„å¼ºå¼•ç”¨ï¼Œå»ç„¶ååœ¨å¤„ç†å¼•ç”¨é˜Ÿåˆ—çš„æ—¶å€™ï¼Œè°ƒç”¨è™šå¼•ç”¨å¯¹è±¡çš„<code>clear()</code>æ–¹æ³•</p>
<pre><code class="language-java">// Dog
@Override
public void clear() {
    super.clear();
    System.out.println(&quot;clear dog&quot;);
    d = null;
}
// printRQ
private static void printRQ() {
    // ...
    while ( ( obj = rq.poll() ) != null ) {
        // ...
        ((Reference) obj).clear();
    }
    // ...
}</code></pre>
<p>é‚£ä¹ˆä¸Šä¸€å¥è¯´åˆ°çš„ä¸å¯è¾¾çŠ¶æ€å¦‚ä½•éªŒè¯ï¼Ÿç‹—å¯¹è±¡çš„Personå­—æ®µç›¸å…³è¢«æ³¨é‡Šæ‰äº†ï¼Œå¦‚æœè§£å¼€æ³¨é‡Šä¹‹åï¼Œå³ä½¿å…¨å±€qå¯¹è±¡å·²ç»è®¾ç½®ä¸ºnullï¼Œä½†æ˜¯äººå¯¹è±¡è¿˜æœ‰ç‹—å¯¹è±¡å»å¼•ç”¨ï¼Œäººå¯¹è±¡è¿˜æ˜¯å¤„äºå¯è¾¾çŠ¶æ€çš„ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡<code>printRQ</code>æ–¹æ³•ä¾æ—§æ˜¯æ²¡æœ‰ä»»ä½•å¯¹è±¡å…¥é˜Ÿ</p>

          <h3>
            <a name="_root-Reference Abstract Class &amp; ReferenceQueue" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Reference Abstract Class &amp; ReferenceQueue
          </h3><p>ä¸Šé¢æåˆ°çš„4ç§å¼•ç”¨ç±»å‹ä¸­çš„å3ç§ï¼Œåœ¨Javaä¸­å…¶å®éƒ½æ˜¯<code>Reference</code>çš„å­ç±»å®ç°ï¼Œå¹¶ä¸”<code>Reference</code>å’Œ<code>ReferenceQueue</code>çš„å…³ç³»å¾ˆå¯†åˆ‡</p>
<p>å…¶å®æˆ‘æ„Ÿè§‰è™šå¼•ç”¨çš„ä½œç”¨å¯ä»¥äººä¸ºæ›¿ä»£ï¼Œæ¯”å¦‚ä¸Šæ–‡çš„äººå’Œç‹—çš„å…³ç³»ï¼Œåªè¦ç‹—æ²¡æœ‰å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆäººæ²¡äº†ç‹—ä¹Ÿå°±æ²¡äº†</p>
<p>æ‰€ä»¥æ›´å¤šçš„æ—¶å€™ï¼Œè™šå¼•ç”¨æ˜¯ç”¨æ¥ç›‘å¬è™šå¼•ç”¨çš„å‚ç…§å¯¹è±¡æ˜¯å¦è¢«GCæ‰äº†</p>
<p>ä¸ŠèŠ‚å·²ç»è¯´è¿‡è™šå¼•ç”¨å’Œå¼•ç”¨é˜Ÿåˆ—çš„å…³ç³»äº†ï¼Œå®ƒå¿…é¡»æŒ‡å®šä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼Œè½¯å¼•ç”¨å’Œå¼±å¼•ç”¨å¯ä»¥é€‰æ‹©æ€§åœ°å’Œå¼•ç”¨é˜Ÿåˆ—åˆä½œ</p>
<p>ä»¥ä¸‹å‚è€ƒè‡ª<a href="https://juejin.im/entry/5b28f605f265da59942344d4">java æºç ç³»åˆ— - å¸¦ä½ è¯»æ‡‚ Reference å’Œ ReferenceQueue</a></p>

          <h4>
            <a name="_root-Reference" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Reference
          </h4><p>ä¸»è¦æ˜¯è´Ÿè´£å†…å­˜çš„ä¸€ä¸ªçŠ¶æ€ï¼Œå½“ç„¶å®ƒè¿˜å’Œjavaè™šæ‹Ÿæœºï¼Œåƒåœ¾å›æ”¶å™¨æ‰“äº¤é“ã€‚Referenceç±»é¦–å…ˆæŠŠå†…å­˜åˆ†ä¸º4ç§çŠ¶æ€Activeï¼ŒPendingï¼ŒEnqueuedï¼ŒInactiveã€‚</p>
<ul>
<li>Activeï¼Œä¸€èˆ¬æ¥è¯´å†…å­˜ä¸€å¼€å§‹è¢«åˆ†é…çš„çŠ¶æ€éƒ½æ˜¯ Activeï¼Œ</li>
<li>Pending å¤§æ¦‚æ˜¯æŒ‡å¿«è¦è¢«æ”¾è¿›é˜Ÿåˆ—çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯é©¬ä¸Šè¦å›æ”¶çš„å¯¹è±¡ï¼Œ</li>
<li>Enqueued å°±æ˜¯å¯¹è±¡çš„å†…å­˜å·²ç»è¢«å›æ”¶äº†ï¼Œæˆ‘ä»¬å·²ç»æŠŠè¿™ä¸ªå¯¹è±¡æ”¾å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œæ–¹ä¾¿ä»¥åæˆ‘ä»¬æŸ¥è¯¢æŸä¸ªå¯¹è±¡æ˜¯å¦è¢«å›æ”¶ï¼Œ</li>
<li>Inactiveå°±æ˜¯æœ€ç»ˆçš„çŠ¶æ€ï¼Œä¸èƒ½å†å˜ä¸ºå…¶å®ƒçŠ¶æ€ã€‚</li>
</ul>

          <h4>
            <a name="_root-ReferenceQueue" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            ReferenceQueue
          </h4><p>å¼•ç”¨é˜Ÿåˆ—ï¼Œåœ¨æ£€æµ‹åˆ°é€‚å½“çš„<strong>å¯åˆ°è¾¾æ€§æ›´æ”¹</strong>åï¼Œåƒåœ¾å›æ”¶å™¨å°†å·²æ³¨å†Œçš„å¼•ç”¨å¯¹è±¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼ŒReferenceQueueå®ç°äº†å…¥é˜Ÿï¼ˆenqueueï¼‰å’Œå‡ºé˜Ÿï¼ˆpollï¼‰ï¼Œè¿˜æœ‰removeæ“ä½œï¼Œå†…éƒ¨å…ƒç´ headå°±æ˜¯æ³›å‹çš„Referenceã€‚</p>

          <h4>
            <a name="_root-Sample" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Sample
          </h4><pre><code class="language-java">public static void main(String[] args) throws InterruptedException {
    ReferenceQueue queue = new ReferenceQueue();

    // åˆ›å»ºå¼±å¼•ç”¨ï¼Œæ­¤æ—¶çŠ¶æ€ä¸ºActiveï¼Œå¹¶ä¸”Reference.pendingä¸ºç©º
    // å½“å‰Reference.queue = ä¸Šé¢åˆ›å»ºçš„queueï¼Œå¹¶ä¸”next=null
    WeakReference reference = new WeakReference(new Object(), queue);
    System.out.println(reference);
    // å½“GCæ‰§è¡Œåï¼Œç”±äºæ˜¯è™šå¼•ç”¨ï¼Œæ‰€ä»¥å›æ”¶è¯¥objectå¯¹è±¡
    //å¹¶ä¸”ç½®äºpendingä¸Šï¼Œæ­¤æ—¶referenceçš„çŠ¶æ€ä¸ºPENDING
    System.gc();

    /* ReferenceHandlerä»pendingä¸­å–ä¸‹è¯¥å…ƒç´ ï¼Œå¹¶ä¸”å°†è¯¥å…ƒç´ æ”¾å…¥åˆ°queueä¸­ï¼Œ
    æ­¤æ—¶ReferenceçŠ¶æ€ä¸ºENQUEUEDï¼ŒReference.queue = ReferenceENQUEUED */

    /* å½“ä»queueé‡Œé¢å–å‡ºè¯¥å…ƒç´ ï¼Œåˆ™å˜ä¸ºINACTIVEï¼ŒReference.queue = Reference.NULL */
    Reference reference1 = queue.remove();
    System.out.println(reference1);
}</code></pre>
<p>æˆ‘ä»¬å¾ˆå®¹æ˜“å°±æƒ³åˆ°ï¼Œ<code>reference</code>å’Œ<code>reference1</code>æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸”è¿™æ®µä»£ç ä¹Ÿæ­ç¤ºäº†ä¸€ä¸ªäº‹å®ï¼š<strong>åŒ¿åå¯¹è±¡éƒ½æ˜¯è™šå¼•ç”¨</strong></p>

          <h3>
            <a name="_root-Conclusion" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Conclusion
          </h3><p>æœ‰æ•ˆåœ°åˆ©ç”¨3ç§å¼•ç”¨ç±»å‹ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æé«˜GCæ•ˆç‡ï¼Œé˜²æ­¢OOM</p>
<p>åœ¨Javaä¸­ä¹Ÿæœ‰è®¸å¤šåº”ç”¨å®ä¾‹ï¼Œæ¯”å¦‚æœ‰<code>WeakHashMap</code>ç­‰ç­‰ï¼Œä»–åœ¨<code>ThreadLocal</code>é‡Œå°±è¿ç”¨åˆ°äº†ï¼Œä»¥åæœ‰ç©ºå†ç ”ç©¶</p>

    </div>
    <div id="scriptsearcher" class="myhide input-group new_font">
        <input id="searchtext" type="text" class="form-control" placeholder="keywords" autocomplete="off">
        <div class="input-group-append">
            <button id="searchbut" class="btn btn-dark" type="button">Search</button>
        </div>
    </div>

    <div id="bbt" class="myhide new_font">
        <a id="toc" style="display: none;" class="myhide" href="javascript:void(0);" data-toggle="tooltip" data-placement="left" title="show/hide Toc">Toc</a>
        <a id="gohub" href="#" target="_blank" data-toggle="tooltip" data-placement="bottom" title="view this at github">unuse</a>
    </div>

    <div id="share_png_panel" class="myhide">
        <div id="share_curtain"></div>
        <div id="png_box"></div>
        <button id="share_png_paned_close" class="btn btn-dark">Close</button>
    </div>

</body>

</html>