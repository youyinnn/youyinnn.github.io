<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="baidu-site-verification" content="l09YSIpJQW" />
    <meta name="referrer" content="origin">
    <title>blog | youyinnn</title>
    <script src="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/myjs/loadscripts.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/myjs/jump-1.3.js"></script>
    <link rel="bookmark" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="stylesheet" href="/mycss/style.css">

    <script src="/resources/resources.js"></script>
    <script src="/myjs/scriptlist.js"></script>
</head>

<body>

    <ol id="topbar" class="breadcrumb unselectable new_font">
        <p style="color:rgb(214, 214, 214); padding-right: 1rem;">
            <button id="egg" class="egg">ğŸš€</button>&nbsp;&nbsp;&nbsp;&nbsp;&gt;</p>
        <li class="breadcrumb-item">
            <spen id="homebut" href="javaScript:void(0)" class="ah">-home</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="articlesbut" href="javaScript:void(0)" class="ah">-articles</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="scriptbut" href="javaScript:void(0)" class="ah">-scripts</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="todobut" href="javaScript:void(0)" class="ah">-todos</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="resumebut" href="javaScript:void(0)" class="ah">-resume</spen>
        </li>
        <li class="breadcrumb-item dropdown">
            <spen href="javaScript:void(0)" class="ah" role="button" id="friendlinkedbut" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">-friends</spen>
            <div id="fldd" class="dropdown-menu" aria-labelledby="friendlinkedbut" style="border-radius: initial;"></div>
        </li>

        <div id="hb" data-toggle="tooltip" data-placement="bottom" title="show/hide TopBar">

        </div>
    </ol>

    <div id="homepage" class="unselectable new_font myhide">
        <div id="homepage-center">
            <div id="slogan">
                <i id="wolf-logo" style="font-style: normal;" class="mr-4">ğŸŒ‘</i><span id="slogan-text"></span>
            </div>
            <div id="homepage-btn">
                <div id="showmore"> &nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;&nbsp; About Me & This Blog</div>
                <div id="showhacknical"> &nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;&nbsp; My Github Analysis</div>
                <div id="toarticles"> &nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;&nbsp; My Tech Articles</div>
            </div>
        </div>
        <div id="ifwrapper" class="hacknical_hide">
            <iframe id="hacknical_github_analysis" frameborder="0"></iframe>
        </div>
    </div>

    <div id="articles_side_panel" class="unselectable myhide new_font">
        <div id="cates_tree_head">Article Categories</div>
        <div id="cates_tree_body"></div>
        <div id="blog_statistic_head">Blog Statistics</div>
        <table id="blog_statistic_body" class="myhide">
            <tbody>
                <tr>
                    <td style="text-align:right">Online:</td>
                    <td style="text-align:left" id="stat_running"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Article:</td>
                    <td style="text-align:left" id="stat_article_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Chars:</td>
                    <td style="text-align:left" id="stat_typein"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Categories:</td>
                    <td style="text-align:left" id="stat_cate_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Tags:</td>
                    <td style="text-align:left" id="stat_tag_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Last update:</td>
                    <td style="text-align:left" id="stat_last_update"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="docpanel" class="myhide new_font">
        <div id="articlesearch" class="input-group">
            <input id="articlesearchtext" type="text" class="form-control" autocomplete="off" placeholder="search">
            <div class="input-group-append">
                <button id="cleanbut" class="btn btn-light" type="button" title="clear search">cls</button>
                <button id="categories" class="btn btn-light" type="button">cates</button>
                <button id="tags" class="btn btn-light" type="button" title="all tags">tags</button>
                <button id="articlesearchbut" class="btn btn-light" type="button" title="search">sch</button>
            </div>
        </div>
        <div class="tgs myhide" id="all_cates">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All categories:</span>
            <br>
        </div>
        <div class="tgs myhide" id="all_tags">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All tags:</span>
            <br>
        </div>
    </div>

    <div id="sidetoccontainer" class="tochide unselectable new_font">
        <div id="block">
            <div id="percent" data-toggle="tooltip" data-placement="bottom" title="return to the top">0%</div>
        </div>
        <div id="sidetoc" class="unselectable markdown-body editormd-preview-container markdown-toc"></div>
    </div>
    <div id="md" class="myhide markdown-body editormd-html-preview">
        <p><div class="saying mb-4"><div class="saying-quote saying-left-quote">â€œ</div><div class="saying-quote saying-right-quote">â€</div></p>
<p>ç¿»è¯‘è‡ªå®˜æ–¹æ–‡æ¡£</p>
<p></div></p>

          <h2 id="3d10aa7d">Writing Middleware</h2><p>ä¸­é—´ä»¶èƒ½å¤Ÿåœ¨è¯·æ±‚å“åº”å‘¨æœŸä¸­è®¿é—® <a href="http://www.expressjs.com.cn/en/4x/api.html#req">request object</a> (<code>req</code>)ï¼Œå’Œ <a href="http://www.expressjs.com.cn/en/4x/api.html#res">response object</a> (<code>res</code>)ï¼Œä»¥åŠ <code>next</code>æ–¹æ³•ã€‚<code>next</code>æ–¹æ³•ç”¨äºåœ¨è·¯ç”±è¿‡ç¨‹ä¸­æ‰§è¡Œå½“å‰ä¸­é—´ä»¶ç´§æ¥ç€çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚</p>
<p>ä¸­é—´ä»¶èƒ½å¤Ÿå®Œæˆä»¥ä¸‹äº‹æƒ…ï¼š</p>
<ul>
<li>Execute any code.</li>
<li>Make changes to the request and the response objects.</li>
<li>End the request-response cycle.</li>
<li>Call the next middleware in the stack.</li>
</ul>
<p>å¦‚æœå½“å‰ä¸­é—´ä»¶ä¸ç»“æŸè¯¥æ¬¡è¯·æ±‚å“åº”å‘¨æœŸï¼Œå®ƒå¿…é¡»è°ƒç”¨nextæ–¹æ³•ï¼Œå°†æ§åˆ¶ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå¦åˆ™è¯·æ±‚ä¼šè¢«æŒ‚èµ·ã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºäº†ä¸­é—´ä»¶åŠŸèƒ½çš„åŸºæœ¬å…ƒç´ ï¼š</p>
<p>
        <div class="_showpic_5d02eacc showpicbtn">Loading images >></div>
        <img href=https://image.youyinnn.top/20191003170602.png class="_pic_5d02eacc hidepic" picId="5d02eacc"></img>
        <script>
            {
                let imgself5d02eaccs = document.getElementsByClassName('_pic_5d02eacc')
                let showpicbtn5d02eaccs = document.getElementsByClassName('_showpic_5d02eacc')
                let isInViewPortOfTwo5d02eacc = function () {
                    const viewPortHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight 
                    const top = imgself5d02eaccs[0].getBoundingClientRect() && imgself5d02eaccs[0].getBoundingClientRect().top
                    if (top  <= viewPortHeight + 300) {
                        for (el of imgself5d02eaccs) {
                            el.src = el.getAttribute('href')
                            el.classList.add('showpic')
                            window.removeEventListener('scroll', isInViewPortOfTwo5d02eacc)
                            isInViewPortOfTwo5d02eacc = null
                        }
                        for (el of showpicbtn5d02eaccs) {
                            el.style.display = 'none'
                        }
                    }
                }
                window.addEventListener('scroll', isInViewPortOfTwo5d02eacc)
            }
        </script>
    </p>

          <h3 id="1ba10272">Example:  Middleware function myLogger</h3><p>è¿™é‡Œæ˜¯ä¸€ä¸ªç®€å•çš„â€œmyLoggerâ€ä¸­é—´ä»¶ï¼Œä½œç”¨ä»…ä»…åªæ˜¯åœ¨æœ‰è¯·æ±‚è¿›æ¥çš„æ—¶å€™æ‰“å°ã€‚</p>
<pre><code class="language-javascript">var myLogger = function (req, res, next) {
  console.log(&#39;LOGGED&#39;)
  next()
}</code></pre>
<p>æ–¹æ³•çš„æœ€åä¸€è¡Œè°ƒç”¨äº†<code>next()</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸æ˜¯Node.jsæˆ–è€…Express APIé‡Œçš„å‡½æ•°ï¼Œè€Œæ˜¯ä»ç¬¬ä¸‰ä¸ªæ–¹æ³•å‚æ•°ä¼ è¿›æ¥çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶çš„åç§°ï¼Œå°†è¿™ä¸ªå‚æ•°å½“ä½œæ–¹æ³•è°ƒç”¨å°±æ˜¯åœ¨è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼›ã€‚</p>
<p>ä¸ºäº†åŠ è½½ä¸­é—´ä»¶ï¼Œè°ƒç”¨<code>app.use()</code>ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç å°†<code>myLogger</code>ä¸­é—´ä»¶åŠ è½½åˆ°æ ¹è·¯å¾„ä¸Šã€‚</p>
<pre><code class="language-javascript">var express = require(&#39;express&#39;)
var app = express()

var myLogger = function (req, res, next) {
  console.log(&#39;LOGGED&#39;)
  next()
}

app.use(myLogger)

app.get(&#39;/&#39;, function (req, res) {
  res.send(&#39;Hello World!&#39;)
})

app.listen(3000)</code></pre>
<p>ä¸­é—´ä»¶åŠ è½½çš„é¡ºåºå¾ˆé‡è¦ï¼šå…ˆåŠ è½½çš„ä¸­é—´ä»¶å…¶æ–¹æ³•å…ˆè¢«æ‰§è¡Œã€‚</p>
<p>å¦‚æœ<code>myLogger</code>æ˜¯åœ¨â€œè·¯ç”±åˆ°æ ¹è·¯å¾„â€ä¹‹ååŠ è½½çš„è¯ï¼Œé‚£ä¹ˆä»»ä½•è¯·æ±‚éƒ½ä¸ä¼šè®¿é—®åˆ°å®ƒï¼Œå› ä¸ºæ ¹è·¯å¾„è·¯ç”±å‘¨æœŸå·²ç»ç»“æŸäº†ã€‚</p>

          <h3 id="2aae19b2">Example: Middleware function requestTime</h3><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè®°å½•è¯·æ±‚æ—¶é—´çš„ä¸­é—´ä»¶ï¼š</p>
<pre><code class="language-javascript">var requestTime = function (req, res, next) {
  req.requestTime = Date.now()
  next()
}</code></pre>
<p>å›è°ƒæ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨è·¯ç”±æ–¹æ³•ä¸Šçš„å‚æ•°ï¼Œå»æ·»åŠ å±æ€§åˆ°<code>req</code>ä¸Šï¼š</p>
<pre><code class="language-javascript">var express = require(&#39;express&#39;)
var app = express()

var requestTime = function (req, res, next) {
  req.requestTime = Date.now()
  next()
}

app.use(requestTime)

app.get(&#39;/&#39;, function (req, res) {
  var responseText = &#39;Hello World!&lt;br&gt;&#39;
  responseText += &#39;&lt;small&gt;Requested at: &#39; + req.requestTime + &#39;&lt;/small&gt;&#39;
  res.send(responseText)
})

app.listen(3000)</code></pre>

          <h3 id="c4ebc8c1">Configurable middleware</h3><p>å¦‚æœä½ éœ€è¦ä½ çš„ä¸­é—´ä»¶å¯ä»¥é…ç½®çš„è¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥è¿™æ ·åšï¼š</p>
<p>File: <code>my-middleware.js</code></p>
<pre><code class="language-javascript">module.exports = function(options) {
  return function(req, res, next) {
    // Implement the middleware function based on the options object
    next()
  }
}</code></pre>
<p>ç„¶ååœ¨è£…è½½çš„æ—¶å€™æŒ‡å®šå‚æ•°ï¼š</p>
<pre><code class="language-javascript">var mw = require(&#39;./my-middleware.js&#39;)

app.use(mw({ option1: &#39;1&#39;, option2: &#39;2&#39; }))</code></pre>
<p>ä¸­é—´ä»¶<a href="https://github.com/expressjs/cookie-session">cookie-session</a> å’Œ <a href="https://github.com/expressjs/compression">compression</a> éƒ½æ˜¯ä»¥è¿™æ ·çš„å½¢åŠ¿å»é…ç½®çš„ã€‚</p>

    </div>
    <div id="scriptsearcher" class="myhide input-group new_font">
        <input id="searchtext" type="text" class="form-control" placeholder="keywords" autocomplete="off">
        <div class="input-group-append">
            <button id="searchbut" class="btn btn-dark" type="button">Search</button>
        </div>
    </div>

    <div id="bbt" class="myhide new_font">
        <a id="toc" style="display: none;" class="myhide" href="javascript:void(0);" data-toggle="tooltip" data-placement="left" title="show/hide Toc">Toc</a>
        <a id="gohub" href="#" target="_blank" data-toggle="tooltip" data-placement="bottom" title="view this at github">unuse</a>
    </div>

    <div id="share_png_panel" class="myhide">
        <div id="share_curtain"></div>
        <div id="png_box"></div>
        <button id="share_png_paned_close" class="btn btn-dark">Close</button>
    </div>

</body>

</html>