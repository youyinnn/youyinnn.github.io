<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="baidu-site-verification" content="l09YSIpJQW" />
    <meta name="referrer" content="origin">
    <title>blog | youyinnn</title>
    <script src="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/myjs/loadscripts.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/myjs/jump-1.3.js"></script>
    <link rel="bookmark" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="stylesheet" href="/mycss/style.css">

    <script src="/resources/resources.js"></script>
    <script src="/myjs/scriptlist.js"></script>
</head>

<body>

    <ol id="topbar" class="breadcrumb unselectable new_font">
        <p style="color:rgb(214, 214, 214); padding-right: 1rem;">
            <button id="egg" class="egg">ğŸš€</button>&nbsp;&nbsp;&nbsp;&nbsp;&gt;</p>
        <li class="breadcrumb-item">
            <spen id="homebut" href="javaScript:void(0)" class="ah">-home</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="articlesbut" href="javaScript:void(0)" class="ah">-articles</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="scriptbut" href="javaScript:void(0)" class="ah">-scripts</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="todobut" href="javaScript:void(0)" class="ah">-todos</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="resumebut" href="javaScript:void(0)" class="ah">-resume</spen>
        </li>
        <li class="breadcrumb-item dropdown">
            <spen href="javaScript:void(0)" class="ah" role="button" id="friendlinkedbut" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">-friends</spen>
            <div id="fldd" class="dropdown-menu" aria-labelledby="friendlinkedbut" style="border-radius: initial;"></div>
        </li>

        <div id="hb" data-toggle="tooltip" data-placement="bottom" title="show/hide TopBar">

        </div>
    </ol>

    <div id="homepage" class="unselectable new_font myhide">
        <div id="homepage-center">
            <div id="slogan">
                <i id="wolf-logo" style="font-style: normal;" class="mr-4">ğŸŒ‘</i><span id="slogan-text"></span>
            </div>
            <div id="homepage-btn">
                <div id="showmore"> &nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;&nbsp; About Me & This Blog</div>
                <div id="showhacknical"> &nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;&nbsp; My Github Analysis</div>
                <div id="toarticles"> &nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;&nbsp; My Tech Articles</div>
            </div>
        </div>
        <div id="ifwrapper" class="hacknical_hide">
            <iframe id="hacknical_github_analysis" frameborder="0"></iframe>
        </div>
    </div>

    <div id="articles_side_panel" class="unselectable myhide new_font">
        <div id="cates_tree_head">Article Categories</div>
        <div id="cates_tree_body"></div>
        <div id="blog_statistic_head">Blog Statistics</div>
        <table id="blog_statistic_body" class="myhide">
            <tbody>
                <tr>
                    <td style="text-align:right">Online:</td>
                    <td style="text-align:left" id="stat_running"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Article:</td>
                    <td style="text-align:left" id="stat_article_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Chars:</td>
                    <td style="text-align:left" id="stat_typein"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Categories:</td>
                    <td style="text-align:left" id="stat_cate_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Tags:</td>
                    <td style="text-align:left" id="stat_tag_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Last update:</td>
                    <td style="text-align:left" id="stat_last_update"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="docpanel" class="myhide new_font">
        <div id="articlesearch" class="input-group">
            <input id="articlesearchtext" type="text" class="form-control" autocomplete="off" placeholder="search">
            <div class="input-group-append">
                <button id="cleanbut" class="btn btn-light" type="button" title="clear search">cls</button>
                <button id="categories" class="btn btn-light" type="button">cates</button>
                <button id="tags" class="btn btn-light" type="button" title="all tags">tags</button>
                <button id="articlesearchbut" class="btn btn-light" type="button" title="search">sch</button>
            </div>
        </div>
        <div class="tgs myhide" id="all_cates">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All categories:</span>
            <br>
        </div>
        <div class="tgs myhide" id="all_tags">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All tags:</span>
            <br>
        </div>
    </div>

    <div id="sidetoccontainer" class="tochide unselectable new_font">
        <div id="block">
            <div id="percent" data-toggle="tooltip" data-placement="bottom" title="return to the top">0%</div>
        </div>
        <div id="sidetoc" class="unselectable markdown-body editormd-preview-container markdown-toc"></div>
    </div>
    <div id="md" class="myhide markdown-body editormd-html-preview">
        
          <h3 id="5a8dbf85">Topic &amp; Partition</h3><p>kafkaä¸­çš„Messageä»¥topicä¸ºåˆ†ç±»å»ç»„ç»‡çš„ï¼Œæ¯ä¸ªtopicåˆå¯ä»¥åˆ†ä¸ºä¸åŒçš„partitionå»å­˜å‚¨ï¼š</p>
<p>
        <div class="_showpic_893f9370 showpicbtn">Loading images >></div>
        <img href=http://kafka.apache.org/20/images/log_anatomy.png class="_pic_893f9370 hidepic" picId="893f9370"></img>
        <script>
            {
                let imgself893f9370s = document.getElementsByClassName('_pic_893f9370')
                let showpicbtn893f9370s = document.getElementsByClassName('_showpic_893f9370')
                let isInViewPortOfTwo893f9370 = function () {
                    const viewPortHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight 
                    const top = imgself893f9370s[0].getBoundingClientRect() && imgself893f9370s[0].getBoundingClientRect().top
                    if (top  <= viewPortHeight + 300) {
                        for (el of imgself893f9370s) {
                            el.src = el.getAttribute('href')
                            el.classList.add('showpic')
                            window.removeEventListener('scroll', isInViewPortOfTwo893f9370)
                            isInViewPortOfTwo893f9370 = null
                        }
                        for (el of showpicbtn893f9370s) {
                            el.style.display = 'none'
                        }
                    }
                }
                window.addEventListener('scroll', isInViewPortOfTwo893f9370)
            }
        </script>
    </p>
<p>æˆ‘ä»¬å¼•ç”¨å®˜æ–¹çš„Introductionä¸­çš„ä¸€èŠ‚ï¼Œçœ‹å®˜æ–¹æ˜¯æ€ä¹ˆè§£é‡Šçš„ï¼š</p>
<p>Each partition is an ordered, immutable sequence of records that is continually appended toâ€”a structured commit log. The records in the partitions are each assigned a sequential id number called the <em>offset</em> that uniquely identifies each record within the partition.</p>
<p>æ¯ä¸ªåˆ†åŒºéƒ½æ˜¯ä¸€ä¸ª<strong>æœ‰åºçš„ï¼Œä¸å¯å˜çš„è®°å½•åºåˆ—</strong>ï¼Œä¸æ–­é™„åŠ åˆ°ç»“æ„åŒ–çš„æäº¤æ—¥å¿—ä¸­ã€‚åˆ†åŒºä¸­çš„è®°å½•æ¯ä¸ªéƒ½åˆ†é…äº†ä¸€ä¸ªç§°ä¸ºåç§»çš„é¡ºåºIDå·ï¼Œå®ƒå”¯ä¸€åœ°æ ‡è¯†åˆ†åŒºä¸­çš„æ¯ä¸ªè®°å½•ã€‚</p>
<p>The Kafka cluster durably persists all published recordsâ€”whether or not they have been consumedâ€”using a configurable retention period. For example, if the retention policy is set to two days, then for the two days after a record is published, it is available for consumption, after which it will be discarded to free up space. Kafka&#39;s performance is effectively constant with respect to data size so storing data for a long time is not a problem.</p>
<p>Kafkaé›†ç¾¤ä½¿ç”¨<strong>å¯é…ç½®çš„ä¿ç•™æœŸï¼ˆconfigurable retention periodï¼‰</strong>ï¼Œæ¥æŒä¹…ä¿å­˜æ‰€æœ‰å·²å‘å¸ƒçš„è®°å½•ï¼Œæ— è®ºæ˜¯å¦å·²<strong>æ¶ˆè´¹ï¼ˆconsumeï¼‰</strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä¿ç•™ç­–ç•¥è®¾ç½®ä¸ºä¸¤å¤©ï¼Œåˆ™åœ¨å‘å¸ƒè®°å½•åçš„ä¸¤å¤©å†…ï¼Œå®ƒéƒ½æ˜¯å¯ä¾›æ¶ˆè´¹ï¼ˆconsumeï¼‰çš„ï¼Œä¹‹åå°†è¢«<strong>ä¸¢å¼ƒï¼ˆdiscardedï¼‰</strong>ä»¥é‡Šæ”¾ç©ºé—´ã€‚Kafkaçš„æ€§èƒ½åœ¨æ•°æ®å¤§å°æ–¹é¢å®é™…ä¸Šæ˜¯æ’å®šçš„ï¼Œå› æ­¤é•¿æ—¶é—´å­˜å‚¨æ•°æ®ä¸æ˜¯é—®é¢˜ã€‚</p>
<p>In fact, the only metadata retained on a per-consumer basis is the offset or position of that consumer in the log. This offset is controlled by the consumer: normally a consumer will advance its offset linearly as it reads records, but, in fact, since the position is controlled by the consumer it can consume records in any order it likes. For example a consumer can reset to an older offset to reprocess data from the past or skip ahead to the most recent record and start consuming from &quot;now&quot;.</p>
<p>å®é™…ä¸Šï¼ŒåŸºäºæ¯ä¸ªæ¶ˆè´¹è€…ä¿ç•™çš„å”¯ä¸€å…ƒæ•°æ®æ˜¯è¯¥æ¶ˆè´¹è€…åœ¨æ—¥å¿—ä¸­çš„<strong>åç§»æˆ–ä½ç½®ï¼ˆoffset/positionï¼‰</strong>ã€‚</p>
<p>è¿™ç§åç§»ç”±æ¶ˆè´¹è€…æ§åˆ¶ï¼šé€šå¸¸æ¶ˆè´¹è€…åœ¨è¯»å–è®°å½•æ—¶ä¼šçº¿æ€§åœ°æé«˜å…¶åç§»é‡ï¼Œä½†äº‹å®ä¸Šï¼Œç”±äºè¯¥ä½ç½®ç”±æ¶ˆè´¹è€…æ§åˆ¶ï¼Œå› æ­¤å®ƒå¯ä»¥æŒ‰ç…§è‡ªå·±å–œæ¬¢çš„ä»»ä½•é¡ºåºæ¶ˆè´¹è®°å½•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ¶ˆè´¹è€…å¯ä»¥é‡ç½®ä¸ºè¾ƒæ—§çš„åç§»é‡æ¥é‡æ–°å¤„ç†è¿‡å»çš„æ•°æ®ï¼Œæˆ–è€…è·³åˆ°æœ€è¿‘çš„è®°å½•å¹¶ä»â€œç°åœ¨â€å¼€å§‹æ¶ˆè´¹ã€‚</p>
<p>This combination of features means that Kafka consumers are very cheapâ€”they can come and go without much impact on the cluster or on other consumers. For example, you can use our command line tools to &quot;tail&quot; the contents of any topic without changing what is consumed by any existing consumers.</p>
<p>è¿™äº›åŠŸèƒ½ç»„åˆæ„å‘³ç€Kafkaæ¶ˆè´¹è€…æ˜¯<strong>â€œæˆæœ¬è¾ƒä½çš„â€</strong>ï¼šä»–ä»¬å¯ä»¥æ¥æ¥å¾€å¾€å¯¹é›†ç¾¤æˆ–å…¶ä»–æ¶ˆè´¹è€…æ²¡æœ‰å¤ªå¤§å½±å“ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„å‘½ä»¤è¡Œå·¥å…·â€œtailâ€ä»»ä½•ä¸»é¢˜çš„å†…å®¹ï¼Œè€Œæ— éœ€æ›´æ”¹ä»»ä½•ç°æœ‰ä½¿ç”¨è€…æ‰€æ¶ˆè€—çš„å†…å®¹ã€‚</p>
<p>The partitions in the log serve several purposes. First, they allow the log to scale beyond a size that will fit on a single server. Each individual partition must fit on the servers that host it, but a topic may have many partitions so it can handle an arbitrary amount of data. Second they act as the unit of parallelismâ€”more on that in a bit.</p>
<p>æ—¥å¿—ä¸­çš„åˆ†åŒºæœ‰å¤šç§ç”¨é€”ï¼š</p>
<p>é¦–å…ˆï¼Œå®ƒä»¬å…è®¸æ—¥å¿—æ‰©å±•åˆ°è¶…å‡ºé€‚åˆå•ä¸ªæœåŠ¡å™¨çš„å¤§å°ã€‚æ¯ä¸ªå•ç‹¬çš„åˆ†åŒºå¿…é¡»é€‚åˆæ‰˜ç®¡å®ƒçš„æœåŠ¡å™¨ï¼Œä½†ä¸»é¢˜å¯èƒ½æœ‰è®¸å¤šåˆ†åŒºï¼Œå› æ­¤å®ƒå¯ä»¥å¤„ç†ä»»æ„æ•°é‡çš„æ•°æ®ã€‚</p>
<p>å…¶æ¬¡ï¼Œå®ƒä»¬å……å½“äº†å¹¶è¡Œæ€§çš„å•ä½ï¼Œæ›´å¤šæ˜¯å› ä¸ºè¿™ä¸ªåŸå› ï¼</p>

          <h3 id="8576123a">Partition</h3><p>ä¸Šé¢ä»å¤§æ–¹å‘ä¸Šä»‹ç»äº†Messageçš„å­˜å‚¨æ˜¯å¦‚ä½•workçš„ï¼Œæˆ‘ä»¬å†æ¥å…³æ³¨ä¸€ä¸‹å­˜å‚¨çš„ç»†èŠ‚</p>
<p>Partitionä¸­çš„æ¯æ¡Messageç”±offsetæ¥è¡¨ç¤ºå®ƒåœ¨è¿™ä¸ªpartitionä¸­çš„åç§»é‡ï¼Œè¿™ä¸ªoffsetä¸æ˜¯è¯¥Messageåœ¨partitionæ•°æ®æ–‡ä»¶ä¸­çš„å®é™…å­˜å‚¨ä½ç½®ï¼Œè€Œæ˜¯é€»è¾‘ä¸Šä¸€ä¸ªå€¼ï¼Œå®ƒå”¯ä¸€ç¡®å®šäº†partitionä¸­çš„ä¸€æ¡Messageã€‚å› æ­¤ï¼Œå¯ä»¥è®¤ä¸ºoffsetæ˜¯partitionä¸­Messageçš„idã€‚partitionä¸­çš„æ¯æ¡MessageåŒ…å«äº†ä»¥ä¸‹ä¸‰ä¸ªå±æ€§ï¼š</p>
<ul>
<li><p>offset</p>
</li>
<li><p>MessageSize</p>
</li>
<li><p>data</p>
</li>
</ul>
<p>å…¶ä¸­offsetä¸ºlongå‹ï¼ŒMessageSizeä¸ºint32ï¼Œè¡¨ç¤ºdataæœ‰å¤šå¤§ï¼Œdataä¸ºmessageçš„å…·ä½“å†…å®¹ã€‚å®ƒçš„æ ¼å¼å’ŒKafkaé€šè®¯åè®®ä¸­ä»‹ç»çš„MessageSetæ ¼å¼æ˜¯ä¸€è‡´ã€‚</p>
<p>Partitionçš„æ•°æ®æ–‡ä»¶åˆ™åŒ…å«äº†è‹¥å¹²æ¡ä¸Šè¿°æ ¼å¼çš„Messageï¼ŒæŒ‰offsetç”±å°åˆ°å¤§æ’åˆ—åœ¨ä¸€èµ·ã€‚å®ƒçš„å®ç°ç±»ä¸ºFileMessageSetï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p>
<p>
        <div class="_showpic_20449ad4 showpicbtn">Loading images >></div>
        <img href=https://image.youyinnn.top/20181107151441.png class="_pic_20449ad4 hidepic" picId="20449ad4"></img>
        <script>
            {
                let imgself20449ad4s = document.getElementsByClassName('_pic_20449ad4')
                let showpicbtn20449ad4s = document.getElementsByClassName('_showpic_20449ad4')
                let isInViewPortOfTwo20449ad4 = function () {
                    const viewPortHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight 
                    const top = imgself20449ad4s[0].getBoundingClientRect() && imgself20449ad4s[0].getBoundingClientRect().top
                    if (top  <= viewPortHeight + 300) {
                        for (el of imgself20449ad4s) {
                            el.src = el.getAttribute('href')
                            el.classList.add('showpic')
                            window.removeEventListener('scroll', isInViewPortOfTwo20449ad4)
                            isInViewPortOfTwo20449ad4 = null
                        }
                        for (el of showpicbtn20449ad4s) {
                            el.style.display = 'none'
                        }
                    }
                }
                window.addEventListener('scroll', isInViewPortOfTwo20449ad4)
            }
        </script>
    </p>
<p>å®ƒçš„ä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li>append: æŠŠç»™å®šçš„ByteBufferMessageSetä¸­çš„Messageå†™å…¥åˆ°è¿™ä¸ªæ•°æ®æ–‡ä»¶ä¸­ã€‚</li>
<li>searchFor: ä»æŒ‡å®šçš„startingPositionå¼€å§‹æœç´¢æ‰¾åˆ°ç¬¬ä¸€ä¸ªMessageå…¶offsetæ˜¯å¤§äºæˆ–è€…ç­‰äºæŒ‡å®šçš„offsetï¼Œå¹¶è¿”å›å…¶åœ¨æ–‡ä»¶ä¸­çš„ä½ç½®Positionã€‚å®ƒçš„å®ç°æ–¹å¼æ˜¯ä»startingPositionå¼€å§‹è¯»å–12ä¸ªå­—èŠ‚ï¼Œåˆ†åˆ«æ˜¯å½“å‰MessageSetçš„offsetå’Œsizeã€‚å¦‚æœå½“å‰offsetå°äºæŒ‡å®šçš„offsetï¼Œé‚£ä¹ˆå°†positionå‘åç§»åŠ¨LogOverHead+MessageSizeï¼ˆå…¶ä¸­LogOverHeadä¸ºoffset+messagesizeï¼Œä¸º12ä¸ªå­—èŠ‚ï¼‰ã€‚</li>
<li>readï¼šå‡†ç¡®åå­—åº”è¯¥æ˜¯sliceï¼Œå®ƒæˆªå–å…¶ä¸­ä¸€éƒ¨åˆ†è¿”å›ä¸€ä¸ªæ–°çš„FileMessageSetã€‚å®ƒä¸ä¿è¯æˆªå–çš„ä½ç½®æ•°æ®çš„å®Œæ•´æ€§ã€‚</li>
<li>sizeInBytes: è¡¨ç¤ºè¿™ä¸ªFileMessageSetå æœ‰äº†å¤šå°‘å­—èŠ‚çš„ç©ºé—´ã€‚</li>
<li>truncateTo: æŠŠè¿™ä¸ªæ–‡ä»¶æˆªæ–­ï¼Œè¿™ä¸ªæ–¹æ³•ä¸ä¿è¯æˆªæ–­ä½ç½®çš„Messageçš„å®Œæ•´æ€§ã€‚</li>
<li>readInto: ä»æŒ‡å®šçš„ç›¸å¯¹ä½ç½®å¼€å§‹æŠŠæ–‡ä»¶çš„å†…å®¹è¯»å–åˆ°å¯¹åº”çš„ByteBufferä¸­ã€‚</li>
</ul>
<p>æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœä¸€ä¸ªpartitionåªæœ‰ä¸€ä¸ªæ•°æ®æ–‡ä»¶ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p>
<blockquote>
<ul>
<li><p>æ–°æ•°æ®æ˜¯æ·»åŠ åœ¨æ–‡ä»¶æœ«å°¾ï¼ˆè°ƒç”¨FileMessageSetçš„appendæ–¹æ³•ï¼‰ï¼Œä¸è®ºæ–‡ä»¶æ•°æ®æ–‡ä»¶æœ‰å¤šå¤§ï¼Œè¿™ä¸ªæ“ä½œæ°¸è¿œéƒ½æ˜¯O(1)çš„ã€‚</p>
</li>
<li><p>æŸ¥æ‰¾æŸä¸ªoffsetçš„Messageï¼ˆè°ƒç”¨FileMessageSetçš„searchForæ–¹æ³•ï¼‰æ˜¯é¡ºåºæŸ¥æ‰¾çš„ã€‚å› æ­¤ï¼Œå¦‚æœæ•°æ®æ–‡ä»¶å¾ˆå¤§çš„è¯ï¼ŒæŸ¥æ‰¾çš„æ•ˆç‡å°±ä½ã€‚</p>
</li>
</ul>
</blockquote>
<p>é‚£Kafkaæ˜¯å¦‚ä½•è§£å†³æŸ¥æ‰¾æ•ˆç‡çš„çš„é—®é¢˜å‘¢ï¼Ÿæœ‰ä¸¤å¤§æ³•å®ï¼š1) åˆ†æ®µ 2) ç´¢å¼•ã€‚</p>

          <h4 id="2ae22d6d">æ•°æ®æ–‡ä»¶çš„åˆ†æ®µ</h4><p>Kafkaè§£å†³æŸ¥è¯¢æ•ˆç‡çš„æ‰‹æ®µä¹‹ä¸€æ˜¯å°†æ•°æ®æ–‡ä»¶åˆ†æ®µï¼Œæ¯”å¦‚æœ‰100æ¡Messageï¼Œå®ƒä»¬çš„offsetæ˜¯ä»0åˆ°99ã€‚</p>
<p>å‡è®¾å°†æ•°æ®æ–‡ä»¶åˆ†æˆ5æ®µï¼Œç¬¬ä¸€æ®µä¸º0-19ï¼Œç¬¬äºŒæ®µä¸º20-39ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæ¯æ®µæ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æ•°æ®æ–‡ä»¶é‡Œé¢ï¼Œæ•°æ®æ–‡ä»¶ä»¥è¯¥æ®µä¸­æœ€å°çš„offsetå‘½åã€‚è¿™æ ·åœ¨æŸ¥æ‰¾æŒ‡å®šoffsetçš„Messageçš„æ—¶å€™ï¼Œç”¨äºŒåˆ†æŸ¥æ‰¾å°±å¯ä»¥å®šä½åˆ°è¯¥Messageåœ¨å“ªä¸ªæ®µä¸­ã€‚</p>

          <h4 id="8478f87c">ä¸ºæ•°æ®æ–‡ä»¶å»ºç´¢å¼•</h4><p>æ•°æ®æ–‡ä»¶åˆ†æ®µä½¿å¾—å¯ä»¥åœ¨ä¸€ä¸ªè¾ƒå°çš„æ•°æ®æ–‡ä»¶ä¸­æŸ¥æ‰¾å¯¹åº”offsetçš„Messageäº†ï¼Œä½†æ˜¯è¿™ä¾ç„¶éœ€è¦é¡ºåºæ‰«ææ‰èƒ½æ‰¾åˆ°å¯¹åº”offsetçš„Messageã€‚</p>
<p>ä¸ºäº†è¿›ä¸€æ­¥æé«˜æŸ¥æ‰¾çš„æ•ˆç‡ï¼ŒKafkaä¸ºæ¯ä¸ªåˆ†æ®µåçš„æ•°æ®æ–‡ä»¶å»ºç«‹äº†ç´¢å¼•æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸æ•°æ®æ–‡ä»¶çš„åå­—æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æ–‡ä»¶æ‰©å±•åä¸º.indexã€‚</p>
<p>ç´¢å¼•æ–‡ä»¶ä¸­åŒ…å«è‹¥å¹²ä¸ªç´¢å¼•æ¡ç›®ï¼Œæ¯ä¸ªæ¡ç›®è¡¨ç¤ºæ•°æ®æ–‡ä»¶ä¸­ä¸€æ¡Messageçš„ç´¢å¼•ã€‚ç´¢å¼•åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼ˆå‡ä¸º4ä¸ªå­—èŠ‚çš„æ•°å­—ï¼‰ï¼Œåˆ†åˆ«ä¸ºç›¸å¯¹offsetå’Œpositionã€‚</p>
<p>ç›¸å¯¹offsetï¼šå› ä¸ºæ•°æ®æ–‡ä»¶åˆ†æ®µä»¥åï¼Œæ¯ä¸ªæ•°æ®æ–‡ä»¶çš„èµ·å§‹offsetä¸ä¸º0ï¼Œç›¸å¯¹offsetè¡¨ç¤ºè¿™æ¡Messageç›¸å¯¹äºå…¶æ‰€å±æ•°æ®æ–‡ä»¶ä¸­æœ€å°çš„offsetçš„å¤§å°ã€‚</p>
<p>ä¸¾ä¾‹ï¼Œåˆ†æ®µåçš„ä¸€ä¸ªæ•°æ®æ–‡ä»¶çš„offsetæ˜¯ä»20å¼€å§‹ï¼Œé‚£ä¹ˆoffsetä¸º25çš„Messageåœ¨indexæ–‡ä»¶ä¸­çš„ç›¸å¯¹offsetå°±æ˜¯25-20 = 5ã€‚å­˜å‚¨ç›¸å¯¹offsetå¯ä»¥å‡å°ç´¢å¼•æ–‡ä»¶å ç”¨çš„ç©ºé—´ã€‚</p>
<p>positionï¼Œè¡¨ç¤ºè¯¥æ¡Messageåœ¨æ•°æ®æ–‡ä»¶ä¸­çš„ç»å¯¹ä½ç½®ã€‚åªè¦æ‰“å¼€æ–‡ä»¶å¹¶ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåˆ°è¿™ä¸ªpositionå°±å¯ä»¥è¯»å–å¯¹åº”çš„Messageäº†ã€‚</p>
<p>indexæ–‡ä»¶ä¸­å¹¶æ²¡æœ‰ä¸ºæ•°æ®æ–‡ä»¶ä¸­çš„æ¯æ¡Messageå»ºç«‹ç´¢å¼•ï¼Œè€Œæ˜¯é‡‡ç”¨äº†ç¨€ç–å­˜å‚¨çš„æ–¹å¼ï¼Œæ¯éš”ä¸€å®šå­—èŠ‚çš„æ•°æ®å»ºç«‹ä¸€æ¡ç´¢å¼•ã€‚è¿™æ ·é¿å…äº†ç´¢å¼•æ–‡ä»¶å ç”¨è¿‡å¤šçš„ç©ºé—´ï¼Œä»è€Œå¯ä»¥å°†ç´¢å¼•æ–‡ä»¶ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚ä½†ç¼ºç‚¹æ˜¯æ²¡æœ‰å»ºç«‹ç´¢å¼•çš„Messageä¹Ÿä¸èƒ½ä¸€æ¬¡å®šä½åˆ°å…¶åœ¨æ•°æ®æ–‡ä»¶çš„ä½ç½®ï¼Œä»è€Œéœ€è¦åšä¸€æ¬¡é¡ºåºæ‰«æï¼Œä½†æ˜¯è¿™æ¬¡é¡ºåºæ‰«æçš„èŒƒå›´å°±å¾ˆå°äº†ã€‚</p>
<p>åœ¨Kafkaä¸­ï¼Œç´¢å¼•æ–‡ä»¶çš„å®ç°ç±»ä¸ºOffsetIndexï¼Œå®ƒçš„ç±»å›¾å¦‚ä¸‹ï¼š</p>
<p>
        <div class="_showpic_3bd5c866 showpicbtn">Loading images >></div>
        <img href=https://image.youyinnn.top/20181107151802.png class="_pic_3bd5c866 hidepic" picId="3bd5c866"></img>
        <script>
            {
                let imgself3bd5c866s = document.getElementsByClassName('_pic_3bd5c866')
                let showpicbtn3bd5c866s = document.getElementsByClassName('_showpic_3bd5c866')
                let isInViewPortOfTwo3bd5c866 = function () {
                    const viewPortHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight 
                    const top = imgself3bd5c866s[0].getBoundingClientRect() && imgself3bd5c866s[0].getBoundingClientRect().top
                    if (top  <= viewPortHeight + 300) {
                        for (el of imgself3bd5c866s) {
                            el.src = el.getAttribute('href')
                            el.classList.add('showpic')
                            window.removeEventListener('scroll', isInViewPortOfTwo3bd5c866)
                            isInViewPortOfTwo3bd5c866 = null
                        }
                        for (el of showpicbtn3bd5c866s) {
                            el.style.display = 'none'
                        }
                    }
                }
                window.addEventListener('scroll', isInViewPortOfTwo3bd5c866)
            }
        </script>
    </p>
<p>ä¸»è¦çš„æ–¹æ³•æœ‰ï¼š</p>
<ul>
<li>appendæ–¹æ³•ï¼Œæ·»åŠ ä¸€å¯¹offsetå’Œpositionåˆ°indexæ–‡ä»¶ä¸­ï¼Œè¿™é‡Œçš„offsetå°†ä¼šè¢«è½¬æˆç›¸å¯¹çš„offsetã€‚</li>
<li>lookup, ç”¨äºŒåˆ†æŸ¥æ‰¾çš„æ–¹å¼å»æŸ¥æ‰¾å°äºæˆ–ç­‰äºç»™å®šoffsetçš„æœ€å¤§çš„é‚£ä¸ªoffset</li>
</ul>

          <h3 id="8297b247">å°ç»“</h3><p>æˆ‘ä»¬ä»¥å‡ å¼ å›¾æ¥æ€»ç»“ä¸€ä¸‹Messageæ˜¯å¦‚ä½•åœ¨Kafkaä¸­å­˜å‚¨çš„ï¼Œä»¥åŠå¦‚ä½•æŸ¥æ‰¾æŒ‡å®šoffsetçš„Messageçš„ã€‚</p>
<p>Messageæ˜¯æŒ‰ç…§topicæ¥ç»„ç»‡ï¼Œæ¯ä¸ªtopicå¯ä»¥åˆ†æˆå¤šä¸ªçš„partitionï¼Œæ¯”å¦‚ï¼šæœ‰5ä¸ªpartitionçš„åä¸ºä¸ºpage_visitsçš„topicçš„ç›®å½•ç»“æ„ä¸ºï¼š</p>
<p>
        <div class="_showpic_1cd587c showpicbtn">Loading images >></div>
        <img href=https://image.youyinnn.top/20181107151829.png class="_pic_1cd587c hidepic" picId="1cd587c"></img>
        <script>
            {
                let imgself1cd587cs = document.getElementsByClassName('_pic_1cd587c')
                let showpicbtn1cd587cs = document.getElementsByClassName('_showpic_1cd587c')
                let isInViewPortOfTwo1cd587c = function () {
                    const viewPortHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight 
                    const top = imgself1cd587cs[0].getBoundingClientRect() && imgself1cd587cs[0].getBoundingClientRect().top
                    if (top  <= viewPortHeight + 300) {
                        for (el of imgself1cd587cs) {
                            el.src = el.getAttribute('href')
                            el.classList.add('showpic')
                            window.removeEventListener('scroll', isInViewPortOfTwo1cd587c)
                            isInViewPortOfTwo1cd587c = null
                        }
                        for (el of showpicbtn1cd587cs) {
                            el.style.display = 'none'
                        }
                    }
                }
                window.addEventListener('scroll', isInViewPortOfTwo1cd587c)
            }
        </script>
    </p>
<p>partitionæ˜¯åˆ†æ®µçš„ï¼Œæ¯ä¸ªæ®µå«LogSegmentï¼ŒåŒ…æ‹¬äº†ä¸€ä¸ªæ•°æ®æ–‡ä»¶å’Œä¸€ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œä¸‹å›¾æ˜¯æŸä¸ªpartitionç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š</p>
<p>
        <div class="_showpic_c22fb765 showpicbtn">Loading images >></div>
        <img href=https://image.youyinnn.top/20181107151557.png class="_pic_c22fb765 hidepic" picId="c22fb765"></img>
        <script>
            {
                let imgselfc22fb765s = document.getElementsByClassName('_pic_c22fb765')
                let showpicbtnc22fb765s = document.getElementsByClassName('_showpic_c22fb765')
                let isInViewPortOfTwoc22fb765 = function () {
                    const viewPortHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight 
                    const top = imgselfc22fb765s[0].getBoundingClientRect() && imgselfc22fb765s[0].getBoundingClientRect().top
                    if (top  <= viewPortHeight + 300) {
                        for (el of imgselfc22fb765s) {
                            el.src = el.getAttribute('href')
                            el.classList.add('showpic')
                            window.removeEventListener('scroll', isInViewPortOfTwoc22fb765)
                            isInViewPortOfTwoc22fb765 = null
                        }
                        for (el of showpicbtnc22fb765s) {
                            el.style.display = 'none'
                        }
                    }
                }
                window.addEventListener('scroll', isInViewPortOfTwoc22fb765)
            }
        </script>
    </p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªpartitionæœ‰4ä¸ªLogSegmentã€‚</p>
<p>å€Ÿç”¨åšä¸»<a href="http://blog.csdn.net/lizhitao/">@lizhitao</a>åšå®¢ä¸Šçš„ä¸€å¼ å›¾æ¥å±•ç¤ºæ˜¯å¦‚ä½•æŸ¥æ‰¾Messageçš„ã€‚</p>
<p>
        <div class="_showpic_be896ce1 showpicbtn">Loading images >></div>
        <img href=https://image.youyinnn.top/20181107151736.png class="_pic_be896ce1 hidepic" picId="be896ce1"></img>
        <script>
            {
                let imgselfbe896ce1s = document.getElementsByClassName('_pic_be896ce1')
                let showpicbtnbe896ce1s = document.getElementsByClassName('_showpic_be896ce1')
                let isInViewPortOfTwobe896ce1 = function () {
                    const viewPortHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight 
                    const top = imgselfbe896ce1s[0].getBoundingClientRect() && imgselfbe896ce1s[0].getBoundingClientRect().top
                    if (top  <= viewPortHeight + 300) {
                        for (el of imgselfbe896ce1s) {
                            el.src = el.getAttribute('href')
                            el.classList.add('showpic')
                            window.removeEventListener('scroll', isInViewPortOfTwobe896ce1)
                            isInViewPortOfTwobe896ce1 = null
                        }
                        for (el of showpicbtnbe896ce1s) {
                            el.style.display = 'none'
                        }
                    }
                }
                window.addEventListener('scroll', isInViewPortOfTwobe896ce1)
            }
        </script>
    </p>
<p>æ¯”å¦‚è¦æŸ¥æ‰¾ç»å¯¹offsetä¸º7çš„Messageï¼š</p>
<p>é¦–å…ˆæ˜¯ç”¨äºŒåˆ†æŸ¥æ‰¾ç¡®å®šå®ƒæ˜¯åœ¨å“ªä¸ªLogSegmentä¸­ï¼Œè‡ªç„¶æ˜¯åœ¨ç¬¬ä¸€ä¸ªSegmentä¸­ã€‚<br>æ‰“å¼€è¿™ä¸ªSegmentçš„indexæ–‡ä»¶ï¼Œä¹Ÿæ˜¯ç”¨äºŒåˆ†æŸ¥æ‰¾æ‰¾åˆ°offsetå°äºæˆ–è€…ç­‰äºæŒ‡å®šoffsetçš„ç´¢å¼•æ¡ç›®ä¸­æœ€å¤§çš„é‚£ä¸ªoffsetã€‚è‡ªç„¶offsetä¸º6çš„é‚£ä¸ªç´¢å¼•æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ï¼Œé€šè¿‡ç´¢å¼•æ–‡ä»¶æˆ‘ä»¬çŸ¥é“offsetä¸º6çš„Messageåœ¨æ•°æ®æ–‡ä»¶ä¸­çš„ä½ç½®ä¸º9807ã€‚<br>æ‰“å¼€æ•°æ®æ–‡ä»¶ï¼Œä»ä½ç½®ä¸º9807çš„é‚£ä¸ªåœ°æ–¹å¼€å§‹é¡ºåºæ‰«æç›´åˆ°æ‰¾åˆ°offsetä¸º7çš„é‚£æ¡Messageã€‚</p>
<p><strong>è¿™å¥—æœºåˆ¶æ˜¯å»ºç«‹åœ¨offsetæ˜¯æœ‰åºçš„</strong>ã€‚ç´¢å¼•æ–‡ä»¶è¢«æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥æŸ¥æ‰¾çš„é€Ÿåº¦è¿˜æ˜¯å¾ˆå¿«çš„ã€‚</p>
<p>ä¸€å¥è¯ï¼Œ<strong>Kafkaçš„Messageå­˜å‚¨é‡‡ç”¨äº†åˆ†åŒº(partition)ï¼Œåˆ†æ®µ(LogSegment)å’Œç¨€ç–ç´¢å¼•è¿™å‡ ä¸ªæ‰‹æ®µæ¥è¾¾åˆ°äº†é«˜æ•ˆæ€§ã€‚</strong></p>
<blockquote>
<p>å‚è€ƒè‡ªï¼š</p>
<p><a href="http://kafka.apache.org/intro">http://kafka.apache.org/intro</a></p>
<p><a href="https://blog.csdn.net/jewes/article/details/42970799">https://blog.csdn.net/jewes/article/details/42970799</a></p>
</blockquote>

    </div>
    <div id="scriptsearcher" class="myhide input-group new_font">
        <input id="searchtext" type="text" class="form-control" placeholder="keywords" autocomplete="off">
        <div class="input-group-append">
            <button id="searchbut" class="btn btn-dark" type="button">Search</button>
        </div>
    </div>

    <div id="bbt" class="myhide new_font">
        <a id="toc" style="display: none;" class="myhide" href="javascript:void(0);" data-toggle="tooltip" data-placement="left" title="show/hide Toc">Toc</a>
        <a id="gohub" href="#" target="_blank" data-toggle="tooltip" data-placement="bottom" title="view this at github">unuse</a>
    </div>

    <div id="share_png_panel" class="myhide">
        <div id="share_curtain"></div>
        <div id="png_box"></div>
        <button id="share_png_paned_close" class="btn btn-dark">Close</button>
    </div>

</body>

</html>