<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="baidu-site-verification" content="l09YSIpJQW" />
    <meta name="referrer" content="origin">
    <title>blog | youyinnn</title>
    <link rel="bookmark" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="stylesheet" href="/mycss/style.css">

    <script src="/resources/resources.js"></script>
    <script src="/myjs/import.js"></script>
    <script>
        importJsBeforeLoad()
    </script>
</head>

<body>

    <ol id="topbar" class="breadcrumb unselectable new_font">
        <p style="color:rgb(214, 214, 214); padding-right: 1rem;">
            <button id="egg" class="egg em-svg em-rocket"></button>&nbsp;&nbsp;&nbsp;&nbsp;&gt;</p>
        <li class="breadcrumb-item">
            <spen id="homebut" href="javaScript:void(0)" class="ah">-home</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="articlesbut" href="javaScript:void(0)" class="ah">-articles</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="scriptbut" href="javaScript:void(0)" class="ah">-scripts</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="todobut" href="javaScript:void(0)" class="ah">-todos</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="resumebut" href="javaScript:void(0)" class="ah">-resume</spen>
        </li>
        <li class="breadcrumb-item dropdown">
            <spen href="javaScript:void(0)" class="ah" role="button" id="friendlinkedbut" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">-friends</spen>
            <div id="fldd" class="dropdown-menu" aria-labelledby="friendlinkedbut" style="border-radius: initial;"></div>
        </li>

        <div id="hb" data-toggle="tooltip" data-placement="bottom" title="show/hide TopBar">

        </div>
    </ol>

    <div id="homepage" class="unselectable new_font myhide">
        <span id="slogan">
            <i id="wolf-logo" class="em-svg em-new_moon mr-4"></i>I'M BACK
        </span>
        <div id="showmore"> &gt; About Me & This Blog</div>
        <div id="showhacknical"> &gt; My Github Analysis</div>
        <div id="toarticles"> &gt; My Tech Articles</div>
        <div id="ifwrapper" class="hacknical_hide">
            <iframe id="hacknical_github_analysis" frameborder="0"></iframe>
        </div>
    </div>

    <div id="series" class="unselectable">
        <span>系</span>
        <span>列</span>
        <span>文</span>
        <span>章</span>
    </div>
    <div id="seriesbox" class="unselectable">

    </div>

    <div id="articles_side_panel" class="unselectable myhide new_font">
        <div id="cates_tree_head">Article Categories</div>
        <div id="cates_tree_body"></div>
        <div id="blog_statistic_head">Blog Statistic</div>
        <table id="blog_statistic_body" class="myhide">
            <tbody>
                <tr>
                    <td style="text-align:right">Site running days:</td>
                    <td style="text-align:left" id="stat_running"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Total article:</td>
                    <td style="text-align:left" id="stat_article_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Char count:</td>
                    <td style="text-align:left" id="stat_typein"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Category count:</td>
                    <td style="text-align:left" id="stat_cate_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Tag count:</td>
                    <td style="text-align:left" id="stat_tag_count"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="docpanel" class="myhide new_font">
        <div id="articlesearch" class="input-group">
            <input id="articlesearchtext" type="text" class="form-control" autocomplete="off" placeholder="search">
            <div class="input-group-append">
                <button id="cleanbut" class="btn btn-dark" type="button" title="clear search">cls</button>
                <button id="categories" class="btn btn-dark" type="button">cates</button>
                <button id="tags" class="btn btn-dark" type="button" title="all tags">tags</button>
                <button id="articlesearchbut" class="btn btn-dark" type="button" title="search">sch</button>
            </div>
        </div>
        <div class="tgs myhide" id="all_cates">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All categories:</span>
            <br>
        </div>
        <div class="tgs myhide" id="all_tags">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All tags:</span>
            <br>
        </div>
    </div>

    <div id="sidetoccontainer" class="tochide unselectable new_font">
        <div id="block">
            <div id="percent" data-toggle="tooltip" data-placement="bottom" title="return to the top">0%</div>
        </div>
        <div id="sidetoc" class="unselectable markdown-body editormd-preview-container"></div>
    </div>
    <div id="md" class="myhide markdown-body editormd-html-preview">
        
          <h3>
            <a name="_root-前言" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            前言
          </h3><blockquote>
<p>可能出乎很多人意料之外的一个事实是，微服务很多核心理念其实在半个世纪前的一篇文章中就被阐述过了，而且这篇文章中的很多论点在软件开发飞速发展的这半个世纪中竟然一再被验证，这就是康威定律。</p>
</blockquote>

          <h3>
            <a name="_root-概述" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            概述
          </h3><p>微服务是最近非常火热的新概念，大家都在追，也都觉得很对，但是似乎没有很充足的理论基础说明这是正确的，给人的感觉是 <strong>不明觉厉</strong> 。前段时间看了Mike Amundsen <a href="http://www.infoq.com/cn/presentations/team-building-implementation-in-distributed-world">《远距离条件下的康威定律——分布式世界中实现团队构建》</a>（是Design RESTful API的作者）在InfoQ上的一个分享，觉得很有帮助，结合自己的一些思考，整理了该演讲的内容。</p>
<p>可能出乎很多人意料之外的一个事实是，微服务很多核心理念其实在半个世纪前的一篇文章中就被阐述过了，而且这篇文章中的很多论点在软件开发飞速发展的这半个世纪中竟然一再被验证，这就是<a href="http://www.melconway.com/Home/Conways_Law.html">康威定律（Conway&#39;s Law）</a>。</p>
<p><img src="http://img1.tbcdn.cn/L1/461/1/3fa834ea8c880a97d00f187f67962a8218b16f22" alt="screenshot"><img src="http://img2.tbcdn.cn/L1/461/1/ad8ba09ed2350c2a8c2f067d80197e74aefcef8d" alt="screenshot"></p>
<p>在康威的这篇文章中，最有名的一句话就是：</p>
<blockquote>
<p>Organizations which design systems are constrained to produce designs which are copies of the communication structures of these organizations. - Melvin Conway(1967)</p>
</blockquote>
<p>中文直译大概的意思就是：设计系统的组织，其产生的设计等同于组织之内、组织之间的沟通结构。看看下面的图片（来源于互联网，侵删），再想想Apple的产品、微软的产品设计，就能形象生动的理解这句话。<br><img src="http://img2.tbcdn.cn/L1/461/1/74ab78cb5db601e5db68adf61e6dc58f437df4e0" alt="screenshot"></p>
<p>用通俗的说法就是：组织形式等同系统设计。</p>
<p>这里的系统按原作者的意思并不局限于软件系统。据说这篇文章最初投的哈佛商业评论，结果程序员屌丝的文章不入商业人士的法眼，无情被拒，康威就投到了一个编程相关的杂志，所以被误解为是针对软件开发的。最初这篇文章显然不敢自称定律（law），只是描述了作者自己的发现和总结。后来，在Brooks Law著名的人月神话中，引用这个论点，并将其“吹捧”成了现在我们熟知“康威定律”。</p>

          <h3>
            <a name="_root-康威定律详细介绍" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            康威定律详细介绍
          </h3><p>Mike从他的角度归纳这篇论文中的其他一些核心观点，如下：</p>
<ul>
<li>第一定律<ul>
<li>Communication dictates design</li>
<li>组织沟通方式会通过系统设计表达出来</li>
</ul>
</li>
<li>第二定律<ul>
<li>There is never enough time to do something right, but there is always enough time to do it over</li>
<li>时间再多一件事情也不可能做的完美，但总有时间做完一件事情</li>
</ul>
</li>
<li>第三定律<ul>
<li>There is a homomorphism from the linear graph of a system to the linear graph of its design organization</li>
<li>线型系统和线型组织架构间有潜在的异质同态特性</li>
</ul>
</li>
<li>第四定律<ul>
<li>The structures of large systems tend to disintegrate during development, qualitatively more so than with small systems</li>
<li>大的系统组织总是比小系统更倾向于分解</li>
</ul>
</li>
</ul>

          <h4>
            <a name="_root-人是复杂社会动物" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            人是复杂社会动物
          </h4><ul>
<li>第一定律<ul>
<li>Communication dictates design</li>
<li>组织沟通方式决定系统设计</li>
</ul>
</li>
</ul>
<p>组织的沟通和系统设计之间的紧密联系，在很多别的领域有类似的阐述。对于复杂的系统，聊设计就离不开聊人与人的沟通，解决好人与人的沟通问题，才能有一个好的系统设计。相信几乎每个程序员都读过的《人月神话》（1975年，感觉都是老古董了，经典的就是经得起时间考验）里面许多观点都和这句话有异曲同工之妙。</p>
<p><img src="http://img2.tbcdn.cn/L1/461/1/8759732579d4193ef27df9011d252cf357562349" alt="screenshot"><img src="http://img2.tbcdn.cn/L1/461/1/fb215be9fe9232ccda1fc8817b4af6e8da6abcd0" alt="screenshot"></p>
<p>比如《人月神话》中最著名的一句话就是</p>
<blockquote>
<p>Adding manpower to a late software project makes it later --Fred Brooks, (1975)</p>
</blockquote>
<p>Boss们都听到了吗？为了赶进度加程序员就像用水去灭油锅里的火一样（无奈大家还是前赴后继）。</p>
<p>为什么？人月神话也给出了很简洁的答案：沟通成本 = n(n-1)/2，沟通成本随着项目或者组织的人员增加呈指数级增长。是的，项目管理这个算法的复杂度是O(n^2)。举个例子</p>
<ul>
<li>5个人的项目组，需要沟通的渠道是 5*(5–1)/2 = 10</li>
<li>15个人的项目组，需要沟通的渠道是15*(15–1)/2 = 105</li>
<li>50个人的项目组，需要沟通的渠道是50*(50–1)/2 = 1,225</li>
<li>150个人的项目组，需要沟通的渠道是150*(150–1)/2 = 11,175</li>
</ul>
<p>所以知道为什么互联网创业公司都这么小了吧，必须小啊，不然等CEO和所有人讲一遍创业的想法后，风投的钱都烧完了。</p>
<p>Mike还举了一个非常有意思的理论，叫“Dunbar Number”，这是一个叫Dunbar（废话）生物学家在1992年最早提出来的。最初，他发现灵长类的大脑容量和其对应的族群大小有一定关联，进而推断出人类的大脑能维系的关系的一些有趣估计。举例来说</p>
<ul>
<li>亲密（intimate）朋友: 5</li>
<li>信任（trusted）朋友: 15</li>
<li>酒肉（close）朋友: 35</li>
<li>照面（casual）朋友: 150</li>
</ul>
<p><img src="http://img2.tbcdn.cn/L1/461/1/a63beac73c8d217c71aba36c4a6e270a3fa18603" alt="screenshot"></p>
<p>是不是和上面的沟通成本的数字很貌似有关联？是的，我们的大脑智力只能支持我们维系这么多的关系。（大家都知道这不是程序猿擅长的领域，在开发团队里，这个值应该更小，估计和猿差不多 -_-凸 ）</p>
<p>沟通的问题，会带来系统设计的问题，进而影响整个系统的开发效率和最终产品结果。</p>

          <h4>
            <a name="_root-一口气吃不成胖子，先搞定能搞定的" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            一口气吃不成胖子，先搞定能搞定的
          </h4><ul>
<li>第二定律:<ul>
<li>There is never enough time to do something right, but there is always enough time to do it over</li>
<li>时间再多一件事情也不可能做的完美，但总有时间做完一件事情</li>
</ul>
</li>
</ul>
<p>Eric Hollnagel是敏捷开发社区的泰斗之一，在他《Efficiency-Effectiveness Trade Offs》 一书中解释了类似的论点。</p>
<blockquote>
<p>Problem too complicated? Ignore details. Not enough resources?Give up features.</p>
<pre><code>            --Eric Hollnagel (2009)</code></pre></blockquote>
<p><img src="http://img1.tbcdn.cn/L1/461/1/654425008b3a53442a77f32068302b44b51a32da" alt="screenshot"><img src="http://img1.tbcdn.cn/L1/461/1/78d32f9955e5deebd42ab75333e226fd52d6797f" alt="screenshot"></p>
<p>系统越做越复杂，功能越来越多，外部市场的竞争越来越剧烈，投资人的期待越来越高。但人的智力是有上限的，即使再牛逼的人，融到钱再多也不一定招到足够多合适的人。对于一个巨复杂的系统，我们永远无法考虑周全。Eric认为，这个时候最好的解决办法竟然是——“破罐子破摔”。</p>
<p>其实我们在日常开发中也经常碰到。产品经理的需求太复杂了？适当忽略一些细节，先抓主线。产品经理的需求太多了？放弃一些功能。</p>
<p>据说Eric被一家航空公司请去做安全咨询顾问，复杂保证飞机飞行系统的稳定性和安全性。Eric认为做到安全有两种方式：</p>
<ul>
<li>常规的安全指的是尽可能多的发现并消除错误的部分，达到绝对安全，这是理想。</li>
<li>另一种则是弹性安全，即使发生错误，只要及时恢复，也能正常工作，这是现实。</li>
</ul>
<p>对于飞机这样的复杂系统，再牛逼的人也无法考虑到漏洞的方方面面，所以Eric建议放弃打造完美系统的想法，而是通过不断的试飞，发现问题，确保问题发生时，系统能自动复原即可，而不追求飞行系统的绝对正确和安全。</p>
<p>下面的图很好的解释了这个过程：<br><img src="http://img1.tbcdn.cn/L1/461/1/a7fab1b350cd8c03d5e9ddded183c7bda114c326" alt="screenshot"><br>听着很耳熟不是吗？这不就是 <strong>持续集成</strong> 和敏捷开发吗？的确就是。</p>
<p>另一方面，这和互联网公司维护的分布式系统的弹性设计也是一个道理。对于一个分布式系统，我们几乎永远不可能找到并修复所有的bug，单元测试覆盖1000%也没有用，错误流淌在分布式系统的血液里。解决方法不是消灭这些问题，而是容忍这些问题，在问题发生时，能自动回复，微服务组成的系统，每一个微服务都可能挂掉，这是常态，我们只有有足够的冗余和备份即可。即所谓的 <strong>弹性设计（Resilience）</strong> 或者叫高可用设计（High Availability）。</p>

          <h4>
            <a name="_root-种瓜得瓜，做独立自治的字系统减少沟通成本" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            种瓜得瓜，做独立自治的字系统减少沟通成本
          </h4><ul>
<li>第三定律<ul>
<li>There is a homomorphism from the linear graph of a system to the linear graph of its design organization</li>
<li>线型系统和线型组织架构间有潜在的异质同态特性</li>
</ul>
</li>
</ul>
<p><img src="http://img1.tbcdn.cn/L1/461/1/3810f88633a55bdf59bb7757cedc827ab425538e" alt="screenshot"></p>
<p>这是康威第一定律组织和设计间内在关系的一个具体应用。更直白的说，你想要什么样的系统，就搭建什么样的团队。如果你的团队分成前端团队，Java后台开发团队，DBA团队，运维团队，你的系统就会长成下面的样子：<br><img src="http://img4.tbcdn.cn/L1/461/1/f4c2d4a8f8390ca6be19b54a524c8272aced3e34" alt="screenshot"></p>
<p>相反，如果你的系统是按照业务边界划分的，大家按照一个业务目标去把自己的模块做出小系统，小产品的话，你的大系统就会长成下面的样子，即微服务的架构<br><img src="http://img3.tbcdn.cn/L1/461/1/c827db7a12d730140d4c0e6947535e168902a73e" alt="screenshot"></p>
<p>微服务的理念团队间应该是 <strong>inter-operate, not integrate</strong> 。inter-operate是定义好系统的边界和接口，在一个团队内全栈，让团队自治，原因就是因为如果团队按照这样的方式组建，将沟通的成本维持在系统内部，每个子系统就会更加内聚，彼此的依赖耦合能变弱，跨系统的沟通成本也就能降低。</p>

          <h4>
            <a name="_root-合久必分，分而治之" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            合久必分，分而治之
          </h4><ul>
<li>第四定律<ul>
<li>The structures of large systems tend to disintegrate during development, qualitatively more so than with small systems</li>
<li>大的系统组织总是比小系统更倾向于分解</li>
</ul>
</li>
</ul>
<p>前面说了，人是复杂的社会动物，人与人的通过非常复杂。但是当我们面对复杂系统时，又往往只能通过增加人力来解决。这时，我们的组织一般是如何解决这个沟通问题的呢？Divide and conquer,分而治之。大家看看自己的公司的组织，是不是一个一线经理一般都是管理15个人以下的？二线经理再管理更少的一线？三线再管理更少的，以此类推。（这里完全没有暗示开发经理比程序猿更难管理）</p>
<p>所以，一个大的组织因为沟通成本/管理问题，总为被拆分成一个个小团队。</p>
<ul>
<li>创业的想法太好了，反正风投钱多，多招点程序猿</li>
<li>人多管不过来啊，找几个经理帮我管，我管经理</li>
<li>最后， <strong>康威定律</strong> 告诉我们组织沟通的方式会在系统设计上有所表达，每个经理都被赋予一定的职责去做大系统的某一小部分，他们和大系统便有了沟通的边界，所以大的系统也会因此被拆分成一个个小团队负责的小系统（微服务是一种好的模式）</li>
</ul>

          <h3>
            <a name="_root-康威定律如何解释微服务的合理性" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            康威定律如何解释微服务的合理性
          </h3><p>了解了康威定律是什么，再来看看他如何在半个世纪前就奠定了微服务架构的理论基础。</p>
<ul>
<li>人与人的沟通是非常复杂的，一个人的沟通精力是有限的，所以当问题太复杂需要很多人解决的时候，我们需要做拆分组织来达成对沟通效率的管理</li>
<li>组织内人与人的沟通方式决定了他们参与的系统设计，管理者可以通过不同的拆分方式带来不同的团队间沟通方式，从而影响系统设计</li>
<li>如果子系统是内聚的，和外部的沟通边界是明确的，能降低沟通成本，对应的设计也会更合理高效</li>
<li>复杂的系统需要通过容错弹性的方式持续优化，不要指望一个大而全的设计或架构，好的架构和设计都是慢慢迭代出来的</li>
</ul>
<p>带来的具体的实践建议是：</p>
<ul>
<li>我们要用一切手段提升沟通效率，比如slack，github，wiki。能2个人讲清楚的事情，就不要拉更多人，每个人每个系统都有明确的分工，出了问题知道马上找谁，避免踢皮球的问题。</li>
<li>通过MVP的方式来设计系统，通过不断的迭代来验证优化，系统应该是弹性设计的。</li>
<li>你想要什么样的系统设计，就架构什么样的团队，能扁平化就扁平化。最好按业务来划分团队，这样能让团队自然的自治内聚，明确的业务边界会减少和外部的沟通成本，每个小团队都对自己的模块的整个生命周期负责，没有边界不清，没有无效的扯皮，inter-operate, not integrate。</li>
<li>做小而美的团队，人多会带来沟通的成本，让效率下降。亚马逊的Bezos有个逗趣的比喻，如果2个披萨不够一个团队吃的，那么这个团队就太大了。事实上一般一个互联网公司小产品的团队差不多就是7，8人左右（包含前后端测试交互用研等，可能身兼数职）。</li>
</ul>
<p>再对应下衡量微服务的标准，我们很容易会发现他们之间的密切关系：</p>
<ul>
<li>分布式服务组成的系统</li>
<li>按照业务而不是技术来划分组织</li>
<li>做有生命的产品而不是项目</li>
<li>Smart endpoints and dumb pipes（我的理解是强服务个体和弱通信）</li>
<li>自动化运维（DevOps）</li>
<li>容错</li>
<li>快速演化</li>
</ul>

          <h3>
            <a name="_root-参考资料" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            参考资料
          </h3><ul>
<li><a href="http://www.infoq.com/cn/presentations/team-building-implementation-in-distributed-world">远距离条件下的康威定律——分布式世界中实现团队构建</a>，本文图片来源该ppt截图</li>
<li><a href="https://en.wikipedia.org/wiki/Conway%27s_law">Conway‘s Law in wiki</a></li>
<li><a href="http://www.melconway.com/Home/Conways_Law.html">Conway&#39;s Law Homepage</a></li>
</ul>
<blockquote>
<p>转载自：<a href="https://yq.aliyun.com/articles/8611">https://yq.aliyun.com/articles/8611</a></p>
</blockquote>

    </div>
    <div id="scriptsearcher" class="myhide input-group new_font">
        <input id="searchtext" type="text" class="form-control" placeholder="keywords" autocomplete="off">
        <div class="input-group-append">
            <button id="searchbut" class="btn btn-dark" type="button">Search</button>
        </div>
    </div>

    <div id="bbt" class="myhide new_font">
        <a id="toc" style="display: none;" class="myhide" href="javascript:void(0);" data-toggle="tooltip" data-placement="left" title="show/hide Toc">Toc</a>
        <a id="gohub" href="#" target="_blank" data-toggle="tooltip" data-placement="bottom" title="view this at github">unuse</a>
    </div>

    <div id="share_png_panel" class="myhide">
        <div id="share_curtain"></div>
        <div id="png_box"></div>
        <button id="share_png_paned_close" class="btn btn-dark">Close</button>
    </div>

    <script>
        importJsAfterLoad()
    </script>
</body>

</html>