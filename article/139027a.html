<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="baidu-site-verification" content="l09YSIpJQW" />
    <meta name="referrer" content="origin">
    <title>blog | youyinnn</title>
    <script src="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/myjs/loadscripts.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/myjs/jump-1.3.js"></script>
    <link rel="bookmark" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="stylesheet" href="/mycss/style.css">

    <script src="/resources/resources.js"></script>
    <script src="/myjs/scriptlist.js"></script>
</head>

<body>

    <ol id="topbar" class="breadcrumb unselectable new_font">
        <p style="color:rgb(214, 214, 214); padding-right: 1rem;">
            <button id="egg" class="egg">ğŸš€</button>&nbsp;&nbsp;&nbsp;&nbsp;&gt;</p>
        <li class="breadcrumb-item">
            <spen id="homebut" href="javaScript:void(0)" class="ah">-home</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="articlesbut" href="javaScript:void(0)" class="ah">-articles</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="scriptbut" href="javaScript:void(0)" class="ah">-scripts</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="todobut" href="javaScript:void(0)" class="ah">-todos</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="resumebut" href="javaScript:void(0)" class="ah">-resume</spen>
        </li>
        <li class="breadcrumb-item dropdown">
            <spen href="javaScript:void(0)" class="ah" role="button" id="friendlinkedbut" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">-friends</spen>
            <div id="fldd" class="dropdown-menu" aria-labelledby="friendlinkedbut" style="border-radius: initial;"></div>
        </li>

        <div id="hb" data-toggle="tooltip" data-placement="bottom" title="show/hide TopBar">

        </div>
    </ol>

    <div id="homepage" class="unselectable new_font myhide">
        <div id="homepage-center">
            <div id="slogan">
                <i id="wolf-logo" style="font-style: normal;" class="mr-4">ğŸŒ‘</i><span id="slogan-text"></span>
            </div>
            <div id="homepage-btn">
                <div id="showmore"> &nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;&nbsp; About Me & This Blog</div>
                <div id="showhacknical"> &nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;&nbsp; My Github Analysis</div>
                <div id="toarticles"> &nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;&nbsp; My Tech Articles</div>
            </div>
        </div>
        <div id="ifwrapper" class="hacknical_hide">
            <iframe id="hacknical_github_analysis" frameborder="0"></iframe>
        </div>
    </div>

    <div id="articles_side_panel" class="unselectable myhide new_font">
        <div id="cates_tree_head">Article Categories</div>
        <div id="cates_tree_body"></div>
        <div id="blog_statistic_head">Blog Statistics</div>
        <table id="blog_statistic_body" class="myhide">
            <tbody>
                <tr>
                    <td style="text-align:right">Online:</td>
                    <td style="text-align:left" id="stat_running"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Article:</td>
                    <td style="text-align:left" id="stat_article_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Chars:</td>
                    <td style="text-align:left" id="stat_typein"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Categories:</td>
                    <td style="text-align:left" id="stat_cate_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Tags:</td>
                    <td style="text-align:left" id="stat_tag_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Last update:</td>
                    <td style="text-align:left" id="stat_last_update"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="docpanel" class="myhide new_font">
        <div id="articlesearch" class="input-group">
            <input id="articlesearchtext" type="text" class="form-control" autocomplete="off" placeholder="search">
            <div class="input-group-append">
                <button id="cleanbut" class="btn btn-light" type="button" title="clear search">cls</button>
                <button id="categories" class="btn btn-light" type="button">cates</button>
                <button id="tags" class="btn btn-light" type="button" title="all tags">tags</button>
                <button id="articlesearchbut" class="btn btn-light" type="button" title="search">sch</button>
            </div>
        </div>
        <div class="tgs myhide" id="all_cates">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All categories:</span>
            <br>
        </div>
        <div class="tgs myhide" id="all_tags">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All tags:</span>
            <br>
        </div>
    </div>

    <div id="sidetoccontainer" class="tochide unselectable new_font">
        <div id="block">
            <div id="percent" data-toggle="tooltip" data-placement="bottom" title="return to the top">0%</div>
        </div>
        <div id="sidetoc" class="unselectable markdown-body editormd-preview-container markdown-toc"></div>
    </div>
    <div id="md" class="myhide markdown-body editormd-html-preview">
        
          <h3 id="fccefbaf">
            <a name="_root-å‰è¨€" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            å‰è¨€
          </h3><p>ä¸çŸ¥ä¸è§‰å†™åˆ°ç¬¬å…­åäº†ï¼Œå‰é¢åˆ€å‰‘ç£¨åˆ€çŸ³å†…åŠŸå¿ƒæ³•éƒ½æœ‰äº†ï¼Œæ„Ÿè§‰è‡ªå·±åº”è¯¥å¾ˆå‰å®³äº†ï¼Œå…¶å®ä¸æ˜¯ï¼Œè¿™ä¸€ä¸ªæœˆå› ä¸ºè€ƒè¯•æœ«å°¾å’Œå®ä¹ ï¼Œæ–­æ–­ç»­ç»­çš„çœ‹ï¼Œååå¤å¤çš„çœ‹ï¼Œè¶Šçœ‹è¶Šç²¾ç¥ï¼Œè¶Šçœ‹è¶Šå¿ƒè™šã€‚</p>
<p>æ— è®ºæ€ä¹ˆè¯´ï¼ŒçŸ­æ¿è¿˜æ˜¯å¾—æ…¢æ…¢è¡¥ä¸Šæ¥ï¼Œä¿æŒè°¦é€Šï¼Œè™šå¿ƒå­¦ä¹ ã€‚</p>
<p>å›åˆ°æ•´ä½“ï¼Œå‰é¢ç”±å†…åˆ°å¤–è¯´äº†Javaå¹¶å‘ä¸­å¾ˆåŸºæœ¬çš„å‡ ä»¶äº‹ï¼š</p>
<ul>
<li>åŸºæœ¬çš„çº¿ç¨‹APIå’Œä½¿ç”¨</li>
<li>åŸºæœ¬çš„å¹¶å‘æ¦‚å¿µ</li>
<li>volatileå’Œsynchronizedå’Œé”æ¦‚å¿µ</li>
</ul>
<p>æˆ‘è§‰å¾—æ˜¯æ—¶å€™å¾—åœä¸€ä¸‹ï¼Œç»¼åˆä¸€ä¸‹è¿™äº›ä¸œè¥¿ï¼ŒçœŸåˆ€çœŸæªå¹²å‡ æ¬¡ï¼Œæ‰€ä»¥è¿™ç¯‡ç®—æ˜¯æˆ‘ä»¬å¹¶å‘æ¸¸æˆä¸–ç•Œä¸­ï¼Œä¸»äººç¿çš„<strong>â€œåˆå‡ºèŒ…åºâ€</strong>ç¯‡ï¼Œåˆå¯ä»¥å«åšå°è¯•ç‰›åˆ€ï¼Œåœ¨è¿™ç¯‡æˆ‘å°è¯•ä¾‹å‡ºå¹¶å‘ç¼–ç¨‹ä¸­æœ€åŸºæœ¬çš„åœºæ™¯å¦‚ï¼š</p>
<ul>
<li><strong>æ­»é”</strong></li>
<li><strong>â€œç­‰å¾…-é€šçŸ¥â€</strong></li>
<li><strong>æœ‰è¶…æ—¶çš„â€œç­‰å¾…-é€šçŸ¥â€</strong></li>
<li><strong>â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å¼</strong></li>
<li><strong>åŒé‡æ£€æŸ¥é”å»¶è¿Ÿåˆå§‹åŒ–çš„é”™è¯¯ä¸æ­£ç¡®ç¤ºèŒƒ</strong></li>
</ul>
<hr>

          <h3 id="f3aca1e4">
            <a name="_root-æ­»é”" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            æ­»é”
          </h3><p>æ­»é”æ˜¯å¤šä¸ªä»¥ä¸Šçš„processäº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºè€Œè¿›å…¥æ°¸ä¹…ç­‰å¾…çš„ä¸€ç§æƒ…å†µï¼Œè¦äº§ç”Ÿæ­»é”ï¼Œå°±å¿…é¡»åŒæ—¶æ»¡è¶³ä¸€ä¸‹å››ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li><p><strong>äº’æ–¥æ¡ä»¶</strong></p>
<p>  â€‹    å³æŸä¸ªèµ„æºåœ¨ä¸€æ®µæ—¶é—´å†…åªèƒ½ç”±ä¸€ä¸ªè¿›ç¨‹å æœ‰ï¼Œä¸èƒ½åŒæ—¶è¢«ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹å æœ‰ã€‚è¿™ç§ç‹¬å èµ„æºå¦‚CD-ROMé©±åŠ¨å™¨ï¼Œæ‰“å°æœºç­‰ç­‰ï¼Œå¿…é¡»åœ¨å æœ‰è¯¥èµ„æºçš„è¿›ç¨‹ä¸»åŠ¨é‡Šæ”¾å®ƒä¹‹åï¼Œå…¶å®ƒè¿›ç¨‹æ‰èƒ½å æœ‰è¯¥èµ„æºã€‚è¿™æ˜¯ç”±èµ„æºæœ¬èº«çš„å±æ€§æ‰€å†³å®šçš„ã€‚å¦‚ç‹¬æœ¨æ¡¥å°±æ˜¯ä¸€ç§ç‹¬å èµ„æºï¼Œä¸¤æ–¹çš„äººä¸èƒ½åŒæ—¶è¿‡æ¡¥ã€‚</p>
</li>
<li><p><strong>ä¸å¯æŠ¢å æ¡ä»¶</strong></p>
<p>  â€‹    è¿›ç¨‹æ‰€è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œæ¯•ä¹‹å‰ï¼Œèµ„æºç”³è¯·è€…ä¸èƒ½å¼ºè¡Œåœ°ä»èµ„æºå æœ‰è€…æ‰‹ä¸­å¤ºå–èµ„æºï¼Œè€Œåªèƒ½ç”±è¯¥èµ„æºçš„å æœ‰è€…è¿›ç¨‹è‡ªè¡Œé‡Šæ”¾ã€‚å¦‚è¿‡ç‹¬æœ¨æ¡¥çš„äººä¸èƒ½å¼ºè¿«å¯¹æ–¹åé€€ï¼Œä¹Ÿä¸èƒ½éæ³•åœ°å°†å¯¹æ–¹æ¨ä¸‹æ¡¥ï¼Œå¿…é¡»æ˜¯æ¡¥ä¸Šçš„äººè‡ªå·±è¿‡æ¡¥åç©ºå‡ºæ¡¥é¢ï¼ˆå³ä¸»åŠ¨é‡Šæ”¾å æœ‰èµ„æºï¼‰ï¼Œå¯¹æ–¹çš„äººæ‰èƒ½è¿‡æ¡¥ã€‚</p>
</li>
<li><p><strong>å æœ‰ä¸”ç”³è¯·æ¡ä»¶</strong></p>
<p>  â€‹    è¿›ç¨‹è‡³å°‘å·²ç»å æœ‰ä¸€ä¸ªèµ„æºï¼Œä½†åˆç”³è¯·æ–°çš„èµ„æºï¼›ç”±äºè¯¥èµ„æºå·²è¢«å¦å¤–è¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è¯¥è¿›ç¨‹é˜»å¡ï¼›ä½†æ˜¯ï¼Œå®ƒåœ¨ç­‰å¾…æ–°èµ„æºä¹‹æ—¶ï¼Œä»ç»§ç»­å ç”¨å·²å æœ‰çš„èµ„æºã€‚è¿˜ä»¥è¿‡ç‹¬æœ¨æ¡¥ä¸ºä¾‹ï¼Œç”²ä¹™ä¸¤äººåœ¨æ¡¥ä¸Šç›¸é‡ã€‚ç”²èµ°è¿‡ä¸€æ®µæ¡¥é¢ï¼ˆå³å æœ‰äº†ä¸€äº›èµ„æºï¼‰ï¼Œè¿˜éœ€è¦èµ°å…¶ä½™çš„æ¡¥é¢ï¼ˆç”³è¯·æ–°çš„èµ„æºï¼‰ï¼Œä½†é‚£éƒ¨åˆ†æ¡¥é¢è¢«ä¹™å æœ‰ï¼ˆä¹™èµ°è¿‡ä¸€æ®µæ¡¥é¢ï¼‰ã€‚ç”²è¿‡ä¸å»ï¼Œå‰è¿›ä¸èƒ½ï¼Œåˆä¸åé€€ï¼›ä¹™ä¹Ÿå¤„äºåŒæ ·çš„çŠ¶å†µã€‚</p>
</li>
<li><p><strong>å¾ªç¯ç­‰å¾…æ¡ä»¶</strong></p>
<p>  â€‹    å­˜åœ¨ä¸€ä¸ªè¿›ç¨‹ç­‰å¾…åºåˆ—{P1ï¼ŒP2ï¼Œ...ï¼ŒPn}ï¼Œå…¶ä¸­P1ç­‰å¾…P2æ‰€å æœ‰çš„æŸä¸€èµ„æºï¼ŒP2ç­‰å¾…P3æ‰€å æœ‰çš„æŸä¸€æºï¼Œ......ï¼Œè€ŒPnç­‰å¾…P1æ‰€å æœ‰çš„çš„æŸä¸€èµ„æºï¼Œå½¢æˆä¸€ä¸ªè¿›ç¨‹å¾ªç¯ç­‰å¾…ç¯ã€‚å°±åƒå‰é¢çš„è¿‡ç‹¬æœ¨æ¡¥é—®é¢˜ï¼Œç”²ç­‰å¾…ä¹™å æœ‰çš„æ¡¥é¢ï¼Œè€Œä¹™åˆç­‰å¾…ç”²å æœ‰çš„æ¡¥é¢ï¼Œä»è€Œå½¼æ­¤å¾ªç¯ç­‰å¾…ã€‚</p>
</li>
</ul>
<p>æ­»é”çš„å¤„ç†å¯ä»¥åˆ†ä¸ºï¼šé¢„é˜²ï¼Œé¿å…ï¼Œæ£€æµ‹å’Œè§£é™¤</p>

          <h4 id="715e00ec">
            <a name="_root-æ­»é”é¢„é˜²" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            æ­»é”é¢„é˜²
          </h4><p>è¿™æ˜¯ä¸€ç§è¾ƒä¸ºç®€å•ã€ç›´è§‚çš„äº‹å…ˆé¢„é˜²æ–¹æ³•ï¼Œæ–¹æ³•æ˜¯ç ´åäº§ç”Ÿæ­»é”çš„4ä¸ªæ¡ä»¶ï¼Œå°±ç®—ç ´åä¸€ä¸ªï¼Œæ­»é”ä¹Ÿä¸ä¼šäº§ç”Ÿã€‚è¿™æ˜¯ä¸€ç§é™æ€æ–¹æ³•ã€‚</p>

          <h4 id="20615b44">
            <a name="_root-æ­»é”é¿å…" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            æ­»é”é¿å…
          </h4><p>ç³»ç»Ÿåœ¨è¿è¡Œæ—¶åˆ†é…èµ„æºçš„æ—¶å€™ï¼Œèƒ½å¤Ÿå¯¹èµ„æºåˆ†é…æƒ…å†µè¿›è¡ŒåŠ¨æ€æ£€æŸ¥ï¼Œå¦‚æœç»“æœè‰¯å¥½ï¼Œåˆ™å…è®¸åˆ†é…ï¼Œå¦‚æœç»“æœæ˜¾ç¤ºåˆ†é…åä¼šå‡ºç°æ­»é”ï¼Œåˆ™ä¸äºˆåˆ†é…ã€‚è¿™æ˜¯ä¸€ç§åŠ¨æ€æ–¹æ³•ã€‚</p>

          <h4 id="b8aca52a">
            <a name="_root-æ£€æµ‹å’Œè§£é™¤" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            æ£€æµ‹å’Œè§£é™¤
          </h4><ul>
<li><p>æ£€æµ‹</p>
<p>  â€‹    ä¸äº‹å…ˆé‡‡å–é™åˆ¶æªæ–½ï¼Œä¹Ÿä¸æ£€æµ‹ç³»ç»Ÿæ˜¯å¦è¿›å…¥å®‰å…¨åŒºï¼Œè¿è¡Œç³»ç»Ÿåœ¨è¿è¡Œæ—¶å‘ç”Ÿæ­»é”ï¼Œä½†æ˜¯ä¼šé€šè¿‡ç³»ç»Ÿè®¾ç½®çš„æ£€æŸ¥æœºåˆ¶ï¼Œæ£€æµ‹å‡ºæ­»é”å‘ç”Ÿçš„åœ°æ–¹ã€‚</p>
</li>
<li><p>è§£é™¤</p>
<p>  â€‹    æ£€æµ‹åˆ°æ­»é”åœ°ç‚¹ä¹‹åï¼Œè§£é™¤æ­»é”çŠ¶æ€</p>
</li>
</ul>
<p>ä¾‹ï¼š</p>
<pre><code class="language-java">public class DeadLock {
    private static StringBuffer a = new StringBuffer();
    private static StringBuffer b = new StringBuffer();
    public static void main(String[] args) {
        new Thread(() -&gt; {
            synchronized (a){
                try {
                    Thread.sleep(10);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                synchronized (b){}
            }
        }).start();
        new Thread(() -&gt; {
            synchronized (b){
              synchronized (a){}
            }
        }).start();
    }
}</code></pre>

          <h3 id="10b22002">
            <a name="_root-â€œç­‰å¾…-é€šçŸ¥â€" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            â€œç­‰å¾…-é€šçŸ¥â€
          </h3><blockquote>
<p>åœ¨å°±é¤çš„æ—¶å€™ï¼Œå¨å¸ˆå’ŒæœåŠ¡å‘˜ä¹‹é—´çš„äº¤äº’å°±æ˜¯ä¸€ç§ç­‰å¾…é€šçŸ¥æ¨¡å¼ï¼š</p>
<ol>
<li>å¨å¸ˆéœ€è¦ä¸€å®šçš„æ—¶é—´å»åšèœ</li>
<li>å¨å¸ˆæ²¡åšå¥½èœçš„æ—¶å€™ï¼ŒæœåŠ¡å‘˜å°±æ²¡æ´»å¹²äº†ï¼Œæ‰€ä»¥æœåŠ¡å‘˜å°±æœ‰ï¼ˆwaitï¼‰çš„çŠ¶æ€</li>
<li>æœåŠ¡å‘˜å–èœçš„æ—¶æœºæ˜¯å–å†³äºå¨å¸ˆçš„ï¼Œåªæœ‰å½“å¨å¸ˆå°†èœæ”¾åˆ°â€œå°é¢â€ä¸Šï¼Œå¹¶â€œé€šçŸ¥ï¼ˆnotifyï¼‰â€æœåŠ¡å‘˜ï¼ŒæœåŠ¡å‘˜èœå¼€å§‹å¹²æ´»</li>
</ol>
</blockquote>

          <h4 id="825defa0">
            <a name="_root-èŒƒå¼" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            èŒƒå¼
          </h4><pre><code class="language-java">synchronized(å¯¹è±¡) {
    while(é€€å‡ºç­‰å¾…çš„æ¡ä»¶ä¸æ»¡è¶³){
        å¯¹è±¡.wait();
    }
    // ç­‰å¾…å®Œåçš„å·¥ä½œ
}</code></pre>
<pre><code class="language-java">synchronized(å¯¹è±¡){
    // æ”¹å˜é€€å‡ºç­‰å¾…çš„æ¡ä»¶
    å¯¹è±¡.notifyAll()ï¼›
}</code></pre>

          <h4 id="e4a6aa27">
            <a name="_root-å®ç°" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            å®ç°
          </h4><pre><code class="language-java">public class WaitNotifyParadigm {

    private static String lock = &quot;lock&quot;;
    private static boolean wait = true;

    public static void main(String[] args) {
        new Thread(() -&gt; {
            synchronized (lock) {
                System.out.println(&quot;T1 started to wait...&quot;);
                while (wait) {
                    try {
                        lock.wait(1000);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
                System.out.println(&quot;T1 stop waitting !&quot;);
            }
        }).start();
        new Thread(() -&gt; {
            for (int i = 0; i &lt; 3; i++) {
                System.out.println(&quot;T2 processing: &quot; + (i + 1));
                try {
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            synchronized (lock) {
                System.out.println(&quot;T2 done process, notifyAll...&quot;);
                wait = false;
                lock.notifyAll();
            }
        }).start();
    }
}</code></pre>
<p>ç»“æœï¼š</p>
<pre><code class="language-console">T1 started to wait...
T2 processing: 1
T2 processing: 2
T2 processing: 3
T2 done process, notifyAll...
T1 stop waitting !</code></pre>

          <h4 id="3796f15e">
            <a name="_root-æœ‰è¶…æ—¶çš„â€œç­‰å¾…-é€šçŸ¥â€" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            æœ‰è¶…æ—¶çš„â€œç­‰å¾…-é€šçŸ¥â€
          </h4><p>è¦æ­é…<code>wait()</code>çš„è¶…æ—¶æœºåˆ¶çš„è¯ï¼Œå°±å¾—åœ¨æ¡ä»¶ä¸­ä¹Ÿè€ƒè™‘è¶…æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸¤ä¸ªå˜é‡æ¥å®Œæˆè¶…æ—¶ï¼š</p>
<ul>
<li>leftï¼šè¡¨ç¤ºå‰©ä½™å¤šå°‘æ—¶é—´å°±è¶…æ—¶</li>
<li>endï¼šè¡¨ç¤ºè¶…æ—¶æ—¶é—´çš„å®Œæ•´æ¯«ç§’æ•°</li>
</ul>
<pre><code class="language-java">public class WaitNotifyParadigmWithTimeout {

    private static String lock = &quot;lock&quot;;
    private static boolean wait = true;
    private static long timeout = 5000;

    public static void main(String[] args) {
        new Thread(() -&gt; {
            synchronized (lock) {
                System.out.println(&quot;T1 started to wait...&quot;);
                long left = timeout;
                long end = System.currentTimeMillis() + timeout;
                while (wait &amp;&amp; left &gt; 0) {
                    try {
                        lock.wait(left);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                    left = end - System.currentTimeMillis();
                }
                System.out.println(&quot;T1 stop waitting !&quot;);
            }
        }).start();
        new Thread(() -&gt; {
            for (int i = 0; i &lt; 10; i++) {
                System.out.println(&quot;T2 processing: &quot; + (i + 1));
                try {
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            synchronized (lock) {
                System.out.println(&quot;T2 done process, notifyAll...&quot;);
                wait = false;
                lock.notifyAll();
            }
        }).start();
    }
}</code></pre>

          <h3 id="3cc534bb">
            <a name="_root-â€œç”Ÿäº§è€…/æ¶ˆè´¹è€…â€" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            â€œç”Ÿäº§è€…/æ¶ˆè´¹è€…â€
          </h3><p>åˆ©ç”¨wait/notifyæœºåˆ¶ï¼Œå…ˆä¸Šä¸€æ®µå¤šæ¶ˆè´¹è€…/å¤šç”Ÿäº§è€…çš„ç¤ºä¾‹</p>
<pre><code class="language-java">public class TestProducerConsumer2 {

    static Integer limit = 50;
    static volatile Integer stock = 0;
    static final String P_LOCK = &quot;p&quot;;
    static final String C_LOCK = &quot;c&quot;;

    public static void main(String[] args) {
        new Thread(new Producer2(&quot;P-1&quot;)).start();
        new Thread(new Consumer2(&quot;C-1&quot;)).start();
        new Thread(new Consumer2(&quot;C-2&quot;)).start();
    }
}

class Producer2 implements Runnable {

    private String name;

    public Producer2(String name) {
        this.name = name;
    }

    @Override
    public void run() {
        while (true) {
            if (TestProducerConsumer2.stock &lt; TestProducerConsumer2.limit) {
                System.out.println(&quot;Producing&quot;);
                while (TestProducerConsumer2.stock &lt; TestProducerConsumer2.limit) {
                    synchronized (TestProducerConsumer2.P_LOCK) {
                        try {
                            Thread.sleep(10);
                        } catch (InterruptedException e) {
                            e.printStackTrace();
                        }
                        TestProducerConsumer2.stock++;
                        System.out.println(&quot;Produced the &quot; + TestProducerConsumer2.stock + &quot; stock&quot;);
                    }
                }
                System.out.println(&quot;Produce process done&quot;);
                synchronized (TestProducerConsumer2.C_LOCK) {
                    TestProducerConsumer2.C_LOCK.notifyAll();
                }
            }
            synchronized (TestProducerConsumer2.P_LOCK) {
                try {
                    TestProducerConsumer2.P_LOCK.wait();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }
    }
}

class Consumer2 implements Runnable {

    private String name;

    public Consumer2(String name) {
        this.name = name;
    }

    @Override
    public void run() {
        while (true) {
            if (TestProducerConsumer2.stock &gt;= TestProducerConsumer2.limit) {
                System.out.println(name + &quot; consuming&quot;);
                while (TestProducerConsumer2.stock &gt; 0) {
                    synchronized (TestProducerConsumer2.C_LOCK) {
                        System.out.println(name + &quot; consumed the &quot; + TestProducerConsumer2.stock + &quot; stock&quot;);
                        TestProducerConsumer2.stock--;
                    }
                }
                System.out.println(name + &quot;consume process done&quot;);
                synchronized (TestProducerConsumer2.P_LOCK) {
                    TestProducerConsumer2.P_LOCK.notifyAll();
                }
            }
            synchronized (TestProducerConsumer2.C_LOCK) {
                try {
                    TestProducerConsumer2.C_LOCK.wait();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        }
    }
}
</code></pre>
<p>ç›®æ ‡itemæ˜¯stockï¼Œæˆ‘ä»¬ç”¨<code>volatile</code>æ¥ä¿è¯å…¶åœ¨P/Cä¹‹é—´çš„å¯è§æ€§</p>
<p>P/Cä¹‹é—´å„é€šè¿‡å¯¹æ–¹çš„LOCKæ¥å”¤é†’å¯¹æ–¹</p>
<p>ç”Ÿäº§/æ¶ˆè´¹åˆ°è¾¾limitä¹‹åï¼Œå„åœ¨è‡ªå·±çš„LOCKä¸Šç­‰å¾…</p>
<p>æ¶ˆè´¹è€…ä¹‹é—´é€šè¿‡æ¶ˆè´¹è€…LOCKä¿è¯æ¶ˆè´¹åŒæ­¥ï¼Œç”Ÿäº§è€…ä¹‹é—´é€šè¿‡ç”Ÿäº§è€…LOCKä¿è¯ç”Ÿäº§åŒæ­¥</p>

          <h3 id="837b6316">
            <a name="_root-åŒé‡æ£€æŸ¥é”å»¶è¿Ÿåˆå§‹åŒ–çš„é”™è¯¯ä¸æ­£ç¡®ç¤ºèŒƒ" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            åŒé‡æ£€æŸ¥é”å»¶è¿Ÿåˆå§‹åŒ–çš„é”™è¯¯ä¸æ­£ç¡®ç¤ºèŒƒ
          </h3><p>å…³äºåŒé‡æ£€æŸ¥é”çš„ç”±æ¥å°±ä¸å†å¤šè¯´ï¼Œæˆ‘ä»¬çœ‹çœ‹åŒé‡æ£€æŸ¥çš„é”™è¯¯ç¤ºèŒƒï¼š</p>
<pre><code class="language-java">public class DoubleCheckLocking {
    private static Instance instance;
    public static Instance getInstance() {
        if (instance == null) {                            // ç¬¬ä¸€æ¬¡æ£€æŸ¥
            synchronized(DoubleCheckLocking.class) {    // åŠ é”
                if (instance == null) {                    // ç¬¬äºŒæ¬¡æ£€æŸ¥
                    instance = new Instance();            // åˆå§‹åŒ–ï¼šè¿™é‡Œæœ‰å‘
                }
            }
        }
        return instance;
    }
}</code></pre>
<blockquote>
<p>åŒé‡æ£€æŸ¥é”çœ‹èµ·æ¥å¾ˆå®Œç¾ï¼Œä½†æ˜¯è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰è€ƒè™‘å®Œæ•´çš„ä¼˜åŒ–ï¼</p>
<p>åœ¨çº¿ç¨‹æ‰§è¡Œåˆ°line4çš„æ—¶å€™ï¼Œä»£ç è¯»å–åˆ°instanceä¸ä¸ºç©ºï¼Œä½†æ˜¯instanceæ‰€å¼•ç”¨çš„å¯¹è±¡å¯èƒ½è¿˜æ²¡æœ‰å®Œæˆå¯¹è±¡åˆå§‹åŒ–</p>
<p>å³ç°åœ¨ä¸ä¸ºç©ºçš„å¯¹è±¡å…¶å®å¹¶ä¸å…·å¤‡å·¥ä½œèƒ½åŠ›</p>
</blockquote>

          <h4 id="dd6b17e8">
            <a name="_root-æ¢ç©¶" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            æ¢ç©¶
          </h4><p>ä»£ç çš„ç¬¬ä¸ƒè¡Œï¼ˆ<code>instance = new Instance();</code>ï¼‰é—®é¢˜å°±å‡ºåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™å¥è¯åˆ†è§£ä¸ºä»¥ä¸‹ä¸‰è¡Œï¼š</p>
<ol>
<li>memory = allocate();        // 1 åˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´</li>
<li>ctorInstance(memory);       // 2 åˆå§‹åŒ–å¯¹è±¡</li>
<li>instance = memory;            // 3 è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€</li>
<li>// åç»­å¯¹instanceå¯¹è±¡çš„è®¿é—®</li>
</ol>
<p>ä¸Šé¢çš„2ã€3è¡Œä»£ç ï¼Œåœ¨æŸäº›ç¼–è¯‘å™¨ä¸­å¯èƒ½ä¼šè¢«é‡æ’åºï¼Œå¯èƒ½æ˜¯3å…ˆ2åï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ï¼Œå¯¹è±¡ä¸ä¸ºç©ºï¼Œä½†æ˜¯å¯¹è±¡å¹¶ä¸å…·å¤‡å·¥ä½œçš„å¯èƒ½ï¼Œä¸ºä»€ä¹ˆJMMä¼šå…è®¸è¿™æ ·çš„é‡æ’åºï¼Ÿè¯´ç™½äº†ï¼ŒJMMé‡æ’åºï¼Œå…è®¸è¿™æ ·çš„é‡æ’åºå› ä¸ºåœ¨å•çº¿ç¨‹æƒ…å†µä¸‹è¿™æ ·çš„é‡æ’åºå¹¶ä¸å½±å“ç¨‹åºç»“æœï¼Œ1234æ— è®ºæ€æ ·ï¼Œåªè¦ä¿è¯2åœ¨4ä¹‹å‰å°±å¥½äº†</p>
<p>è¿™æ ·çš„é‡æ’åºåœ¨<code>å•çº¿ç¨‹</code>çš„æƒ…å†µä¸‹æ˜¯èƒ½å®‰å…¨åœ°èµ·åˆ°ä¼˜åŒ–ä½œç”¨çš„ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹å°±ä¼šå‡ºé—®é¢˜äº†ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªè¡¨ï¼š</p>
<table>
<thead>
<tr>
<th align="center">æ—¶é—´</th>
<th align="center">çº¿ç¨‹A</th>
<th align="center">çº¿ç¨‹B</th>
</tr>
</thead>
<tbody><tr>
<td align="center">t1</td>
<td align="center">A1ï¼šåˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">t2</td>
<td align="center">A3ï¼šè®¾ç½®instanceæŒ‡å‘å†…å­˜ç©ºé—´</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">t3</td>
<td align="center"></td>
<td align="center">B1ï¼šåˆ¤æ–­instanceæ˜¯å¦ä¸ºç©º</td>
</tr>
<tr>
<td align="center">t4</td>
<td align="center"></td>
<td align="center">B2ï¼šä¸ä¸ºç©ºï¼Œè®¿é—®instanceå¼•ç”¨çš„å¯¹è±¡</td>
</tr>
<tr>
<td align="center">t5</td>
<td align="center">A2ï¼šåˆå§‹åŒ–å¯¹è±¡</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">t6</td>
<td align="center">A4ï¼šè®¿é—®instanceå¼•ç”¨çš„å¯¹è±¡</td>
<td align="center"></td>
</tr>
</tbody></table>
<p>åœ¨t4æ—¶åˆ»ï¼Œçº¿ç¨‹Bè®¿é—®åˆ°çš„å¯¹è±¡æ˜¯ä¸å…·å¤‡å·¥ä½œèƒ½åŠ›çš„å¯¹è±¡ï¼Œè¿™æ ·çš„å¯¹è±¡æ²¡æœ‰æ„ä¹‰ã€‚</p>
<p>æˆ‘ä»¬è¦ä¿®æ­£è¿™ä¸ªé”™è¯¯ï¼Œæœ‰ä¸¤ç§åŠæ³•ï¼š</p>
<ul>
<li>ç¦æ­¢2å’Œ3çš„é‡æ’åº</li>
<li>å…è®¸é‡æ’åºï¼Œä½†æ˜¯ç¦æ­¢å…¶ä»–çº¿ç¨‹æ„ŸçŸ¥åˆ°è¿™ä¸ªé‡æ’åº</li>
</ul>

          <h4 id="4e8be891">
            <a name="_root-åŸºäºvolatileçš„è§£å†³æ–¹æ³•" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            åŸºäºvolatileçš„è§£å†³æ–¹æ³•
          </h4><pre><code class="language-java">public class SafeDoubleCheckLocking {
    private static volatile Instance instance;
    public static Instance getInstance() {
        if (instance == null) {                            
            synchronized(SafeDoubleCheckLocking.class) {    
                if (instance == null) {                    
                    instance = new Instance();            
                }
            }
        }
        return instance;
    }
}</code></pre>
<p>å°†instanceå£°æ˜ä¸ºvolatileå˜é‡ï¼Œè¿™æ ·åšå¯ä»¥<strong>ç¦æ­¢2å’Œ3çš„é‡æ’åº</strong></p>

          <h4 id="b570e7b5">
            <a name="_root-åŸºäºå†…éƒ¨ç±»å’Œç±»åˆå§‹åŒ–çš„è§£å†³æ–¹æ¡ˆ" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            åŸºäºå†…éƒ¨ç±»å’Œç±»åˆå§‹åŒ–çš„è§£å†³æ–¹æ¡ˆ
          </h4><p>åœ¨JVMåˆå§‹åŒ–ç±»çš„æ—¶å€™ï¼ŒJVMé¦–å…ˆä¼šè·å–ä¸€ä¸ªé”ï¼Œä¿è¯å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆå§‹åŒ–è¿™ä¸ªç±»çš„åŒæ­¥æ€§ï¼Œè€Œç±»çš„åŠ è½½å’Œåˆå§‹åŒ–å·¥ä½œï¼Œä¼šå‡†å¤‡å¥½ç±»ä¸­æ‰€æœ‰çš„é™æ€å˜é‡</p>
<p>åŸºäºè¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰å¦å¤–ä¸€ç§çº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–æ–¹æ¡ˆâ€”â€”<code>Initialization On Demand Holder idiom</code></p>
<pre><code class="language-java">public class InstanceFactory {
    private statci class InstanceHolder {
        public static Instance instance = new Instance();
    }
    public static Instance getInstance() {
        return InstanceHolder.instance;    // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¼•ç”¨ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªåœ°æ–¹å°±ä¼šåŠ è½½ä¸Šé¢é‚£ä¸ªå†…éƒ¨ç±»
    }
}</code></pre>
<p>è¿™ä¸ªæ–¹æ¡ˆçš„æœ¬è´¨æ˜¯ï¼šè®©å…¶ä»–çº¿ç¨‹çœ‹ä¸åˆ°åˆå§‹åŒ–ç±»çº¿ç¨‹çš„å†…éƒ¨é‡æ’åºï¼Œåªèƒ½æ„ŸçŸ¥åˆ°ç»“æœ</p>
<p>ç­‰äºè¯´ï¼Œæˆ‘ä»¬åšçº¿ç¨‹å®‰å…¨å•ä¾‹ï¼Œå…¶å®åªéœ€è¦ä¸€ä¸ª<strong>â€œä¸€æ¬¡æ€§é”â€</strong>ï¼Œè€Œç±»åˆå§‹åŒ–çš„è¿™ä¸ªç‰¹æ€§æ°å¥½å°±æ˜¯ä¸€ä¸ª<strong>â€œä¸€æ¬¡æ€§é”â€</strong></p>
<p>è¿™ä¸ªé”ç§°ä¹‹ä¸ºâ€”â€”<strong>åˆå§‹åŒ–é”ï¼ˆLCï¼‰</strong>ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¹¦é‡Œæ˜¯æ€ä¹ˆä»‹ç»çš„ï¼š</p>
<blockquote>
<p>Javaè¯­è¨€è§„èŒƒè§„å®šï¼Œå¯¹äºæ¯ä¸€ä¸ªç±»æˆ–æ¥å£Cï¼Œéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åˆå§‹åŒ–é”ï¼ˆLCï¼‰ä¸ä¹‹å¯¹åº”ã€‚ä»Cåˆ°LCçš„æ˜ å°„ï¼Œç”±JVMè‡ªç”±å®ç°ã€‚JVMåœ¨ç±»åˆå§‹åŒ–æœŸé—´ä¼šè·å–è¿™ä¸ªåˆå§‹åŒ–é”ï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹è‡³å°‘è¦è·å–ä¸€æ¬¡é”æ¥ç¡®ä¿è¿™ä¸ªç±»å·²ç»è¢«åˆå§‹åŒ–è¿‡äº†ã€‚</p>
</blockquote>

    </div>
    <div id="scriptsearcher" class="myhide input-group new_font">
        <input id="searchtext" type="text" class="form-control" placeholder="keywords" autocomplete="off">
        <div class="input-group-append">
            <button id="searchbut" class="btn btn-dark" type="button">Search</button>
        </div>
    </div>

    <div id="bbt" class="myhide new_font">
        <a id="toc" style="display: none;" class="myhide" href="javascript:void(0);" data-toggle="tooltip" data-placement="left" title="show/hide Toc">Toc</a>
        <a id="gohub" href="#" target="_blank" data-toggle="tooltip" data-placement="bottom" title="view this at github">unuse</a>
    </div>

    <div id="share_png_panel" class="myhide">
        <div id="share_curtain"></div>
        <div id="png_box"></div>
        <button id="share_png_paned_close" class="btn btn-dark">Close</button>
    </div>

</body>

</html>