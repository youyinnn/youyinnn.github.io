<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="baidu-site-verification" content="l09YSIpJQW" />
    <meta name="referrer" content="origin">
    <title>blog | youyinnn</title>
    <script src="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/myjs/loadscripts.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/myjs/jump-1.2.js"></script>
    <link rel="bookmark" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/youyinnn/youyinnn.github.io@master/img/favicon.ico" />
    <link rel="stylesheet" href="/mycss/style.css">

    <script src="/resources/resources.js"></script>
    <script src="/myjs/scriptlist.js"></script>
</head>

<body>

    <ol id="topbar" class="breadcrumb unselectable new_font">
        <p style="color:rgb(214, 214, 214); padding-right: 1rem;">
            <button id="egg" class="egg">ğŸš€</button>&nbsp;&nbsp;&nbsp;&nbsp;&gt;</p>
        <li class="breadcrumb-item">
            <spen id="homebut" href="javaScript:void(0)" class="ah">-home</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="articlesbut" href="javaScript:void(0)" class="ah">-articles</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="scriptbut" href="javaScript:void(0)" class="ah">-scripts</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="todobut" href="javaScript:void(0)" class="ah">-todos</spen>
        </li>
        <li class="breadcrumb-item">
            <spen id="resumebut" href="javaScript:void(0)" class="ah">-resume</spen>
        </li>
        <li class="breadcrumb-item dropdown">
            <spen href="javaScript:void(0)" class="ah" role="button" id="friendlinkedbut" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">-friends</spen>
            <div id="fldd" class="dropdown-menu" aria-labelledby="friendlinkedbut" style="border-radius: initial;"></div>
        </li>

        <div id="hb" data-toggle="tooltip" data-placement="bottom" title="show/hide TopBar">

        </div>
    </ol>

    <div id="homepage" class="unselectable new_font myhide">
        <span id="slogan">
            <i id="wolf-logo" style="font-style: normal;" class="mr-4">ğŸŒ‘</i>I'M BACK
        </span>
        <div id="showmore"> &gt; About Me & This Blog</div>
        <div id="showhacknical"> &gt; My Github Analysis</div>
        <div id="toarticles"> &gt; My Tech Articles</div>
        <div id="ifwrapper" class="hacknical_hide">
            <iframe id="hacknical_github_analysis" frameborder="0"></iframe>
        </div>
    </div>

    <div id="series" class="unselectable">
        <span>ç³»</span>
        <span>åˆ—</span>
        <span>æ–‡</span>
        <span>ç« </span>
    </div>
    <div id="seriesbox" class="unselectable">

    </div>

    <div id="articles_side_panel" class="unselectable myhide new_font">
        <div id="cates_tree_head">Article Categories</div>
        <div id="cates_tree_body"></div>
        <div id="blog_statistic_head">Blog Statistic</div>
        <table id="blog_statistic_body" class="myhide">
            <tbody>
                <tr>
                    <td style="text-align:right">Site running days:</td>
                    <td style="text-align:left" id="stat_running"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Total article:</td>
                    <td style="text-align:left" id="stat_article_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Char count:</td>
                    <td style="text-align:left" id="stat_typein"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Category count:</td>
                    <td style="text-align:left" id="stat_cate_count"></td>
                </tr>
                <tr>
                    <td style="text-align:right">Tag count:</td>
                    <td style="text-align:left" id="stat_tag_count"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="docpanel" class="myhide new_font">
        <div id="articlesearch" class="input-group">
            <input id="articlesearchtext" type="text" class="form-control" autocomplete="off" placeholder="search">
            <div class="input-group-append">
                <button id="cleanbut" class="btn btn-light" type="button" title="clear search">cls</button>
                <button id="categories" class="btn btn-light" type="button">cates</button>
                <button id="tags" class="btn btn-light" type="button" title="all tags">tags</button>
                <button id="articlesearchbut" class="btn btn-light" type="button" title="search">sch</button>
            </div>
        </div>
        <div class="tgs myhide" id="all_cates">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All categories:</span>
            <br>
        </div>
        <div class="tgs myhide" id="all_tags">
            <span style="font-size: 1rem; font-weight: bold ; padding: 6px;">All tags:</span>
            <br>
        </div>
    </div>

    <div id="sidetoccontainer" class="tochide unselectable new_font">
        <div id="block">
            <div id="percent" data-toggle="tooltip" data-placement="bottom" title="return to the top">0%</div>
        </div>
        <div id="sidetoc" class="unselectable markdown-body editormd-preview-container markdown-toc"></div>
    </div>
    <div id="md" class="myhide markdown-body editormd-html-preview">
        
          <h4>
            <a name="_root-ArrayListç±»" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            ArrayListç±»
          </h4><p>å¯¹ç»ˆäºè¦æ­£å¼å¼€å§‹è¯»<strong>ArrayList</strong>çš„æºç äº†ï¼Œè™½ç„¶<strong>ArrayList</strong>çš„æºç ä»·å€¼å¹¶ä¸æ˜¯é‚£ä¹ˆåœ°å¤§ï¼Œä½†ä½œä¸ºé›†åˆæ¡†æ¶æºç é˜…è¯»çš„ç¬¬ä¸€ç«™æ¥è¯´ï¼Œæˆ‘é€‰æ‹©äº†åœ¨è¿™é‡Œç«™ç¨³è„šè·Ÿ</p>
<p>è¿™ä¸ªè®¡åˆ’æç½®äº†å¾ˆä¹…ï¼Œå¤§æ¦‚æœ‰15å¤©ï¼Œä¸­é—´è·‘å»é¢è¯•äº†ä¸€ä¸ªæ˜ŸæœŸï¼Œé¢è¯•ä¸‹æ¥å‘ç°è‡ªå·±çš„åŸºç¡€å·²ç»å¿˜çš„å·®ä¸å¤šäº†ï¼Œå†³å®šå›æ¥å¥½å¥½æ²‰æ·€ä¸€æ®µæ—¶é—´ï¼Œæš‘æœŸå®ä¹ offeræœ‰æ²¡æœ‰å·²ç»ä¸é‡è¦äº†ï¼Œ<strong>å‰‘æŒ‡ç§‹æ‹›ï¼</strong></p>
<p>ä¸ºä»€ä¹ˆè¦è¯»å®ƒï¼Œå› ä¸ºçº¿æ€§è¡¨å‡ ä¹æ˜¯æ•°æ®ç»“æ„çš„åŸºç¡€å¿…å¤‡ï¼Œæ˜¨æ™šèŠ±äº†å°†è¿‘1å°æ—¶æ‰‹æ’¸äº†ä¸€ä¸ªArrayListçš„è‡ªå®ç°ï¼Œå†æ­é…æºç æ¥çœ‹<strong>è‡ªå·±åœ¨åŸºç¡€æ–¹æ³•ä¸Šæœ‰å“ªäº›æ²¡è€ƒè™‘åˆ°çš„ç‚¹</strong>ï¼Œä»¥åŠ<strong>å®é™…æŠ•å…¥ä½¿ç”¨çš„ArrayListåˆ°åº•ä¼˜ç§€åœ¨å“ªé‡Œ</strong></p>

          <h4>
            <a name="_root-æºç " class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            æºç 
          </h4>
          <h5>
            <a name="_root-ç±»å¤´" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            ç±»å¤´
          </h5><pre><code class="language-java">public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt;
        implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable
{
    //...
}</code></pre>
<p>é¦–å…ˆç»§æ‰¿äº†<code>AbstractList</code></p>
<p>æˆ‘ä»¬é¡ºç€<code>AbstractList</code>å¾€é‡Œæ‘¸ï¼Œä¸€ç›´åˆ°æœ€åæˆ‘ä»¬å‘ç°ï¼Œè¿˜æœ‰<strong>Collectionæ¥å£å’ŒIterableæ¥å£</strong>ï¼Œè¿™ä¸¤ä¸ªæ¥å£åŠ ä¸Š<strong>Listæ¥å£</strong>ä¸ºæˆ‘ä»¬æä¾›äº†éå¸¸é‡è¦çš„é›†åˆæ¥å£è§„èŒƒ</p>
<p>ç„¶åæˆ‘ä»¬å¾€ä¸‹çœ‹</p>

          <h5>
            <a name="_root-æˆå‘˜å˜é‡" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            æˆå‘˜å˜é‡
          </h5><p>ArrayListè¿™ä¸ªç±»çš„æˆå‘˜å˜é‡å¹¶ä¸å¤æ‚</p>
<pre><code class="language-java">// è¿™æ˜¯é»˜è®¤çš„å®¹å™¨é•¿åº¦
private static final int DEFAULT_CAPACITY = 10;

// è¿™æ˜¯ä¸€ä¸ªç©ºçš„å®¹å™¨æ•°ç»„
private static final Object[] EMPTY_ELEMENTDATA = {};

// è¿™æ˜¯é»˜è®¤å®¹é‡çš„ç©ºçš„å®¹å™¨æ•°ç»„ ç”¨è¿™ä¸ªæ•°ç»„å’Œä¸Šé¢é‚£ä¸ªæ•°ç»„å¯¹æ¯”
// æ¥åˆ†è¾¨å‡ºç¬¬ä¸€ä¸ªå…ƒç´ è¢«æ·»åŠ è¿›æ¥çš„æ—¶å€™åˆ°åº•æœ‰å¤šè†¨èƒ€
private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};

// å­˜å‚¨å…ƒç´ çš„æ•°ç»„
// ArrayListçš„å®¹é‡å°±æ˜¯è¿™ä¸ªæ•°ç»„çš„é•¿åº¦
// åœ¨ç©ºæ•°ç»„çš„æƒ…å†µä¸‹ å¦‚æœ elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA
// é‚£ä¹ˆæˆ‘ä»¬åŠ å…¥ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ä¼šé€‰æ‹©ä»¥DEFAULT_CAPACITYä¸ºåˆè¯•å®¹é‡å»æ‰©å±•å®¹å™¨
transient Object[] elementData; // non-private to simplify nested class access

// åŒ…å«å…ƒç´ çš„ä¸ªæ•° æˆ‘æ›´æ„¿æ„å°†sizeå«æˆæ˜¯è½½é‡
private int size;</code></pre>
<p>å…¶ä¸­æœ€é‡è¦çš„æ˜¾ç„¶å°±æ˜¯<strong>elementData</strong>è¿™ä¸ªå˜é‡äº†ï¼Œå®ƒå°±æ˜¯æ•´ä¸ªå®¹å™¨çš„æ ¸å¿ƒ</p>
<p>å…¶æ¬¡å°±æ˜¯<strong>size</strong>è¿™ä¸ªå˜é‡ï¼Œåœ¨<strong>çº¿æ€§ç»“æ„</strong>ä¸­ï¼Œæˆ‘ä»¬å¸¸æ¥è§¦åˆ°çš„ä¸¤ä¸ªæ¦‚å¿µï¼š<strong>capacityï¼ˆå®¹é‡ï¼‰ã€sizeï¼ˆå¤§å°ï¼‰</strong></p>
<p>å‰è€…è¡¨ç¤ºå®¹å™¨<strong>èƒ½è£…å¤šå°‘</strong>ï¼Œåè€…è¡¨ç¤ºå®¹å™¨<strong>è£…äº†å¤šå°‘</strong>ï¼Œä½†æˆ‘ä»¬ä½¿ç”¨åè€…çš„æ—¶å€™ï¼Œæ€»è¯´<strong>â€œè¿™ä¸ªå®¹å™¨å¤§å°æ˜¯å¤šå°‘â€</strong>ï¼Œè¿™ä¸ª<strong>â€å¤§å°â€œ</strong>çš„è¯´æ³•å¾ˆå®¹æ˜“å’Œ<strong>â€œå®¹é‡â€</strong>æ··ä¸ºä¸€è°ˆ</p>
<p>æ‰€ä»¥æˆ‘æ›´æ„¿æ„å°†<strong>size</strong>å«æˆæ˜¯<strong>è½½é‡ï¼ˆloaded sizeï¼‰</strong></p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦ç•™æ„ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡æ¥è‡ªäº<strong>AbstractListæŠ½è±¡ç±»</strong></p>
<pre><code class="language-java">protected transient int modCount = 0;</code></pre>
<p>è¿™ä¸ªå€¼è®°å½•ç€Listçš„<strong>ç»“æ„è¢«æ”¹å˜çš„æ¬¡æ•°</strong>ï¼Œç»“æ„æ”¹å˜æŒ‡çš„æ˜¯<strong>ä»»ä½•ä¼šå½±å“åˆ°sizeçš„æ“ä½œ</strong><br>å› ä¸ºè¿™äº›æ”¹åŠ¨ï¼Œå¯èƒ½ä¼š<strong>æ‰°ä¹±å®¹å™¨ç»“æ„</strong>ï¼Œè€Œå¯¼è‡´è¿­ä»£è¿‡ç¨‹ä¼šå‡ºç°é”™è¯¯çš„ç»“æœ<br>è¿™ä¸ªå˜é‡ä¼šåœ¨è¿­ä»£å™¨ä¸­å»è¡¥å……ä¸€äº›é€»è¾‘ï¼Œæ¯”å¦‚éæ³•çš„ä¿®æ”¹ä¼šæ‰°ä¹±è¿­ä»£è¿‡ç¨‹ï¼Œåˆ™<strong>ä¼šæŠ›å‡ºå¼‚å¸¸</strong><br>å¦‚æœå­ç±»ä¹Ÿè¦ç”¨åˆ°è¿™ä¸ªå˜é‡ï¼Œè¦æ±‚<strong>æ¯ä¸€ä¸ªå¯èƒ½æ”¹åŠ¨å®¹å™¨ç»“æ„çš„æ“ä½œéƒ½éœ€è¦è°ƒç”¨ä¸€æ¬¡è¿™ä¸ªå˜é‡</strong></p>

          <h5>
            <a name="_root-æ„é€ æ–¹æ³•" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            æ„é€ æ–¹æ³•
          </h5><p>æ€»å…±æœ‰ä¸‰ä¸ªï¼Œæˆ‘ä»¬åªå…³å¿ƒå‰ä¸¤ä¸ªå°±å¥½äº†</p>
<pre><code class="language-java">public ArrayList(int initialCapacity) {
    if (initialCapacity &gt; 0) {
        this.elementData = new Object[initialCapacity];
    } else if (initialCapacity == 0) {
        this.elementData = EMPTY_ELEMENTDATA;
    } else {
        throw new IllegalArgumentException(&quot;Illegal Capacity: &quot;+
                                           initialCapacity);
    }
}
public ArrayList() {
    this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
}</code></pre>
<p>è¿™é‡Œç»™å‡ºäº†æˆ‘ä»¬çš„ä¸¤ä¸ªå¸¸é‡<strong>EMPTY_ELEMENTDATA</strong>å’Œ<strong>DEFAULTCAPACITY_EMPTY_ELEMENTDATA</strong>çš„å»å¤„ï¼Œåœ¨æˆ‘çš„è‡ªå®ç°é‡Œï¼Œ<strong>æ— è®ºæ˜¯å“ªç§æ–¹æ³•æˆ‘éƒ½é€‰æ‹©äº†newå‡ºæ•°ç»„å¯¹è±¡</strong>ï¼Œè€Œè¿™é‡Œè¿˜ä¼šæœ‰ç‚¹å·æ‡’ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šå®¹é‡çš„è¯ï¼Œåˆ™å¹¶ä¸ä¼š<strong>new Object[DEFAULT_CAPACITY]</strong>ï¼Œç­‰åˆ°çœŸæ­£è¦åŠ å…¥å…ƒç´ çš„æ—¶å€™ï¼Œæ‰åˆ›å»ºå¯¹è±¡ï¼Œè¿™åœ¨ä¸‹é¢addæ–¹æ³•çš„æ—¶å€™ä¼šçœ‹åˆ°</p>

          <h5>
            <a name="_root-æˆå‘˜æ–¹æ³•" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            æˆå‘˜æ–¹æ³•
          </h5><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿›å…¥æˆå‘˜æ–¹æ³•éƒ¨åˆ†</p>

          <h6>
            <a name="_root-trimToSize" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            trimToSize
          </h6><pre><code class="language-java">public void trimToSize() {
    modCount++;
    if (size &lt; elementData.length) {
        elementData = (size == 0)
          ? EMPTY_ELEMENTDATA
          : Arrays.copyOf(elementData, size);
    }
}</code></pre>
<p>é¦–å½“å…¶å†²å°±æ˜¯è¿™ä¸ªæ–¹æ³• è¯¥æ–¹æ³•ç”¨äº<strong>ä¿®å‰ªå®¹å™¨çš„å®¹é‡</strong></p>
<p>æ€ä¹ˆä¸ª<strong>ä¿®å‰ª</strong>æ³•ï¼Ÿå°†å®¹å™¨çš„<strong>â€å®¹é‡â€œ</strong>ä¿®å‰ªä¸ºå½“å‰åˆ—è¡¨çš„<strong>è½½é‡</strong>ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†<strong>ä¼˜åŒ–å®¹å™¨å¯¹è±¡æ‰€å å­˜å‚¨ç©ºé—´</strong></p>
<p>æ¯”å¦‚æˆ‘ä»¬å®¹å™¨åˆå§‹å®¹é‡ä¸º10ï¼Œé‡Œé¢è£…äº†3ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå°±æœ‰<strong>7ä¸ªå…ƒç´ ç©ºé—´æ˜¯è¢«nullå ç€çš„</strong></p>
<p>å‡è®¾æˆ‘ä»¬å®¹å™¨çš„ä½¿ç”¨åœºæ™¯æ€»æ˜¯åœ¨å°äºç­‰äº3çš„æƒ…å†µä¸‹å·¥ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æŠŠå®¹å™¨çš„å®¹é‡ä¿®å‰ªä¸€ä¸‹</p>
<p><strong>ä¿®å‰ªå‰ï¼š</strong>[a, b, c, <strong>null, null, null, null, null, null, null</strong>]</p>
<p><strong>ä¿®å‰ªåï¼š</strong>[a, b, c]</p>
<p>å¹¶ä¸”<strong>ä¿®å‰ª</strong>æ“ä½œä¼šè®¿é—®<strong>modCount</strong>å˜é‡ï¼Œæ„å‘³ç€è¿™å‘Šè¯‰å®¹å™¨çš„<strong>è¿­ä»£å™¨</strong>ï¼Œè¿™ä¸ªä¿®å‰ªæ–¹æ³•å¯èƒ½ä¼š<strong>æ‰°ä¹±è¿­ä»£è¿‡ç¨‹</strong></p>
<p>åœ¨ä¿®å‰ªçš„æ—¶å€™ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†è¿™æ ·çš„ä¸€ä¸ªæ–¹æ³•ï¼š<strong>Arrays.copyOf(elementData, size)</strong></p>

          <h6>
            <a name="_root-Arrays.copyOf" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            Arrays.copyOf
          </h6><pre><code class="language-java">public static &lt;T&gt; T[] copyOf(T[] original, int newLength) {
    return (T[]) copyOf(original, newLength, original.getClass());
}

public static &lt;T,U&gt; T[] copyOf(U[] original, int newLength, Class&lt;? extends T[]&gt; newType) {
    T[] copy = ((Object)newType == (Object)Object[].class)
        ? (T[]) new Object[newLength]
        : (T[]) Array.newInstance(newType.getComponentType(), newLength);
    System.arraycopy(original, 0, copy, 0,
                     Math.min(original.length, newLength));
    return copy;
}</code></pre>
<p>é‡ç‚¹æ˜¯<strong>lineï¼š10</strong>ï¼Œæ•´ä¸ªæ–¹æ³•æ˜¯æŒ‰ç…§<strong>æºæ•°ç»„çš„é•¿åº¦ï¼ˆoriginal.lengthï¼‰</strong>ä»¥åŠ<strong>æ–°é•¿åº¦ï¼ˆnewLengthï¼‰</strong>çš„æœ€å°å€¼å»å¤åˆ¶æ•°ç»„çš„</p>

          <h6>
            <a name="_root-ensureCapacity" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            ensureCapacity
          </h6><pre><code class="language-java">public void ensureCapacity(int minCapacity) {
    int minExpand = (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA)
        ? 0
        : DEFAULT_CAPACITY;

    if (minCapacity &gt; minExpand) {
        ensureExplicitCapacity(minCapacity);
    }
}</code></pre>
<p>è¿™ä¸ªæ–¹æ³•ç”¨äºæå‡å®¹å™¨çš„å®¹é‡ï¼Œè¿™ä¸ªæ–¹æ³•å‘Šè¯‰å®¹å™¨ï¼š<strong>è‡³å°‘è¦ä¿è¯æ ¹æ®ä¼ å…¥çš„æœ€å°å®¹é‡ï¼ˆminCapacityï¼‰å‚æ•°é‚£ä¹ˆå¤šçš„å®¹é‡</strong></p>
<p>åœ¨è¿™ä¸ªæ–¹æ³•é‡Œçš„é€‰æ‹©æ˜¯ï¼š</p>
<ul>
<li>å¯¹äº<strong>æœ€å°æ‰©å®¹é‡ï¼ˆminExpandï¼‰</strong>ï¼Œå¦‚æœå½“å‰å®¹å™¨ä¸ºç©ºå®¹å™¨ï¼Œåˆ™æœ€å°æ‰©å®¹é‡ä¸º<strong>DEFAULT_CAPACITYï¼ˆ10ï¼‰</strong>ï¼Œå¦‚æœå®¹å™¨<strong>ä¸æ˜¯ç©ºå®¹å™¨</strong>ï¼Œåˆ™æœ€<strong>å°æ‰©å®¹é‡ä¸º0</strong></li>
<li>ä¸€æ—¦<strong>æœ€å°å®¹é‡ï¼ˆminCapacityï¼‰&gt; æœ€å°æ‰©å®¹é‡ï¼ˆminExpandï¼‰</strong>ï¼Œåˆ™éœ€è¦<strong>ç¡®ä¿æ˜¾å¼å®¹é‡</strong></li>
</ul>
<p>è¿™é‡Œçš„ç†è§£æœ‰ç‚¹ç»•ï¼Œæˆ‘ä»¬æŠŠå®ƒæ”¾åˆ°åœºæ™¯å»åˆ†æä¸€ä¸‹ï¼š</p>
<p><strong>åœºæ™¯1ï¼Œç©ºå®¹å™¨ï¼š</strong></p>
<p>ç©ºå®¹å™¨ä¼ è¿›æ¥ï¼Œ<strong>minExpand</strong>å°±å¾—<strong>DEFAULT_CAPACITY</strong>ç­‰äº10ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä¼ å…¥çš„<strong>minCapacity</strong>ç”šè‡³å°äºé»˜è®¤çš„å®¹é‡ï¼Œé‚£ä½ å°±<strong>ä¸€è¾¹å‘†ç€å§</strong></p>
<p>å¦‚æœå¤§äº10ï¼Œé‚£å°±<strong>æŒ‰ç…§ä½ çš„æ¥</strong>ï¼Œè™½ç„¶è¿˜å¾—è¿›<strong>ensureExplicitCapacityæ–¹æ³•</strong>ï¼Œä½†æ˜¯çœ‹åˆ°äº†åé¢å°±ä¼šå‘ç°ï¼Œç¡®å®æ˜¯ä¼šæŒ‰ç…§ä½ ç»™çš„å¤§äº10çš„å€¼æ¥æ‰©å®¹</p>
<p><strong>åœºæ™¯2ï¼Œ[ 1 / 10 ] çš„å®¹å™¨ï¼š</strong></p>
<p><strong>minExpand</strong>è‚¯å®šæ˜¯0ï¼Œé‚£ä¹ˆåªè¦æˆ‘ä»¬ä¼ å…¥çš„ä¼ å…¥çš„<strong>minCapacity</strong>å¤§äº0ï¼Œæ˜¯è‚¯å®šå¯ä»¥è¿›<strong>ensureExplicitCapacityæ–¹æ³•</strong>çš„ï¼Œåˆ°äº†æ–¹æ³•é‡Œé¢æˆ‘ä»¬å‘ç°ï¼Œå¦‚æœä½ ç»™çš„<strong>minCapacity</strong>è¿˜æ²¡æœ‰å½“å‰å®¹å™¨é•¿åº¦çš„<strong>1.5å€</strong>å¤§ï¼Œé‚£ä¹ˆå®¹å™¨è‡³å°‘ä¹Ÿä¼šæ‰©åˆ°<strong>1.5å€</strong>è€Œå¿½ç•¥ä½ ç»™çš„å€¼ï¼Œå¤§äº<strong>1.5å€</strong>æ•‘ä¼šé‡‡ç”¨ä½ ç»™å€¼æ¥æ‰©å®¹</p>
<p>ä¸ºä»€ä¹ˆæ˜¯<strong>1.5å€</strong>ï¼Ÿå¾€ä¸‹çœ‹å°±çŸ¥é“äº†</p>
<p>æˆ‘ä»¬æ¥çœ‹<strong>ensureExplicitCapacityæ–¹æ³•</strong></p>
<pre><code class="language-java">private void ensureExplicitCapacity(int minCapacity) {
    modCount++;

    // overflow-conscious code
    if (minCapacity - elementData.length &gt; 0)
        grow(minCapacity);
}</code></pre>
<p>é™¤äº†ä¼šæ”¹å˜å®¹å™¨ç»“æ„ï¼Œæˆ‘ä»¬è¿˜å¾—æ³¨æ„ï¼šå½“<strong>å…è®¸çš„æœ€å°å®¹é‡ï¼ˆminCapacityï¼‰</strong>å¤§äº<strong>å½“å‰å®¹å™¨å®¹é‡ï¼ˆelementData.lengthï¼‰</strong>çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦è¿›è¡Œ<strong>æº¢å‡ºè€ƒè™‘(overflow-conscious)</strong>äº†</p>

          <h6>
            <a name="_root-grow" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            grow
          </h6><pre><code class="language-java">private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;

private void grow(int minCapacity) {
    // overflow-conscious code
    int oldCapacity = elementData.length;
    int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);
    if (newCapacity - minCapacity &lt; 0)
        newCapacity = minCapacity;
    if (newCapacity - MAX_ARRAY_SIZE &gt; 0)
        newCapacity = hugeCapacity(minCapacity);
    // minCapacity is usually close to size, so this is a win:
    elementData = Arrays.copyOf(elementData, newCapacity);
}</code></pre>
<p>è¿™é‡Œè§„å®šï¼š<strong>æ•°ç»„æœ€å¤§çš„é•¿åº¦ï¼ˆMAX_ARRAY_SIZEï¼‰</strong>ä¸ºIntegerå€¼æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§çš„æ•°å‡8ï¼Œä¹Ÿå°±æ˜¯<strong>(2^31 - 1) - 8</strong></p>
<p>åœ¨æ–¹æ³•é‡Œé¦–å…ˆè€ƒè™‘<strong>æ–°å®¹é‡ï¼ˆnewCapacityï¼‰</strong>æ€ä¹ˆå®šä¹‰ï¼š</p>
<ul>
<li><strong>å…ˆå®šä¹‰æ–°å®¹é‡ä¸ºæ—§å®¹é‡çš„1.5å€ï¼ˆlineï¼š6ï¼‰ï¼</strong> </li>
<li>ä¸€æ—¦<strong>æ–°å®¹é‡ï¼ˆ1.5å€ï¼‰</strong>æ¯”<strong>å…è®¸çš„æœ€å°å®¹é‡ï¼ˆminCapacityï¼Œè¿™æ˜¯ç”¨æˆ·æœŸæœ›çš„æœ€å°æ‰©å®¹é‡ï¼‰</strong>è¦å°ï¼Œé‚£ä¹ˆæ–°å®¹é‡è¢«<strong>é‡æ–°å®šä¹‰</strong>ä¸ºå…è®¸çš„æœ€å°å®¹é‡</li>
<li>ä¸€æ—¦<strong>æ–°å®¹é‡ï¼ˆè¿™æ—¶å€™å¯èƒ½æ˜¯æœŸæœ›å€¼ï¼Œä¹Ÿå¯èƒ½æ˜¯1.5å€ï¼‰</strong>å¤§äº<strong>æ•°ç»„æœ€å¤§çš„é•¿åº¦ï¼ˆMAX_ARRAY_SIZEï¼‰</strong>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æŒ‰ç…§<strong>hugeCapacity(minCapacity)</strong>æ–¹æ³•å»<strong>é‡æ–°å®šä¹‰æ–°å®¹é‡</strong></li>
</ul>
<p>äºæ˜¯æˆ‘ä»¬å‘ç°ï¼Œ<strong>ArrayList</strong>çš„æ¯æ¬¡æ‰©å®¹ï¼Œ<strong>æœ€å°‘éƒ½å¾—æ˜¯åŸå®¹å™¨çš„1.5å€</strong></p>
<p>å¯¹äº<strong>hugeCapacity</strong></p>
<pre><code class="language-java">private static int hugeCapacity(int minCapacity) {
    if (minCapacity &lt; 0) // overflow
        throw new OutOfMemoryError();
    return (minCapacity &gt; MAX_ARRAY_SIZE) ?
        Integer.MAX_VALUE :
        MAX_ARRAY_SIZE;
}</code></pre>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæ—¢ç„¶<strong>minCapacity</strong>æ˜¯ä¸ª<strong>intå€¼</strong>ï¼Œé‚£ä¹ˆå®ƒæœ€å¤§å€¼å°±åªèƒ½ä¸º<strong>Integer.MAX_VALUE</strong>ï¼Œè€Œæˆ‘ä»¬è¿™é‡Œå®šä¹‰çš„æœ€å¤§çš„æ•°ç»„é•¿åº¦ä¸º<strong>Integer.MAX_VALUE - 8</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå®šä¹‰å¹¶ä¸æ˜¯ä¸€å®šçš„ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®çš„minCapacityçš„å€¼åœ¨<strong>( Integer.MAX_VALUE - 8, Integer.MAX_VALUE ]</strong>ä¹‹é—´çš„è¯ï¼Œé‚£æˆ‘ä»¬è¿˜æ˜¯å…è®¸ç”¨<strong>Integer.MAX_VALUE</strong>ä½œä¸ºæœ€å¤§æ•°ç»„é•¿åº¦çš„</p>
<p>è¿™é‡Œæˆ‘å°±æœ‰ä¸ªç–‘é—®äº†ï¼Œ<strong>-8çš„æ„ä¹‰åœ¨å“ªé‡Œï¼Ÿä¸€å¼€å§‹å°±å®šä¹‰åˆ°æœ€å¤§å€¼ä¸å°±å¥½äº†ï¼Ÿ</strong></p>
<p>è€ƒè™‘å®Œæ–°å®¹é‡ä¹‹åï¼Œå¼€å§‹ä½¿ç”¨<strong>Arrays.copyOf</strong>æ¥æ‰©å±•å®¹é‡<strong>ï¼ˆgrow lineï¼š12ï¼‰</strong></p>

          <h6>
            <a name="_root-containså’ŒindexOf" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            containså’ŒindexOf
          </h6><pre><code class="language-java">public boolean contains(Object o) {
    return indexOf(o) &gt;= 0;
}

public int indexOf(Object o) {
    if (o == null) {
        for (int i = 0; i &lt; size; i++)
            if (elementData[i]==null)
                return i;
    } else {
        for (int i = 0; i &lt; size; i++)
            if (o.equals(elementData[i]))
                return i;
    }
    return -1;
}</code></pre>
<p>å’Œè‡ªå®ç°ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œ<strong>containsè°ƒç”¨çš„æ˜¯indexOfçš„å®ç°</strong>ï¼Œè€Œä¸”<strong>indexOf</strong>è¿˜å…è®¸<strong>æŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªnullå…ƒç´ åœ¨å“ªé‡Œ</strong>ï¼Œè¿™æ˜¯æˆ‘åœ¨è‡ªå®ç°é‡Œæ²¡è€ƒè™‘è¿‡çš„</p>

          <h6>
            <a name="_root-getå’Œset" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            getå’Œset
          </h6><pre><code class="language-java">E elementData(int index) {
    return (E) elementData[index];
}

public E get(int index) {
    rangeCheck(index);

    return elementData(index);
}

public E set(int index, E element) {
    rangeCheck(index);

    E oldValue = elementData(index);
    elementData[index] = element;
    return oldValue;
}</code></pre>
<pre><code class="language-java">private void rangeCheck(int index) {
    if (index &gt;= size)
        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));
}</code></pre>
<p>é¦–å…ˆçœ‹<strong>get&amp;set</strong>ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„è®¾è®¡ï¼Œåªæ˜¯è¿™é‡Œæœ‰ä¸ª<strong>rangeCheck</strong>ï¼Œå¦‚æœindexå¤§äºç­‰äºè½½é‡ï¼Œå°±æŠ›å¼‚å¸¸</p>

          <h6>
            <a name="_root-add1" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            add1
          </h6><p>è¿™ä¸ªæ˜¯<strong>ArrayList</strong>çš„é‡å¤´æˆä¹‹ä¸€ï¼Œç‰µæ‰¯åˆ°æ‰©å®¹çš„é—®é¢˜ï¼Œæ¥çœ‹çœ‹å®ƒæ€ä¹ˆé¢å¯¹æ‰©å®¹</p>
<pre><code class="language-java">public boolean add(E e) {
    ensureCapacityInternal(size + 1);  // Increments modCount!!
    elementData[size++] = e;
    return true;
}</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬åˆæ³¨æ„åˆ°äº†<strong>ensureCapacityInternal</strong>è¿™ä¸ªæ–¹æ³•</p>
<pre><code class="language-java">private static int calculateCapacity(Object[] elementData, int minCapacity) {
    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
        return Math.max(DEFAULT_CAPACITY, minCapacity);
    }
    return minCapacity;
}

private void ensureCapacityInternal(int minCapacity) {
    ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));
}

private void ensureExplicitCapacity(int minCapacity) {
    modCount++;

    // overflow-conscious code
    if (minCapacity - elementData.length &gt; 0)
        grow(minCapacity);
}</code></pre>
<p>ä»æ–¹æ³•åæ„ä¹‰ä¸Šå»è§£é‡Šï¼Œå½“æˆ‘ä»¬è°ƒç”¨<strong>add(E e)</strong>çš„æ—¶å€™ï¼Œæ˜¯æŠŠå…ƒç´ åŠ åˆ°æ•°ç»„çš„å°¾éƒ¨ä½ç½®ï¼Œåœ¨è¿™ä¹‹å‰æˆ‘ä»¬å¾—å…ˆ<strong>ç¡®ä¿å®¹å™¨çš„å†…éƒ¨å®¹é‡ï¼ˆensureCapacityInternalï¼‰</strong>ï¼Œç¡®ä¿è¿™ä¸ªå†…éƒ¨å®¹é‡è‡³å°‘å¾—æ˜¯å½“å‰çš„<strong>è½½é‡ï¼ˆsizeï¼‰ + 1</strong>ï¼Œä»¥è¿™ä¸ªå€¼ä½œä¸ºæˆ‘ä»¬<strong>å…è®¸çš„æœ€å°å®¹é‡ï¼ˆminCapacityï¼‰</strong></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘çš„<strong>elementData</strong>æ•°ç»„è‡³å°‘è¿˜æœ‰æœ€åä¸€ä¸ªä½ç½®å¯ä»¥è®©æˆ‘é¡ºåˆ©æ·»åŠ ä¸€ä¸ªå…ƒç´ </p>
<p>åœ¨ç¡®ä¿å†…éƒ¨å®¹é‡çš„æ—¶å€™ï¼Œå¾—å…ˆ<strong>è®¡ç®—å®¹é‡ï¼ˆcalculateCapacityï¼‰</strong>ï¼Œè¿™é‡Œé¢çš„å¤„ç†æ²¡æœ‰å¤ªå¤šçš„èŠ±å“¨ï¼Œå¦‚æœå®¹å™¨ä¸ºç©ºï¼Œè€Œä¸”ä½ ç»™çš„<strong>å…è®¸çš„æœ€å°å®¹é‡ï¼ˆminCapacityï¼‰</strong>è¿˜ä¸å¦‚<strong>é»˜è®¤å®¹é‡ï¼ˆ10ï¼‰</strong>å¤§çš„è¯ï¼Œé‚£å°±ç›´æ¥é€‰é»˜è®¤å®¹é‡ï¼Œåªè¦å®¹å™¨ä¸ä¸ºç©ºï¼Œå“ªæ€•é‡Œé¢åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä½ ç»™çš„<strong>å…è®¸çš„æœ€å°å®¹é‡ï¼ˆminCapacityï¼‰</strong>ç”šè‡³åªæ˜¯<strong>2</strong>ï¼Œé‚£ä¹Ÿè¿˜æ˜¯ç”¨2ä½œä¸º<strong>å‚ç…§</strong>å»è°ƒæ•´å®¹é‡ï¼Œä½†è¿™ä»…ä»…åªæ˜¯<strong>å‚ç…§</strong></p>
<p>ä¸ºä»€ä¹ˆè¯´ä»…ä»…æ˜¯<strong>å‚ç…§</strong>ï¼Ÿé‡ç‚¹åœ¨<strong>ensureExplicitCapacity</strong>è¿™é‡Œ</p>
<p>æˆ‘ä»¬å…ˆç†ä¸€ç†è°ƒç”¨æ ˆï¼š</p>
<ul>
<li><strong>add(E e)</strong><ul>
<li><strong>ensureCapacityInternal(size + 1)</strong><ul>
<li><strong>calculateCapacity(elementData, minCapacity)</strong></li>
<li><strong>ensureExplicitCapacity(calculateCapacity(elementData, minCapacity))</strong><ul>
<li><strong>grow(minCapacity)</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>å‡†å¤‡3ä¸ªåœºæ™¯ï¼š</p>
<ul>
<li>ç©ºå®¹å™¨ï¼ŒåŠ ä¸€ä¸ªå…ƒç´ </li>
<li>éç©ºå®¹å™¨ï¼Œå®¹å™¨å®¹é‡è¶³å¤Ÿ  <strong>[ 1 / 10 ]  (size &lt; element.length)</strong></li>
<li>éç©ºå®¹å™¨ï¼Œå®¹å™¨å®¹é‡å·²æ»¡  <strong>[ 10 / 10 ]  ï¼ˆsize == element.lengthï¼‰</strong></li>
</ul>
<hr>
<p>å¯¹äº<strong>åœºæ™¯1</strong>ï¼š</p>
<ul>
<li><p><strong>add(E e)</strong></p>
<ul>
<li><p><strong>ensureCapacityInternal(0 + 1)</strong></p>
<ul>
<li><p><strong>calculateCapacity(elementData, 0 + 1)    ==ã€‹   10</strong></p>
</li>
<li><p><strong>ensureExplicitCapacity(10)</strong></p>
<p>åˆ°äº†<strong>ensureExplicitCapacity(10)</strong>çš„æ—¶å€™ï¼Œå› ä¸ºè¿™æ—¶å€™<strong>elementData</strong>å…¶å®æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ä¼šç»§ç»­åˆ°<strong>growï¼ˆ10ï¼‰</strong></p>
</li>
<li><p><strong>growï¼ˆ10ï¼‰</strong></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>ä¿è¯å®Œå†…éƒ¨å®¹é‡ä¹‹å</strong>ï¼Œå¯ä»¥è¿›è¡Œ<strong>elementData[size++] = e</strong>äº†ï¼Œæ‰€ä»¥æ€»çš„æ¥è¯´ï¼Œæœ€æœ€æœ€å¼€å§‹çš„æ—¶å€™ï¼Œæ•°ç»„æ‰©å®¹è‚¯å®šæ˜¯ä¸€æ‰©åˆ°10çš„</p>
<p>å¯¹äº<strong>åœºæ™¯2</strong>ï¼š</p>
<ul>
<li><p><strong>add(E e)</strong></p>
<ul>
<li><p><strong>ensureCapacityInternal(1 + 1)</strong></p>
<ul>
<li><p><strong>calculateCapacity(elementData, 1 + 1)    ==ã€‹   2</strong></p>
</li>
<li><p><strong>ensureExplicitCapacity(2)</strong></p>
<p>åˆ°äº†<strong>ensureExplicitCapacity(2)</strong>çš„æ—¶å€™ï¼Œå› ä¸ºè¿™æ—¶å€™<strong>elementData.length = 10 &gt; 2</strong>ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè°ƒç”¨<strong>grow</strong>æ¥æ‰©å®¹</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>æ­¤æ—¶å¯ä»¥ç›´æ¥è¿›è¡Œ<strong>elementData[size++] = e</strong></p>
<p>å¯¹äº<strong>åœºæ™¯3</strong>ï¼š</p>
<ul>
<li><p><strong>add(E e)</strong></p>
<ul>
<li><p><strong>ensureCapacityInternal(10 + 1)</strong></p>
<ul>
<li><p><strong>calculateCapacity(elementData, 10 + 1)    ==ã€‹   11</strong></p>
</li>
<li><p><strong>ensureExplicitCapacity(11)</strong></p>
<p>åˆ°äº†<strong>ensureExplicitCapacity(11)</strong>çš„æ—¶å€™ï¼Œå› ä¸ºè¿™æ—¶å€™<strong>elementData.length = 10 &lt; 11</strong>ï¼Œæ‰€ä»¥ä¼šç»§ç»­åˆ°<strong>growï¼ˆ11ï¼‰æ¥è¿›è¡Œæ‰©å®¹</strong></p>
</li>
<li><p><strong>growï¼ˆ11ï¼‰</strong></p>
<p>å¾€ä¸Šç¿»<strong>grow</strong>ä¼šå‘ç°ï¼Œè¿™é‡Œæ–°å®¹é‡æ˜¯æ‰©å±•åˆ°äº†<strong>15</strong></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>æ­¤æ—¶å¯ä»¥ç›´æ¥è¿›è¡Œ<strong>elementData[size++] = e</strong></p>
<hr>

          <h6>
            <a name="_root-add2" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            add2
          </h6><pre><code class="language-java">public void add(int index, E element) {
    rangeCheckForAdd(index);

    ensureCapacityInternal(size + 1);  // Increments modCount!!
    System.arraycopy(elementData, index, elementData, index + 1,
                     size - index);
    elementData[index] = element;
    size++;
}</code></pre>
<pre><code class="language-java">private void rangeCheckForAdd(int index) {
    if (index &gt; size || index &lt; 0)
        throw new IndexOutOfBoundsException(outOfBoundsMsg(index));
}</code></pre>
<p>å¯¹äº<strong>index</strong>çš„é™å®šï¼š<strong>ä¸èƒ½åœ¨è½½é‡ä¹‹å¤–ï¼Œä¹Ÿä¸èƒ½å°äº0</strong>ï¼Œç„¶åç¡®ä¿äº†å®¹é‡ä¹‹åå°±å¼€å§‹ç§»å…ƒç´ ï¼Œç„¶åå¾€ä¸­é—´æ’å…ƒç´ ï¼Œä»è¿™ç‚¹æ¥è¯´ï¼Œæˆ‘çš„è‡ªå®ç°å’Œè¿™ä¸ªå®ç°çš„å·®ä¸å¤š</p>

          <h6>
            <a name="_root-remove1" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            remove1
          </h6><pre><code class="language-java">public E remove(int index) {
    rangeCheck(index);

    modCount++;
    E oldValue = elementData(index);

    int numMoved = size - index - 1;
    if (numMoved &gt; 0)
        System.arraycopy(elementData, index+1, elementData, index,
                         numMoved);
    elementData[--size] = null; // clear to let GC do its work

    return oldValue;
}</code></pre>
<p>åŸºæœ¬éƒ½æ˜¯å¸¸è§„æ“ä½œï¼Œä½†æ˜¯ï¼è¿™é‡Œçš„<strong>lineï¼š11</strong>æ˜¯ä¸€ä¸ªéªšæ“ä½œï¼Œå¾ˆå¤šè‡ªå®ç°é‡Œé¢ï¼Œåªæ˜¯æŠŠä½ç½®ç§»åˆ°äº†ï¼Œè½½é‡å‡åˆ°äº†å°±å®Œäº†ï¼Œä¹Ÿå¼ºè°ƒè¿‡å¯ä»¥ä¸å†™<strong>elementData[--size] = null</strong>è¿™å¥ï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘ä¸€æ­¥æ“ä½œï¼Œè®¿é—®ä¸åˆ°çš„å…ƒç´ ç•™ç€ä¹Ÿæ²¡ä»€ä¹ˆï¼Œç°åœ¨æƒ³æƒ³ç¡®å®æœ‰ç‚¹å¯ç¬‘ï¼Œæ³¨é‡Šé‡Œä¹Ÿè¯´äº†ï¼Œ<strong>å°†è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨æ‘˜é™¤ï¼Œå¥½è®©GCç®¡ç®¡è¿™ä¸ªè¢«åˆ é™¤çš„å…ƒç´ </strong></p>
<p>è¿™å°±æ˜¯çœŸæ­£æŠ•å…¥ä½¿ç”¨çš„å®¹å™¨ï¼Œè¦è€ƒè™‘åˆ°çš„äº‹æƒ…ï¼Œ<strong>ä¸ºç”¨æˆ·å°½å¯èƒ½åœ°æé«˜æ—¶é—´å’Œç©ºé—´æ•ˆç‡ï¼</strong></p>

          <h6>
            <a name="_root-remove2" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            remove2
          </h6><pre><code class="language-java">public boolean remove(Object o) {
    if (o == null) {
        for (int index = 0; index &lt; size; index++)
            if (elementData[index] == null) {
                fastRemove(index);
                return true;
            }
    } else {
        for (int index = 0; index &lt; size; index++)
            if (o.equals(elementData[index])) {
                fastRemove(index);
                return true;
            }
    }
    return false;
}
private void fastRemove(int index) {
    modCount++;
    int numMoved = size - index - 1;
    if (numMoved &gt; 0)
        System.arraycopy(elementData, index+1, elementData, index,
                         numMoved);
    elementData[--size] = null; // clear to let GC do its work
}</code></pre>
<p>å¸¸è§„ï¼Œæˆ‘åœ¨æƒ³ä¸ºä»€ä¹ˆremove1é‡Œçš„ä»£ç ä¸ç”¨<strong>fastRemove</strong>ï¼Œè¿™ä¸¤æ®µå®Œå…¨æ˜¯ä¸€æ‘¸ä¸€æ ·çš„</p>

          <h6>
            <a name="_root-clear" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            clear
          </h6><pre><code class="language-java">public void clear() {
    modCount++;

    // clear to let GC do its work
    for (int i = 0; i &lt; size; i++)
        elementData[i] = null;

    size = 0;
}</code></pre>
<p>åŒç†ï¼Œå¾ˆå¤šè‡ªå®ç°ä¹Ÿåªæ˜¯å°†<strong>size</strong>ç½®ä¸ºé›¶ï¼Œå¹¶æ²¡æ‰£è€ƒè™‘GCï¼Œä½†æ˜¯æˆ‘è§‰å¾—è¿™é‡Œæ˜¯å¦å­˜åœ¨ä¸€ä¸ª<strong>æ›´å¥½çš„å®ç°</strong>å‘¢ï¼Ÿæ¯”å¦‚è¯´å¯ä»¥è¿™æ ·ï¼š</p>
<pre><code class="language-java">public void clear() {
    modCount++;

    // clear to let GC do its work
    elementData = new Object[elementData.length];

    size = 0;
}</code></pre>
<p>è½¬ç¬æˆ‘å°±æƒ³æ˜ç™½äº†ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ª<strong>æ—¶é—´æ¢ç©ºé—´çš„é€‰æ‹©ï¼</strong></p>
<p>ç¡®å®forå¾ªç¯ä¸€ä¸ªä¸ªç½®ç©ºç¡®å®æ¯”è¾ƒæµªè´¹æ—¶é—´ï¼Œæ¯”å¦‚æœ‰30wä¸ªå…ƒç´ åœ¨å®¹å™¨ä¸­ï¼Œæˆ‘å°±å¾—for30wæ¬¡</p>
<p>ä½†æ˜¯è¿™æ ·æˆ‘è¿˜æ˜¯åœ¨åŸæ•°ç»„çš„åœ°å€å†…å­˜ä¸Šè¿›è¡Œæ“ä½œï¼Œå¦‚æœæˆ‘é€‰æ‹©äº†æ‰€è°“çš„<strong>æ›´å¥½çš„å®ç°</strong>ï¼Œé‚£ä¹ˆæˆ‘è¿˜å¾—åœ¨å†…å­˜ä¸­å†ç”³è¯·<strong>30wä¸ªå…ƒç´ é•¿åº¦çš„æ•°ç»„ç©ºé—´</strong>ï¼Œè™½ç„¶çœ‹ä¸Šå»ï¼Œæˆ‘å¥½åƒé©¬ä¸Šå°±<strong>æ‘˜é™¤äº†åŸelementDataçš„å¼•ç”¨</strong>ï¼Œä½†å®é™…ä¸Šï¼ŒåŸ<strong>elementData</strong>çš„æ•°ç»„æ•°æ®ä»ç„¶ä¼šåœ¨å†…å­˜ä¸­åœç•™ä¸€æ®µæ—¶é—´ï¼Œ<strong>ç­‰å¾…ä¸‹ä¸€æ¬¡GCå¹¶ä¸”GCé€‰æ‹©å›æ”¶å®ƒ</strong></p>
<p>ä¸Šé¢åªæ˜¯æˆ‘çš„æ¨æµ‹ï¼Œå®é™…GCæ˜¯å¦‚ä½•å¯¹äºè¿™ä¸¤ç§æƒ…å†µåšå‡ºé€‰æ‹©çš„æˆ‘ä»¬å¹¶ä¸æ¸…æ¥šï¼Œå§‘ä¸”å°±è¿™æ ·è®¤ä¸ºå§</p>

          <h6>
            <a name="_root-removeAllå’ŒretainAll" class="reference-link" target="_blank">
              <span class="header-link"></span>
            </a>
            removeAllå’ŒretainAll
          </h6><p>å¯¹äº<strong>addAllã€removeRange</strong>ç­‰æ–¹æ³•çš„å®ç°æ¯”è¾ƒå¸¸è§„ï¼ŒåŸºæœ¬ä¸Šå’Œä¸Šé¢çš„å·®ä¸å¤šï¼Œ<strong>removeAllä»¥åŠretainAll</strong>è¿˜æ˜¯è¦ç ”ç©¶ä¸€å“ˆå­</p>
<pre><code class="language-java">public boolean removeAll(Collection&lt;?&gt; c) {
    Objects.requireNonNull(c);
    return batchRemove(c, false);
}</code></pre>
<pre><code class="language-java">public boolean retainAll(Collection&lt;?&gt; c) {
    Objects.requireNonNull(c);
    return batchRemove(c, true);
}</code></pre>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•å¾ˆç›¸ä¼¼ï¼Œä½œç”¨æ°å¥½ç›¸åï¼Œ</p>
<ul>
<li><strong>removeAllæ˜¯ç§»é™¤äº¤é›†å…ƒç´ ï¼Œç•™ä¸‹è¡¥é›†å…ƒç´ </strong></li>
<li><strong>retainAllæ˜¯ç§»é™¤è¡¥é›†å…ƒç´ ï¼Œä¿ç•™äº¤é›†å…ƒç´ </strong></li>
</ul>
<p>ä¸¤ä¸ªæ–¹æ³•éƒ½è°ƒç”¨äº†<strong>bantchRemove</strong>æ–¹æ³•</p>
<p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å°†<strong>bantchRemove</strong>æºç ä¸­çš„</p>
<ul>
<li><strong>complementé‡å‘½åä¸ºjustComplementï¼Œè¿™ä¸ªå˜é‡æ ‡è¯†æ˜¯å–è¡¥é›†è¿˜æ˜¯äº¤é›†</strong></li>
<li><strong>ré‡å‘½åä¸ºreadIndexï¼Œæ ‡è¯†åˆ°å…ƒç´ çš„ä¸‹æ ‡</strong></li>
<li><strong>wé‡å‘½åä¸ºwriteIndexï¼Œæ ‡è¯†å†™åˆ°å…ƒç´ çš„ä¸‹æ ‡</strong></li>
</ul>
<pre><code class="language-java">private boolean batchRemove(Collection&lt;?&gt; c, boolean justComplement) {
    final Object[] elementData = this.elementData;
    int readIndex = 0, writeIndex = 0;
    boolean modified = false;
    try {
        for (; readIndex &lt; size; readIndex++)
            if (c.contains(elementData[readIndex]) == justComplement)
                elementData[writeIndex++] = elementData[readIndex];
    } finally {
        // Preserve behavioral compatibility with AbstractCollection,
        // even if c.contains() throws.
        if (readIndex != size) {
            System.arraycopy(elementData, readIndex,
                             elementData, writeIndex,
                             size - readIndex);
            writeIndex += size - readIndex;
        }
        if (writeIndex != size) {
            // clear to let GC do its work
            for (int i = writeIndex; i &lt; size; i++)
                elementData[i] = null;
            modCount += size - writeIndex;
            size = writeIndex;
            modified = true;
        }
    }
    return modified;
}</code></pre>
<p>æˆ‘ä»¬çœ‹<strong>tryå—ä»£ç </strong>ï¼Œä»£ç éå†äº†<strong>elementData</strong>ï¼Œå…¶ä¸­è¿™ä¸€å¥çš„è§£è¯»å¾ˆæœ‰æ„æ€ï¼š</p>
<pre><code class="language-java">c.contains(elementData[r]) == justComplement</code></pre>
<p>åœ¨<strong>justComplement</strong>ä¸º<strong>false</strong>çš„æƒ…å†µä¸‹ï¼š</p>
<ul>
<li>å¦‚æœcä¸­æ²¡æœ‰åŸå®¹å™¨å½“å‰éå†åˆ°çš„å…ƒç´ ï¼Œåˆ™<strong>ï¼ˆfalse == falseï¼‰= true</strong>ï¼Œå°†è¿™ä¸ª<strong>cä¸­æ²¡æœ‰çš„å…ƒç´ </strong>è¦†ç›–åˆ°<strong>elementData[writeIndex]</strong>çš„ä½ç½®</li>
<li>å¦‚æœcä¸­æœ‰åŸå®¹å™¨å½“å‰éå†åˆ°çš„å…ƒç´ ï¼Œåˆ™<strong>ï¼ˆtrue == falseï¼‰= false</strong>ï¼Œä¸è¿›è¡Œæ“ä½œï¼Œè¿›å…¥ä¸‹æ¬¡å¾ªç¯</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯<strong>æŠŠåŸå®¹å™¨å’Œcå®¹å™¨ä¸­ä¸ç›¸äº¤çš„å…ƒç´ æŒ‰é¡ºåºç§»åˆ°åŸå®¹å™¨çš„å‰é¢å»äº†</strong></p>
<p>åŒç†åœ¨<strong>justComplement</strong>ä¸º<strong>true</strong>çš„æƒ…å†µä¸‹ï¼š</p>
<ul>
<li>å¦‚æœcä¸­æ²¡æœ‰åŸå®¹å™¨å½“å‰éå†åˆ°çš„å…ƒç´ ï¼Œåˆ™<strong>ï¼ˆfalse == trueï¼‰= false</strong>ï¼Œä¸è¿›è¡Œæ“ä½œï¼Œè¿›å…¥ä¸‹æ¬¡å¾ªç¯</li>
<li>å¦‚æœcä¸­æœ‰åŸå®¹å™¨å½“å‰éå†åˆ°çš„å…ƒç´ ï¼Œåˆ™<strong>ï¼ˆtrue == trueï¼‰= true</strong>ï¼Œå°†è¿™ä¸ª<strong>cä¸­æœ‰çš„å…ƒç´ </strong>è¦†ç›–åˆ°<strong>elementData[writeIndex]</strong>çš„ä½ç½®</li>
</ul>
<p>å°±æ˜¯<strong>æŠŠåŸå®¹å™¨å’Œcå®¹å™¨ä¸­ç›¸äº¤çš„å…ƒç´ æŒ‰é¡ºåºç§»åˆ°åŸå®¹å™¨çš„å‰é¢å»äº†</strong></p>
<p>ç„¶åæœ‰ç‚¹è¿·çš„æ˜¯<strong>finallyå—</strong>çš„è¯­å¥</p>
<p>ç¬¬ä¸€ä¸ªåˆ¤æ–­åº”è¯¥æ˜¯è¯´ï¼ŒåŠ å…¥ä¹‹å‰æŠ›äº†ä¸€äº›å¼‚å¸¸ä»€ä¹ˆçš„ï¼Œå¯¼è‡´ä¸Šé¢çš„forå¾ªç¯ä¸­æ–­äº†ï¼Œå¦‚æ­¤ä¸€æ¥åº”è¯¥æ˜¯<strong>æ²¡è¯»å®ŒåŸå®¹å™¨é‡Œçš„å…ƒç´ </strong>çš„ï¼Œå¥½äº†ï¼Œæ²¡è¯»å®Œå°±ç®—äº†ï¼Œ<strong>æŠŠå‰©ä¸‹æ²¡è¯»å®Œçš„å…ƒç´ ç§»åˆ°ä¹‹å‰å†™å¥½çš„å…ƒç´ ä¹‹å</strong>ï¼Œé‚£è¿™éƒ¨åˆ†ä¹Ÿç®—<strong>è¯»åˆ°äº†å†™å¥½äº†ï¼ˆlineï¼š16ï¼‰</strong></p>
<p>æˆ‘è®¤ä¸ºè¿™æ ·çš„åšæ³•æ˜¯<strong>ä¿æŠ¤æœªè¯»å–å®Œçš„å…ƒç´ æ•°æ®ä¸è¢«ä¸¢å¤±</strong></p>
<p>ç¬¬äºŒä¸ªåˆ¤æ–­ï¼Œå¥½äº†è¯»å®Œä¹Ÿå†™å®Œäº†ï¼Œç°åœ¨æ•°ç»„ä¸­å¯èƒ½æœ‰ä¸‰éƒ¨åˆ†ï¼š</p>
<ul>
<li>ç¬¬ä¸€éƒ¨åˆ†æ˜¯é€‰æ‹©<strong>å†™ä¸‹çš„å…ƒç´ åºåˆ—</strong>ï¼Œè¿™éƒ¨åˆ†<strong>æœ‰æ•ˆ</strong></li>
<li>ç¬¬äºŒéƒ¨åˆ†å¯èƒ½æ˜¯ä¹‹å‰å‡ºé”™äº†ï¼Œæ²¡è¯»å®Œçš„å…ƒç´ ä½†æ˜¯æˆ‘ç§»åŠ¨åˆ°ç´§æ¥ç€ç¬¬ä¸€éƒ¨åˆ†åºåˆ—çš„åè¾¹äº†ï¼Œè¿™éƒ¨åˆ†ä¹Ÿ<strong>æœ‰æ•ˆ</strong></li>
<li>ç¬¬ä¸‰éƒ¨åˆ†å°±æ˜¯ç¬¬äºŒéƒ¨åˆ†å¾€å‰ç§»åŠ¨ä¹‹å‰å‰©ä¸‹çš„ä¸€äº›é”™ä½çš„å…ƒç´ ï¼Œè¿™éƒ¨åˆ†ä¸åº”è¯¥è¢«è®¿é—®åˆ°ï¼Œæ‰€ä»¥<strong>æ— æ•ˆ</strong></li>
</ul>
<p>è¯»å®Œå†™å®Œä¹‹åï¼Œ<strong>(writeIndex != size)</strong>è¿™æ ·çš„æ¡ä»¶ä¼šåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‡ºç°ï¼Ÿç¬¬äºŒéƒ¨åˆ†çœŸçš„æœ‰å¾€å‰ç§»åŠ¨çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è¯´åŒ…å«<strong>æ— æ•ˆå…ƒç´ </strong>çš„æ—¶å€™</p>
<p>æ‰€ä»¥è¿™æ—¶å€™å°±è¦<strong>æ‘˜é™¤æ— æ•ˆå…ƒç´ çš„å¼•ç”¨ï¼Œç„¶åé‡ç½®è½½é‡ä¸ºå†™å…ƒç´ çš„é•¿åº¦</strong></p>

    </div>
    <div id="scriptsearcher" class="myhide input-group new_font">
        <input id="searchtext" type="text" class="form-control" placeholder="keywords" autocomplete="off">
        <div class="input-group-append">
            <button id="searchbut" class="btn btn-dark" type="button">Search</button>
        </div>
    </div>

    <div id="bbt" class="myhide new_font">
        <a id="toc" style="display: none;" class="myhide" href="javascript:void(0);" data-toggle="tooltip" data-placement="left" title="show/hide Toc">Toc</a>
        <a id="gohub" href="#" target="_blank" data-toggle="tooltip" data-placement="bottom" title="view this at github">unuse</a>
    </div>

    <div id="share_png_panel" class="myhide">
        <div id="share_curtain"></div>
        <div id="png_box"></div>
        <button id="share_png_paned_close" class="btn btn-dark">Close</button>
    </div>

</body>

</html>