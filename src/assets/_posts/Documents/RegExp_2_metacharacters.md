---
title: RegExp_2_metacharacters
comments: true
tags:
  - regular-expression
date: 2017-11-17 00:02:06
series: 《Mastering Regular Expression(Third Edition)》
---

{% cq %}

Metacharacters：元字符

{% endcq %}

<!-- more -->

### 元字符的解释

完整的正则表达式由两种字符组成：

- 特殊字符，即`元字符`，它们一般具有特殊的含义，并不匹配字面字符。
- 文字，即普通`文本字符`，匹配的就是字面字符。

---

#### 行的起始和结束

> `^` 脱字符号，在检查一行文本的时候，`^`代表一行的开始。

> `$` 美元符号，在检查一行文本的时候，`$`代表一行的结束。

- `^cat` ：表示匹配以 cat 开头的行，如 categories
- `cat$` ：表示匹配以\$结尾的行，如 aaaacat

我们以更机械的方式去解读第一个例子：`^cat` 匹配的是以 c 作为一行的第一个字符，紧接着 c 后面是 a，a 后面紧接着 t 的文本。

这两个符号的特殊之处就在于，它们匹配的只是位置，而不是特定的文本。

---

#### 字符组

##### 匹配若干字符之一

这里需要引入一个概念：正则表达式结构体（construct）`[...]`。它允许使用者列出在某处期望匹配的字符的候选值，通常也被称为字符组。

比如当我们不确定是要匹配 grey 还是 gray 的时候，我们可以这样写`gr[ae]y`，它想表达的意思是：匹配一段文本，它是先有一个 g，g 后是一个 r，r 后可以是 a 或者 e 其中之一，然后就是一个 y。

在`gr[ae]y`中，`g`或者`r`、`y`这样的表达式，它们被解释为：g 后面紧跟着、r 后面紧跟着这样的“接下来（and then）”的含义，而在`[ae]`中，里面的字符被解释为：这个结构体的位置被替换为 a 或者是 e。

我们还有可能遇到的场景是，`[123456789]`甚至是 26 个字母全用上的情况，这个时候我们可以使用**字符组元字符**`-`（连接符）来表示一个范围，比如`[1-9]`和`[123456789]`是完全相等的。同时还支持多重范围比如`[a-h1-6F-I]`和`[abcdefg123456FGHI]`等效。

还可以在字符组里面使用普通文本[_.!?]可以匹配下划线或者点或者感叹号或者问号。

**需要注意的是：只有在字符组内部，并且能够表示特定范围含义，比如 1 到 9，a 到 z 这样的范围，连字符才是元字符，在其他情况下它只能匹配普通的连字符号。而在字符组内的问号和点号则是匹配一般的符号，它们在组内不是元字符，在组外是元字符。这有点像正常语言中，某个单词在不同的语境中有不同的解释一样，我私称这样的情况为`语境分意`**

##### 排除型字符组

还有一种字符组形如：`[^...]`，这个字符组会匹配任何**未**列出的字符。例如`[^1-6]`匹配除了 1 到 6 以外的任何字符。

你可能已经注意到了，`^`脱字符在组内和组外的含义的不一样的，由此我们了解到，**元字符会根据环境的不同而改变它所要表达的含义。**

> 书例：`q[^u]`是否能匹配`Iraq`？
>
> 我们机械地解读表达式：q 后面紧跟一个除了 u 以外的字符。注意是“后面紧跟”，所以这就意味着，q 字符绝对不是最后一个字母。
>
> 因此我们知道：一个字符组，即使是排除型的字符组，也必须匹配一个字符。

##### 点号匹配任意字符

元字符`.`是用来匹配任意字符的字符组的简便写法，注意是**字符组**的便捷写法。如果我们要搜索 03/19/76、03-19-76、03.19.76，一般的的做法是写`03[-/.]19[-/.]76`来让字符组匹配一个减号或者斜杠或者英文句号，我们也可以这样写`03.19.76`。这里又出现**语境分意**的情况了，`.`在字符组内外的含义不同，而`-`在字符组内的位置不同语义也不同，如果写成`[.-/]`，则是用来表示范围的，这里需要特别留心。

---

#### 多选结构

##### 匹配任意子表达式

`|`是一个非常简洁的元字符，它等于布尔运算里面的“或（or）”。比如`Bob`和`Robert`是两个表达式，但`Bob|Robert`就是一个表达式，但是可以匹配里面两种情况。这样的组合称之为“多选分支（alternative）”。

我们之前的`gr[ea]y`可以写成`grey|gray`，或者是`gr(a|e)y`，最后这种情况用括号来划定多选结构的范围（一般情况下，括号也是元字符）。同样值得注意的是，如果我们写成`gr[e|a]y`，那么这里面的`|`就并不代表或而是代表“|”符号本身。

在表达式`gr(a|e)y`中，括号是必须的，如果没有括号，`gre|ay`就变成了匹配`gre`或者`ay`了。**多选结构可以包含很多字符，但是不能超过括号的界限。** 再举一个例子：`(Fir|1)st [Ss]treet`可以匹配`First Street`、`First street`、`1st Street`、`1st street`等。

再一次强调，多选结构和字符组的区别是：**字符组只能匹配一个字符，但是多选结构可以匹配多个字符！**

#### 可选项元素

比如 color 和 colour，其中只有一个 u 的区别，我们可以用`colou?r`这样的表达式来解决，`?`元字符代表可选，它代表前面一个字母是可选的匹配项。

`?`只作用与之前紧邻的元素，所以我们让机械来读这个表达式则是：`c`，然后`o`然后`l`然后`o`然后`u?`最后`r`。

比较特别的是，`u?`这样的表达式是永远都能匹配成功的，它可以匹配以个 u，也可以什么都不匹配。
